if(typeof console=="undefined")var console={log:function(){},warn:function(){}};if(!this.JSON)this.JSON={};
(function(){function e(c){return c<10?"0"+c:c}function f(c){g.lastIndex=0;return g.test(c)?'"'+c.replace(g,function(d){var k=l[d];return typeof k==="string"?k:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function a(c,d){var k,o,s,r,t=h,p,q=d[c];if(q&&typeof q==="object"&&typeof q.toJSON==="function")q=q.toJSON(c);if(typeof n==="function")q=n.call(d,c,q);switch(typeof q){case "string":return f(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";h+=m;p=[];if(Object.prototype.toString.apply(q)==="[object Array]"){r=q.length;for(k=0;k<r;k+=1)p[k]=a(k,q)||"null";s=p.length===0?"[]":h?"[\n"+h+p.join(",\n"+h)+"\n"+t+"]":"["+p.join(",")+"]";h=t;return s}if(n&&typeof n==="object"){r=n.length;for(k=0;k<r;k+=1){o=n[k];if(typeof o==="string")if(s=a(o,q))p.push(f(o)+(h?": ":":")+s)}}else for(o in q)if(Object.hasOwnProperty.call(q,o))if(s=a(o,q))p.push(f(o)+(h?": ":":")+s);s=p.length===0?"{}":h?"{\n"+h+p.join(",\n"+h)+
"\n"+t+"}":"{"+p.join(",")+"}";h=t;return s}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,m,l={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;if(typeof JSON.stringify!=="function")JSON.stringify=function(c,d,k){var o;m=h="";if(typeof k==="number")for(o=0;o<k;o+=1)m+=" ";else if(typeof k==="string")m=k;if((n=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw Error("JSON.stringify");return a("",
{"":c})};if(typeof JSON.parse!=="function")JSON.parse=function(c,d){function k(s,r){var t,p,q=s[r];if(q&&typeof q==="object")for(t in q)if(Object.hasOwnProperty.call(q,t)){p=k(q,t);if(p!==undefined)q[t]=p;else delete q[t]}return d.call(s,r,q)}var o;c=String(c);b.lastIndex=0;if(b.test(c))c=c.replace(b,function(s){return"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){o=eval("("+c+")");return typeof d==="function"?k({"":o},""):o}throw new SyntaxError("JSON.parse");}})();
(function(){function e(h,m){for(var l in m)h[l]=m[l];return h}function f(h,m){var l=document.createElement(h);for(var n in m)if(n==="class")l.className=m[n];else if(n==="for")l.htmlFor=m[n];else l.setAttribute(n,m[n]);return l}function a(){return false}var b=this.fabric||(this.fabric={}),g=Array.prototype.slice;b.util={};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(h,m){var l=this.length>>>0;m=Number(m)||0;m=Math[m<0?"ceil":"floor"](m);if(m<0)m+=l;for(;m<l;m++)if(m in this&&this[m]===
h)return m;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(h,m){for(var l=0,n=this.length>>>0;l<n;l++)l in this&&h.call(m,this[l],l,this)};if(!Array.prototype.map)Array.prototype.map=function(h,m){for(var l=[],n=0,c=this.length>>>0;n<c;n++)if(n in this)l[n]=h.call(m,this[n],n,this);return l};if(!Array.prototype.every)Array.prototype.every=function(h,m){for(var l=0,n=this.length>>>0;l<n;l++)if(l in this&&!h.call(m,this[l],l,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=
function(h,m){for(var l=0,n=this.length>>>0;l<n;l++)if(l in this&&h.call(m,this[l],l,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(h,m){for(var l=[],n,c=0,d=this.length>>>0;c<d;c++)if(c in this){n=this[c];h.call(m,n,c,this)&&l.push(n)}return res};if(!Array.prototype.reduce)Array.prototype.reduce=function(h){var m=this.length>>>0,l=0,n;if(arguments.length>1)n=arguments[1];else{do{if(l in this){n=this[l++];break}if(++l>=m)throw new TypeError;}while(1)}for(;l<
m;l++)if(l in this)n=h.call(null,n,this[l],l,this);return n};b.util.array={invoke:function(h,m){for(var l=g.call(arguments,2),n=[],c=0,d=h.length;c<d;c++)n[c]=l.length?h[c][m].apply(h[c],l):h[c][m].call(h[c]);return n},min:function(h,m){var l=h.length-1,n=m?h[l][m]:h[l];if(m)for(;l--;){if(h[l][m]<n)n=h[l][m]}else for(;l--;)if(h[l]<n)n=h[l];return n},max:function(h,m){var l=h.length-1,n=m?h[l][m]:h[l];if(m)for(;l--;){if(h[l][m]>=n)n=h[l][m]}else for(;l--;)if(h[l]>=n)n=h[l];return n}};b.util.object=
{extend:e,clone:function(h){return e({},h)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};b.util.string={camelize:function(h){return h.replace(/-+(.)?/g,function(m,l){return l?l.toUpperCase():""})},capitalize:function(h){return h.charAt(0).toUpperCase()+h.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(h){var m=this,l=Array.prototype.slice.call(arguments,1);return function(){return m.apply(h,l.concat(Array.prototype.slice.call(arguments)))}};
(function(){function h(){}var m;m=function(){for(var l in{toString:1})if(l==="toString")return false;return true}()?function(l,n){if(n.toString!==Object.prototype.toString)l.prototype.toString=n.toString;if(n.valueOf!==Object.prototype.valueOf)l.prototype.valueOf=n.valueOf;for(var c in n)l.prototype[c]=n[c]}:function(l,n){for(var c in n)l.prototype[c]=n[c]};b.util.createClass=function(){function l(){this.initialize.apply(this,arguments)}var n=null,c=g.call(arguments,0);if(typeof c[0]==="function")n=
c.shift();l.superclass=n;l.subclasses=[];if(n){h.prototype=n.prototype;l.prototype=new h;n.subclasses.push(l)}n=0;for(var d=c.length;n<d;n++)m(l,c[n]);if(!l.prototype.initialize)l.prototype.initialize=emptyFunction;return l.prototype.constructor=l}})();(function(){function h(p){var q=Array.prototype.slice.call(arguments,1),v,u,x=q.length;for(u=0;u<x;u++){v=typeof p[q[u]];if(!/^(?:function|object|unknown)$/.test(v))return false}return true}function m(p,q){return function(v){q.call(c(p),v||window.event)}}
function l(p,q){return function(v){if(r[p]&&r[p][q])for(var u=r[p][q],x=0,w=u.length;x<w;x++)u[x].call(this,v||window.event)}}var n=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(q){return q.uniqueID};var p=0;return function(q){return q.__uniqueID||(q.__uniqueID="uniqueID__"+p++)}}(),c,d;(function(){var p={};c=function(q){return p[q]};d=function(q,v){p[q]=v}})();var k=h(document.documentElement,"addEventListener","removeEventListener")&&h(window,"addEventListener",
"removeEventListener"),o=h(document.documentElement,"attachEvent","detachEvent")&&h(window,"attachEvent","detachEvent"),s={},r={};if(k){addListener=function(p,q,v){p.addEventListener(q,v,false)};removeListener=function(p,q,v){p.removeEventListener(q,v,false)}}else if(o){addListener=function(p,q,v){var u=n(p);d(u,p);s[u]||(s[u]={});s[u][q]||(s[u][q]=[]);v={handler:v,wrappedHandler:m(u,v)};s[u][q].push(v);p.attachEvent("on"+q,v.wrappedHandler)};removeListener=function(p,q,v){var u=n(p),x;if(s[u]&&s[u][q])for(var w=
0,y=s[u][q].length;w<y;w++)if((x=s[u][q][w])&&x.handler===v){p.detachEvent("on"+q,x.wrappedHandler);s[u][q][w]=null}}}else{addListener=function(p,q,v){var u=n(p);r[u]||(r[u]={});if(!r[u][q]){r[u][q]=[];var x=p["on"+q];x&&r[u][q].push(x);p["on"+q]=l(u,q)}r[u][q].push(v)};removeListener=function(p,q,v){p=n(p);if(r[p]&&r[p][q]){q=r[p][q];p=0;for(var u=q.length;p<u;p++)q[p]===v&&q.splice(p,1)}}}b.util.addListener=addListener;b.util.removeListener=removeListener;var t={};b.util.observeEvent=function(p,
q){t[p]||(t[p]=[]);t[p].push(q)};b.util.fireEvent=function(p,q){if(t[p])for(var v=0,u=t[p].length;v<u;v++)try{t[p][v]({memo:q})}catch(x){setTimeout(function(){throw x;},0)}};b.util.getPointer=function(p){var q=document.documentElement,v=document.body||{scrollLeft:0},u=document.documentElement,x=document.body||{scrollTop:0};return{x:p.pageX||p.clientX+(q.scrollLeft||v.scrollLeft)-(q.clientLeft||0),y:p.pageY||p.clientY+(u.scrollTop||x.scrollTop)-(u.clientTop||0)}}})(this);(function(){var h=document.createElement("div"),
m=typeof h.style.filter==="string",l=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(c){return c};if(typeof h.style.opacity==="string")n=function(c,d){c.style.opacity=d;return c};else if(m)n=function(c,d){var k=c.style;if(c.currentStyle&&!c.currentStyle.hasLayout)k.zoom=1;if(l.test(k.filter)){d=d>=0.9999?"":"alpha(opacity="+d*100+")";k.filter=k.filter.replace(l,d)}else k.filter+=" alpha(opacity="+d*100+")";return c};b.util.setStyle=function(c,d){var k=c.style;if(typeof d==="string"){c.style.cssText+=
";"+d;return d.indexOf("opacity")>-1?n(c,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):c}for(var o in d)if(o==="opacity")n(c,d[o]);else k[o==="float"||o==="cssFloat"?typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat":o]=d[o];return c}})();(function(){var h=document.documentElement.style,m="userSelect"in h?"userSelect":"MozUserSelect"in h?"MozUserSelect":"WebkitUserSelect"in h?"WebkitUserSelect":"KhtmlUserSelect"in h?"KhtmlUserSelect":"";b.util.makeElementUnselectable=function(l){if(typeof l.onselectstart!==
"undefined")l.onselectstart=a;if(m)l.style[m]="none";else if(typeof l.unselectable=="string")l.unselectable="on";return l}})();(function(){function h(l,n){m.load(l);n()}b.util.getScript=function(l,n){var c=document.getElementsByTagName("head")[0],d=document.createElement("script"),k=true;d.type="text/javascript";d.setAttribute("runat","server");d.onload=d.onreadystatechange=function(o){if(k)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){k=false;n(o||
window.event);d=d.onload=d.onreadystatechange=null}};d.src=l;c.appendChild(d)};var m=this.Jaxer;if(m&&m.load)b.util.getScript=h})();b.util.getById=function(h){return typeof h==="string"?document.getElementById(h):h};b.util.toArray=function(h){for(var m=[],l=h.length;l--;)m[l]=h[l];return m};b.util.makeElement=f;b.util.addClass=function(h,m){if((" "+h.className+" ").indexOf(" "+m+" ")===-1)h.className+=(h.className?" ":"")+m};b.util.wrapElement=function(h,m,l){if(typeof m==="string")m=f(m,l);h.parentNode&&
h.parentNode.replaceChild(m,h);m.appendChild(h);return m};b.util.getElementOffset=function(h){var m=0,l=0;do{m+=h.offsetTop||0;l+=h.offsetLeft||0;h=h.offsetParent}while(h);return{left:l,top:m}};b.util.animate=function(h){h||(h={});var m=+new Date,l=h.duration||500,n=m+l,c,d,k=h.onChange||function(){},o=h.easing||function(q){return-Math.cos(q*Math.PI)/2+0.5},s="startValue"in h?h.startValue:0,r="endValue"in h?h.endValue:100,t=s>r;h.onStart&&h.onStart();var p=setInterval(function(){c=+new Date;d=c>n?
1:(c-m)/l;k(t?s-(s-r)*o(d):s+(r-s)*o(d));if(c>n){clearInterval(p);h.onComplete&&h.onComplete()}},10)};(function(){function h(){}var m=function(){for(var l=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],n=l.length;n--;)try{if(l[n]())return l[n]}catch(c){}}();b.util.request=function(l,n){n||(n={});var c=n.method?n.method.toUpperCase():"GET",
d=n.onComplete||function(){},k=m(),o;k.onreadystatechange=function(){if(k.readyState===4){d(k);k.onreadystatechange=h}};if(c==="GET"){o=null;if(typeof n.parameters=="string")l=l+(/\?/.test(l)?"&":"?")+n.parameters}k.open(c,l,true);if(c==="POST"||c==="PUT")k.setRequestHeader("Content-Type","application/x-www-form-urlencoded");k.send(o);return k}})();(function(){var h=Math.PI/180;b.util.removeFromArray=function(m,l){var n=m.indexOf(l);n!==-1&&m.splice(n,1);return m};b.util.degreesToRadians=function(m){return m*
h};b.util.toFixed=function(m,l){return parseFloat(Number(m).toFixed(l))};b.util.getRandomInt=function(m,l){return Math.floor(Math.random()*(l-m+1))+m}})()})(this);
(function(){var e=this.fabric||(this.fabric={}),f={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};e.parseTransformAttribute=function(){function a(n,c){var d=c[0];n[0]=Math.cos(d);n[1]=Math.sin(d);n[2]=-Math.sin(d);n[3]=Math.cos(d)}function b(n,c){var d=c.length===2?c[1]:c[0];n[0]=c[0];n[3]=d}function g(n,c){n[4]=c[0];if(c.length===2)n[5]=c[1]}var h=[1,0,0,1,0,0],m=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
l=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(n){var c=h.concat();if(!n||n&&!m.test(n))return c;n.replace(l,function(d){var k=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(d).filter(function(o){return o!==
""&&o!=null});d=k[1];k=k.slice(2).map(parseFloat);switch(d){case "translate":g(c,k);break;case "rotate":a(c,k);break;case "scale":b(c,k);break;case "skewX":c[2]=k[0];break;case "skewY":c[1]=k[0];break;case "matrix":c=k;break}});return c}}();e.parseSVGDocument=function(){var a=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,b=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(g,h){if(g){var m=e.util.toArray(g.getElementsByTagName("*")).filter(function(o){var s;if(s=a.test(o.tagName)){a:{for(o=o;o&&(o=o.parentNode);)if(o.nodeName==="pattern"){o=true;break a}o=false}s=!o}return s});if(!(!m||m&&!m.length)){var l=g.getAttribute("viewBox"),n=g.getAttribute("width"),c=g.getAttribute("height"),d=null,k=null;if(l&&(l=l.match(b))){parseInt(l[1],10);parseInt(l[2],10);d=parseInt(l[3],10);k=parseInt(l[4],10)}d=n?parseFloat(n):d;k=c?parseFloat(c):k;l={width:d,height:k};
m=e.parseElements(m,e.util.object.clone(l));!m||m&&!m.length||h&&h(m,l)}}}}();e.util.object.extend(e,{parseAttributes:function(a,b){if(a){var g,h,m={};if(a.parentNode&&/^g$/i.test(a.parentNode.nodeName))m=e.parseAttributes(a.parentNode,b);var l=b.reduce(function(n,c){g=a.getAttribute(c);h=parseFloat(g);if(g){if((c==="fill"||c==="stroke")&&g==="none")g="";if(c==="fill-rule")g=g==="evenodd"?"destination-over":g;if(c==="transform")g=e.parseTransformAttribute(g);if(c in f)c=f[c];n[c]=isNaN(h)?g:h}return n},
{});l=e.util.object.extend(e.parseStyleAttribute(a),l);return e.util.object.extend(m,l)}},parseElements:function(a,b){var g=a.map(function(h){var m=e[e.util.string.capitalize(h.tagName)];if(m&&m.fromElement)try{return m.fromElement(h,b)}catch(l){console.log(l.message||l)}});return g=g.filter(function(h){return h!=null})},parseStyleAttribute:function(a){var b={};if(a=a.getAttribute("style"))if(typeof a=="string"){a=a.split(";");a.pop();b=a.reduce(function(h,m){var l=m.split(":"),n=l[0].trim();l=l[1].trim();
h[n]=l;return h},{})}else for(var g in a)if(typeof a[g]!=="undefined")b[g]=a[g];return b},parsePointsAttribute:function(a){if(!a)return null;a=a.trim().split(/\s+/);a=a.reduce(function(b,g){g=g.split(",");b.push({x:parseFloat(g[0]),y:parseFloat(g[1])});return b},[]);if(a.length%2!==0)return null;return a}})})();
(function(){function e(a,b){arguments.length>0&&this.init(a,b)}var f=this.fabric||(this.fabric={});if(f.Point)console.warn("fabric.Point is already defined");else{e.prototype={constructor:e,init:function(a,b){this.x=a;this.y=b},add:function(a){return new e(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new e(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new e(this.x-a.x,
this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(a){return new e(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new e(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new e(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x==a.x&&this.y==a.y},lt:function(a){return this.x<
a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,b){return new e(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},distanceFrom:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},min:function(a){return new e(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new e(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+
","+this.y},setXY:function(a,b){this.x=a;this.y=b},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var b=this.x,g=this.y;this.x=a.x;this.y=a.y;a.x=b;a.y=g}};f.Point=e}})();
(function(){function e(a){arguments.length>0&&this.init(a)}var f=this.fabric||(this.fabric={});if(f.Intersection)console.warn("fabric.Intersection is already defined");else{e.prototype.init=function(a){this.status=a;this.points=[]};e.prototype.appendPoint=function(a){this.points.push(a)};e.prototype.appendPoints=function(a){this.points=this.points.concat(a)};e.intersectLineLine=function(a,b,g,h){var m,l=(h.x-g.x)*(a.y-g.y)-(h.y-g.y)*(a.x-g.x);m=(b.x-a.x)*(a.y-g.y)-(b.y-a.y)*(a.x-g.x);g=(h.y-g.y)*
(b.x-a.x)-(h.x-g.x)*(b.y-a.y);if(g!=0){l=l/g;m=m/g;if(0<=l&&l<=1&&0<=m&&m<=1){m=new e("Intersection");m.points.push(new f.Point(a.x+l*(b.x-a.x),a.y+l*(b.y-a.y)))}else m=new e("No Intersection")}else m=l==0||m==0?new e("Coincident"):new e("Parallel");return m};e.intersectLinePolygon=function(a,b,g){for(var h=new e("No Intersection"),m=g.length,l=0;l<m;l++){var n=e.intersectLineLine(a,b,g[l],g[(l+1)%m]);h.appendPoints(n.points)}if(h.points.length>0)h.status="Intersection";return h};e.intersectPolygonPolygon=
function(a,b){for(var g=new e("No Intersection"),h=a.length,m=0;m<h;m++){var l=e.intersectLinePolygon(a[m],a[(m+1)%h],b);g.appendPoints(l.points)}if(g.points.length>0)g.status="Intersection";return g};e.intersectPolygonRectangle=function(a,b,g){var h=b.min(g),m=b.max(g);g=new f.Point(m.x,h.y);var l=new f.Point(h.x,m.y);b=e.intersectLinePolygon(h,g,a);g=e.intersectLinePolygon(g,m,a);m=e.intersectLinePolygon(m,l,a);a=e.intersectLinePolygon(l,h,a);h=new e("No Intersection");h.appendPoints(b.points);
h.appendPoints(g.points);h.appendPoints(m.points);h.appendPoints(a.points);if(h.points.length>0)h.status="Intersection";return h};f.Intersection=e}})();
(function(){function e(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}var f=this.fabric||(this.fabric={});if(f.Color)console.warn("fabric.Color is already defined.");else{f.Color=e;e.prototype._tryParsingColor=function(a){var b=e.sourceFromHex(a);b||(b=e.sourceFromRgb(a));b&&this.setSource(b)};e.prototype.getSource=function(){return this._source};e.prototype.setSource=function(a){this._source=a};e.prototype.toRgb=function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"};
e.prototype.toRgba=function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"};e.prototype.toHex=function(){var a=this.getSource(),b=a[0].toString(16);b=b.length==1?"0"+b:b;var g=a[1].toString(16);g=g.length==1?"0"+g:g;a=a[2].toString(16);a=a.length==1?"0"+a:a;return b.toUpperCase()+g.toUpperCase()+a.toUpperCase()};e.prototype.getAlpha=function(){return this.getSource()[3]};e.prototype.setAlpha=function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this};e.prototype.toGrayscale=
function(){var a=this.getSource(),b=parseInt((a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this};e.prototype.toBlackWhite=function(a){var b=this.getSource(),g=(b[0]*0.3+b[1]*0.59+b[2]*0.11).toFixed(0);b=b[3];a=a||127;g=Number(g)<Number(a)?0:255;this.setSource([g,g,g,b]);return this};e.prototype.overlayWith=function(a){a=new e(a);var b=[],g=this.getAlpha(),h=this.getSource();a=a.getSource();for(var m=0;m<3;m++)b.push(Math.round(h[m]*0.5+a[m]*0.5));b[4]=g;this.setSource(b);
return this};e.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;e.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;e.fromRgb=function(a){return e.fromSource(e.sourceFromRgb(a))};e.sourceFromRgb=function(a){if(a=a.match(e.reRGBa))return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10),a[4]?parseFloat(a[4]):1]};e.fromRgba=e.fromRgb;e.fromHex=function(a){return e.fromSource(e.sourceFromHex(a))};e.sourceFromHex=function(a){if(a.match(e.reHex)){var b=a.slice(a.indexOf("#")+
1),g=b.length===3;a=g?b.charAt(0)+b.charAt(0):b.substring(0,2);var h=g?b.charAt(1)+b.charAt(1):b.substring(2,4);b=g?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(h,16),parseInt(b,16),1]}};e.fromSource=function(a){var b=new e;b.setSource(a);return b}}})();
(function(){var e=this.window,f=e.document,a=fabric.util.string.capitalize,b=fabric.util.string.camelize,g=this.Canvas||(this.Canvas={});if(fabric.Element)console.warn("fabric.Element is already defined.");else{var h=Error("Could not initialize `canvas` element"),m=fabric.util.getPointer,l={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};(function(){var c=f.createElement("canvas"),d,k,o;c.width=c.height=300;if(c.getContext)if(k=
c.getContext("2d")){d=new Date;for(o=200;o--;)k.clearRect(0,0,300,300);k=new Date-d;d=new Date;for(o=200;o--;)c.width=c.height;if(new Date-d<k)return"width"}})();var n=function(){var c=f.createElement("canvas");if(c&&c.getContext)if(c=c.getContext("2d")){try{c.fillStyle="transparent";return true}catch(d){}return false}}();fabric.Element=function(c,d){this._groupSelector=null;this._aObjects=[];this._activeGroup=this._currentTransform=this._oElement=this._oContext=null;this._oConfig={width:300,height:150};
d=d||{};this._initElement(c);this._initConfig(d);d.overlayImage&&this.setOverlayImage(d.overlayImage);if(d.afterRender)this.afterRender=d.afterRender;this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};fabric.util.object.extend(fabric.Element.prototype,{selectionColor:"rgba(100,100,255,0.3)",selectionBorderColor:"rgba(255,255,255,0.3)",selectionLineWidth:1,backgroundColor:"rgba(255,255,255,1)",includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,
CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},calcOffset:function(){this._offset=fabric.util.getElementOffset(this.getElement());return this},setOverlayImage:function(c,d){if(c){var k=this,o=new Image;o.onload=function(){k.overlayImage=o;d&&d();o=o.onload=null};o.src=c}return this},_initElement:function(c){this._oElement=fabric.util.getById(c)||f.createElement("canvas");typeof this._oElement.getContext==="undefined"&&G_vmlCanvasManager.initElement(this._oElement);if(typeof this._oElement.getContext===
"undefined")throw h;if(!(this._oContextTop=this._oElement.getContext("2d")))throw h;c=this._oElement.width||0;var d=this._oElement.height||0;this._initWrapperElement(c,d);this._setElementStyle(c,d)},_initWrapperElement:function(c,d){var k=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(k,{width:c+"px",height:d+"px"});fabric.util.makeElementUnselectable(k);this.wrapper=k},_setElementStyle:function(c,d){fabric.util.setStyle(this.getElement(),{position:"absolute",
width:c+"px",height:d+"px",left:0,top:0})},_initConfig:function(c){fabric.util.object.extend(this._oConfig,c||{});this._oConfig.width=parseInt(this._oElement.width,10)||0;this._oConfig.height=parseInt(this._oElement.height,10)||0;this._oElement.style.width=this._oConfig.width+"px";this._oElement.style.height=this._oConfig.height+"px"},_initEvents:function(){var c=this;this._onMouseDown=function(d){c.__onMouseDown(d)};this._onMouseUp=function(d){c.__onMouseUp(d)};this._onMouseMove=function(d){c.__onMouseMove(d)};
this._onResize=function(){c.calcOffset()};fabric.util.addListener(this._oElement,"mousedown",this._onMouseDown);fabric.util.addListener(f,"mousemove",this._onMouseMove);fabric.util.addListener(f,"mouseup",this._onMouseUp);fabric.util.addListener(e,"resize",this._onResize)},_createCanvasElement:function(c){var d=f.createElement("canvas");if(d){d.className=c;c=this._oElement.parentNode.insertBefore(d,this._oElement);c.width=this.getWidth();c.height=this.getHeight();c.style.width=this.getWidth()+"px";
c.style.height=this.getHeight()+"px";c.style.position="absolute";c.style.left=0;c.style.top=0;typeof d.getContext==="undefined"&&G_vmlCanvasManager.initElement(d);if(typeof d.getContext==="undefined")throw h;fabric.util.makeElementUnselectable(c);return c}},_createCanvasContainer:function(){var c=this._createCanvasElement("canvas-container");this._oContextContainerEl=c;this._oContextContainer=c.getContext("2d")},_createCanvasBackground:function(){var c=this._createCanvasElement("canvas-container");
this._oContextBackgroundEl=c;this._oContextBackground=c.getContext("2d")},getWidth:function(){return this._oConfig.width},getHeight:function(){return this._oConfig.height},setWidth:function(c){return this._setDimension("width",c)},setHeight:function(c){return this._setDimension("height",c)},setDimensions:function(c){for(var d in c)this._setDimension(d,c[d]);return this},_setDimension:function(c,d){this._oContextContainerEl[c]=d;this._oContextContainerEl.style[c]=d+"px";this._oContextBackgroundEl[c]=
d;this._oContextBackgroundEl.style[c]=d+"px";this._oElement[c]=d;this._oElement.style[c]=d+"px";this._oElement.parentNode.style[c]=d+"px";this._oConfig[c]=d;this.calcOffset();this.renderAll();return this},__onMouseUp:function(c){if(this._currentTransform){var d=this._currentTransform.target;if(d.__scaling){fabric.util.fireEvent("object:scaled",{target:d});d.__scaling=false}for(var k=0,o=this._aObjects.length;k<o;++k)this._aObjects[k].setCoords();if(d.hasStateChanged()){d.isMoving=false;fabric.util.fireEvent("object:modified",
{target:d})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(c);if(k=this.getActiveGroup()){k.hasStateChanged()&&k.containsPoint(this.getPointer(c))&&fabric.util.fireEvent("group:modified",{target:k});k.setObjectsCoords();k.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(c,d);this._setCursor("");var s=this;setTimeout(function(){s._setCursorFromEvent(c,d)},50)},shouldClearSelection:function(c){var d=this.findTarget(c),
k=this.getActiveGroup();return!d||d&&k&&!k.contains(d)&&k!==d&&!c.shiftKey},__onMouseDown:function(c){if(!this._currentTransform){var d=this.findTarget(c),k=this.getPointer(c),o=this.getActiveGroup();if(this.shouldClearSelection(c)){this._groupSelector={ex:k.x,ey:k.y,top:0,left:0};this.deactivateAllWithDispatch()}else{d.saveState();d._findTargetCorner(c,this._offset)&&this.onBeforeScaleRotate(d);this._setupCurrentTransform(c,d);if(c.shiftKey&&(o||this.getActiveObject()))this._handleGroupLogic(c,d);
else{d!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(d)}}this.renderAll()}},getElement:function(){return this._oElement},deactivateAllWithDispatch:function(){var c=this.getActiveGroup();c&&fabric.util.fireEvent("before:group:destroyed",{target:c});this.deactivateAll();c&&fabric.util.fireEvent("after:group:destroyed");fabric.util.fireEvent("selection:cleared");return this},_setupCurrentTransform:function(c,d){var k="drag",o,s=m(c);if(o=d._findTargetCorner(c,this._offset))k=/ml|mr/.test(o)?
"scaleX":/mt|mb/.test(o)?"scaleY":"rotate";this._currentTransform={target:d,action:k,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:s.x-d.left,offsetY:s.y-d.top,ex:s.x,ey:s.y,left:d.left,top:d.top,theta:d.theta,width:d.width*d.scaleX};this._currentTransform.original={left:d.left,top:d.top}},_handleGroupLogic:function(c,d){if(d.isType("group")){d=this.findTarget(c,true);if(!d||d.isType("group"))return}var k=this.getActiveGroup();if(k){if(k.contains(d)){k.remove(d);d.setActive(false);k.size()===1&&this.removeActiveGroup()}else k.add(d);
fabric.util.fireEvent("group:selected",{target:k});k.setActive(true)}else{if(this._activeObject)if(d!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,d]));k=this.getActiveGroup()}d.setActive(true)}k&&k.saveCoords()},__onMouseMove:function(c){if(this._groupSelector!==null){var d=m(c);this._groupSelector.left=d.x-this._offset.left-this._groupSelector.ex;this._groupSelector.top=d.y-this._offset.top-this._groupSelector.ey;this.renderTop()}else if(this._currentTransform){d=
m(c);var k=d.x;d=d.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){c.shiftKey||this._rotateObject(k,d);this._scaleObject(k,d)}else if(this._currentTransform.action==="scaleX")this._scaleObject(k,d,"x");else this._currentTransform.action==="scaleY"?this._scaleObject(k,d,"y"):this._translateObject(k,d);this.renderAll()}else{k=this._oElement.style;if(d=this.findTarget(c)){this._setCursorFromEvent(c,d);d.isActive()&&d.setCornersVisibility&&d.setCornersVisibility(true)}else{for(c=
this._aObjects.length;c--;)this._aObjects[c].active||this._aObjects[c].setActive(false);k.cursor="default"}}},_translateObject:function(c,d){var k=this._currentTransform.target;k.set("left",c-this._currentTransform.offsetX);k.set("top",d-this._currentTransform.offsetY)},_scaleObject:function(c,d,k){var o=Math.sqrt(Math.pow(this._currentTransform.ey-this._currentTransform.top-this._offset.top,2)+Math.pow(this._currentTransform.ex-this._currentTransform.left-this._offset.left,2));c=Math.sqrt(Math.pow(d-
this._currentTransform.top-this._offset.top,2)+Math.pow(c-this._currentTransform.left-this._offset.left,2));d=this._currentTransform.target;d.__scaling=true;if(k)if(k==="x")d.set("scaleX",this._currentTransform.scaleX*c/o);else k==="y"&&d.set("scaleY",this._currentTransform.scaleY*c/o);else{d.set("scaleX",this._currentTransform.scaleX*c/o);d.set("scaleY",this._currentTransform.scaleY*c/o)}},_rotateObject:function(c,d){var k=Math.atan2(this._currentTransform.ey-this._currentTransform.top-this._offset.top,
this._currentTransform.ex-this._currentTransform.left-this._offset.left);this._currentTransform.target.set("theta",Math.atan2(d-this._currentTransform.top-this._offset.top,c-this._currentTransform.left-this._offset.left)-k+this._currentTransform.theta)},_setCursor:function(c){this._oElement.style.cursor=c},_setCursorFromEvent:function(c,d){var k=this._oElement.style;if(d){var o=this.getActiveGroup();if(o=!!d._findTargetCorner&&(!o||!o.contains(d))&&d._findTargetCorner(c,this._offset))if(o in l)k.cursor=
l[o];else{k.cursor="default";return false}else k.cursor="move"}else{k.cursor="default";return false}return true},_draw:function(c,d){d&&d.render(c)},_drawSelection:function(){var c=this._groupSelector.left,d=this._groupSelector.top,k=Math.abs(c),o=Math.abs(d);this._oContextTop.fillStyle=this.selectionColor;this._oContextTop.fillRect(this._groupSelector.ex-(c>0?0:-c),this._groupSelector.ey-(d>0?0:-d),k,o);this._oContextTop.lineWidth=this.selectionLineWidth;this._oContextTop.strokeStyle=this.selectionBorderColor;
this._oContextTop.strokeRect(this._groupSelector.ex+0.5-(c>0?0:k),this._groupSelector.ey+0.5-(d>0?0:o),k,o)},_findSelectedObjects:function(){var c=[],d=this._groupSelector.ex,k=this._groupSelector.ey,o=d+this._groupSelector.left,s=k+this._groupSelector.top,r=new fabric.Point(Math.min(d,o),Math.min(k,s));k=new fabric.Point(Math.max(d,o),Math.max(k,s));o=0;for(s=this._aObjects.length;o<s;++o){d=this._aObjects[o];if(d.intersectsWithRect(r,k)||d.isContainedWithinRect(r,k)){d.setActive(true);c.push(d)}}if(c.length===
1){this.setActiveObject(c[0]);fabric.util.fireEvent("object:selected",{target:c[0]})}else if(c.length>1){c=new fabric.Group(c);this.setActiveGroup(c);c.saveCoords();fabric.util.fireEvent("group:selected",{target:c})}this.renderAll()},add:function(){this._aObjects.push.apply(this._aObjects,arguments);this.renderAll();return this},insertAt:function(c,d){this._aObjects.splice(d,0,c);this.renderAll();return this},getObjects:function(){return this._aObjects},getContext:function(){return this._oContextTop},
clearContext:function(c){c.clearRect(0,0,this._oConfig.width,this._oConfig.height);return this},clear:function(){this._aObjects.length=0;this.clearContext(this._oContextTop);this.clearContext(this._oContextContainer);this.renderAll();return this},renderAll:function(c){var d=this._oConfig.width,k=this._oConfig.height,o=c?this._oContextTop:this._oContextContainer;this.clearContext(this._oContextTop);o!==this._oContextTop&&this.clearContext(o);if(c){if(!n&&this.backgroundColor==="transparent")var s=
true;if(!s)o.fillStyle=this.backgroundColor;o.fillRect(0,0,d,k)}c=this._aObjects.length;d=this.getActiveGroup();if(c)for(k=0;k<c;++k)if(!d||d&&!d.contains(this._aObjects[k]))this._draw(o,this._aObjects[k]);d&&this._draw(this._oContextTop,d);this.overlayImage&&this._oContextTop.drawImage(this.overlayImage,0,0);this.afterRender&&this.afterRender();return this},renderTop:function(){this.clearContext(this._oContextTop);this.overlayImage&&this._oContextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&
this._drawSelection();var c=this.getActiveGroup();c&&c.render(this._oContextTop);this.afterRender&&this.afterRender();return this},containsPoint:function(c,d){var k=this.getPointer(c),o=this._normalizePointer(d,k);k=o.x;o=o.y;var s=d._getImageLines(d.oCoords);if((k=d._findCrossPoints(k,o,s))&&k%2===1||d._findTargetCorner(c,this._offset))return true;return false},_normalizePointer:function(c,d){var k=this.getActiveGroup(),o=d.x,s=d.y;if(k&&c.type!=="group"&&k.contains(c)){o-=k.left;s-=k.top}return{x:o,
y:s}},findTarget:function(c,d){var k;this.getPointer(c);var o=this.getActiveGroup();if(o&&!d&&this.containsPoint(c,o))return k=o;for(o=this._aObjects.length;o--;)if(this.containsPoint(c,this._aObjects[o])){this.relatedTarget=k=this._aObjects[o];break}return k},toDataURL:function(c){var d;c||(c="png");if(c==="jpeg"||c==="png"){this.renderAll(true);d=this.getElement().toDataURL("image/"+c)}return d},toDataURLWithMultiplier:function(c,d){var k=this.getWidth(),o=this.getHeight(),s=k*d,r=o*d,t=this.getActiveObject();
this.setWidth(s).setHeight(r);this._oContextTop.scale(d,d);t&&this.deactivateAll().renderAll();s=this.toDataURL(c);this._oContextTop.scale(1/d,1/d);this.setWidth(k).setHeight(o);t&&this.setActiveObject(t);this.renderAll();return s},getPointer:function(c){c=m(c);return{x:c.x-this._offset.left,y:c.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(c){c.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(c){var d=
this,k=new APE.anim.Animation,o=c.get("left"),s=d.getCenter().left-o;k.run=function(r){c.set("left",o+s*r);d.renderAll()};k.onend=function(){c.setCoords()};k.duration=500;k.transition=APE.anim.Transitions.decel;k.start();return this},centerObjectV:function(c){c.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(c){var d=this,k=new APE.anim.Animation,o=c.get("top"),s=d.getCenter().top-o;k.run=function(r){c.set("top",o+s*r).setCoords();d.renderAll()};k.onend=function(){c.setCoords()};
k.duration=500;k.transition=APE.anim.Transitions.decel;k.start()},straightenObject:function(c){c.straighten();this.renderAll();return this},fxStraightenObject:function(c){c.fxStraighten({onChange:this.renderAll.bind(this)});return this},toJSON:function(){return JSON.stringify(this.toObject())},toDatalessJSON:function(){return JSON.stringify(this.toDatalessObject())},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},
_toObjectMethod:function(c){return{objects:this._aObjects.map(function(d){if(!this.includeDefaultValues){var k=d.includeDefaultValues;d.includeDefaultValues=false}var o=d[c]();if(!this.includeDefaultValues)d.includeDefaultValues=k;return o},this),background:this.backgroundColor}},isEmpty:function(){return this._aObjects.length===0},loadFromJSON:function(c,d){if(c){var k=JSON.parse(c);if(!(!k||k&&!k.objects)){this.clear();var o=this;this._enlivenObjects(k.objects,function(){o.backgroundColor=k.background;
d&&d()});return this}}},_enlivenObjects:function(c,d){var k=0,o=c.filter(function(r){return r.type==="image"}).length,s=this;c.forEach(function(r){if(r.type)switch(r.type){case "image":case "font":fabric[a(r.type)].fromObject(r,function(p){s.add(p);++k===o&&d&&d()});break;default:var t=fabric[b(a(r.type))];t&&t.fromObject&&s.add(t.fromObject(r));break}});o===0&&d&&d()},loadFromDatalessJSON:function(c,d){if(c){var k=typeof c==="string"?c.evalJSON():c;if(!(!k||k&&!k.objects)){this.clear();this._enlivenDatalessObjects(k.objects,
d)}}},_enlivenDatalessObjects:function(c,d){function k(p,q){o.insertAt(p,q);p.setCoords();++s===r&&d&&d()}var o=this,s=0,r=c.length;try{c.forEach(function(p,q){var v=p.paths?"paths":"path",u=p[v];delete p[v];if(typeof u!=="string")switch(p.type){case "image":case "text":g[p.type.capitalize()].fromObject(p,function(w){k(w,q)});break;default:(v=g[p.type.capitalize().camelize()])&&v.fromObject&&k(v.fromObject(p),q);break}else if(p.type==="image")o.loadImageFromURL(u,function(w){w.setSourcePath(u);fabric.util.object.extend(w,
p);w.setAngle(p.angle);k(w,q)});else if(p.type==="text"){p.path=u;var x=fabric.Text.fromObject(p);e.__context=o;fabric.util.getScript(u,function(){Prototype.Browser.Opera?setTimeout(function(){k(x,q)},500):k(x,q)})}else o.loadSVGFromURL(u,function(w){w=w.length>1?new fabric.PathGroup(w,p):w[0];w.setSourcePath(u);if(!(w instanceof fabric.PathGroup)){fabric.util.object.extend(w,p);typeof p.angle!=="undefined"&&w.setAngle(p.angle)}k(w,q)})},this)}catch(t){console.log(t.message)}},loadImageFromURL:function(){var c=
{};return function(d,k){function o(){var t=f.getElementById(c[d]);t.width&&t.height?k(new fabric.Image(t)):setTimeout(o,50)}var s=this;if(c[d])o();else{var r=new Image;r.onload=function(){r.onload=null;s._resizeImageToFit(r);var t=new fabric.Image(r);k(t)};r.className="canvas-img-clone";r.src=d;if(this.shouldCacheImages)c[d]=Element.identify(r);f.body.appendChild(r)}}}(),loadSVGFromURL:function(c,d){function k(r){if(r=r.responseXML)(r=r.documentElement)&&fabric.parseSVGDocument(r,function(t,p){s.cache.set(c,
{objects:t.invoke("toObject"),options:p});d(t,p)})}function o(){console.log("ERROR!")}var s=this;c=c.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(c,function(r){if(r)s.cache.get(c,function(t){t=s._enlivenCachedObject(t);d(t.objects,t.options)});else new Ajax.Request(c,{method:"get",onComplete:k,onFailure:o})})},_enlivenCachedObject:function(c){var d=c.objects;c=c.options;d=d.map(function(k){return g[k.type.capitalize()].fromObject(k)});return{objects:d,options:c}},remove:function(c){fabric.util.removeFromArray(this._aObjects,
c);this.renderAll();return c},fxRemove:function(c,d){var k=this;c.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){k.remove(c);typeof d==="function"&&d()}});return this},sendToBack:function(c){fabric.util.removeFromArray(this._aObjects,c);this._aObjects.unshift(c);return this.renderAll()},bringToFront:function(c){fabric.util.removeFromArray(this._aObjects,c);this._aObjects.push(c);return this.renderAll()},sendBackwards:function(c){var d=this._aObjects.indexOf(c),k=d;if(d!==0){for(d=
d-1;d>=0;--d)if(c.intersectsWithObject(this._aObjects[d])){k=d;break}fabric.util.removeFromArray(this._aObjects,c);this._aObjects.splice(k,0,c)}return this.renderAll()},bringForward:function(c){var d=this.getObjects(),k=d.indexOf(c),o=k;if(k!==d.length-1){k=k+1;for(var s=this._aObjects.length;k<s;++k)if(c.intersectsWithObject(d[k])){o=k;break}fabric.util.removeFromArray(d,c);d.splice(o,0,c)}this.renderAll()},setActiveObject:function(c){this._activeObject&&this._activeObject.setActive(false);this._activeObject=
c;c.setActive(true);this.renderAll();fabric.util.fireEvent("object:selected",{target:c});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;return this},setActiveGroup:function(c){this._activeGroup=c;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var c=this.getActiveGroup();c&&c.destroy();return this.setActiveGroup(null)},item:function(c){return this.getObjects()[c]},
deactivateAll:function(){for(var c=this.getObjects(),d=0,k=c.length;d<k;d++)c[d].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(c,d){c+=d.complexity?d.complexity():0;return c},0)},dispose:function(){this.clear();fabric.util.removeListener(this.getElement(),"mousedown",this._onMouseDown);fabric.util.removeListener(f,"mouseup",this._onMouseUp);fabric.util.removeListener(f,"mousemove",this._onMouseMove);
fabric.util.removeListener(e,"resize",this._onResize);return this},clone:function(c){var d=f.createElement("canvas");d.width=this.getWidth();d.height=this.getHeight();var k=this.__clone||(this.__clone=new fabric.Element(d));return k.loadFromJSON(this.toJSON(),function(){c&&c(k)})},_toDataURL:function(c,d){this.clone(function(k){d(k.toDataURL(c))})},_toDataURLWithMultiplier:function(c,d,k){this.clone(function(o){k(o.toDataURLWithMultiplier(c,d))})},_resizeImageToFit:function(c){var d=c.width||c.offsetWidth,
k=c.height||c.offsetHeight,o=this.getWidth()/d,s=this.getHeight()/k;if(d&&k){c.width=d*o;c.height=k*s}},cache:{has:function(c,d){d(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};fabric.util.object.extend(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(c){var d=c.getContext("2d");c=d.getImageData(0,0,c.width,c.height);var k=
c.data,o=c.width,s=c.height,r,t;for(i=0;i<o;i++)for(j=0;j<s;j++){r=i*4*s+j*4;t=(k[r]+k[r+1]+k[r+2])/3;k[r]=t;k[r+1]=t;k[r+2]=t}d.putImageData(c,0,0)},supports:function(c){var d=f.createElement("canvas");if(!d||!d.getContext)return null;var k=d.getContext("2d");if(!k)return null;switch(c){case "getImageData":return typeof k.getImageData!=="undefined";case "toDataURL":return typeof d.toDataURL!=="undefined";default:return null}}})}})();
(function(){var e=this.fabric||(this.fabric={});if(!e.Object){var f=Array.prototype.slice;e.Object=e.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,
theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,f.call(arguments,1)):b.call(this)},initialize:function(a){this.setOptions(a);this._importProperties();this.originalState=
{};this.setCoords();this.saveState()},setOptions:function(a){this.options=e.util.object.extend(this._getOptions(),a)},_getOptions:function(){return e.util.object.extend(e.util.object.clone(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?this.setAngle(this.options[a]):
this[a]=this.options[a]},this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){var a=e.util.toFixed;a={type:this.type,left:a(this.left,this.NUM_FRACTION_DIGITS),top:a(this.top,this.NUM_FRACTION_DIGITS),width:a(this.width,this.NUM_FRACTION_DIGITS),height:a(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,
overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,scaleX:a(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:a(this.scaleY,this.NUM_FRACTION_DIGITS),angle:a(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var b=e.Object.prototype.options;this.stateProperties.forEach(function(g){a[g]===
b[g]&&delete a[g]});return a},isActive:function(){return!!this.active},setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+e.util.string.capitalize(this.type)+">"},set:function(a,b){if((a==="scaleX"||a==="scaleY")&&b<this.MIN_SCALE_LIMIT)b=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(b);else this[a]=b;return this},toggle:function(a){var b=this.get(a);typeof b==="boolean"&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},
get:function(a){return a==="angle"?this.getAngle():this[a]},render:function(a,b){if(!(this.width===0||this.height===0)){a.save();var g=this.transformMatrix;g&&a.setTransform(g[0],g[1],g[2],g[3],g[4],g[5]);b||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a);if(this.active&&!b){this.drawBorders(a);this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*
this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(a){this.scaleY=this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=
this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,b=Math.sin(this._angle+this.theta)*this._hypotenuse,g=this.theta,h=Math.sin(g);g=Math.cos(g);a={x:this.left-a,y:this.top-b};b={x:a.x+this.currentWidth*g,y:a.y+this.currentWidth*h};var m={x:a.x-this.currentHeight*h,y:a.y+this.currentHeight*g};this.oCoords={tl:a,tr:b,br:{x:b.x-
this.currentHeight*h,y:b.y+this.currentHeight*g},bl:m,ml:{x:a.x-this.currentHeight/2*h,y:a.y+this.currentHeight/2*g},mt:{x:a.x+this.currentWidth/2*g,y:a.y+this.currentWidth/2*h},mr:{x:b.x-this.currentHeight/2*h,y:b.y+this.currentHeight/2*g},mb:{x:m.x+this.currentWidth/2*g,y:m.y+this.currentWidth/2*h}};this._setCornerCoords();return this},drawBorders:function(a){var b=this.options,g=b.padding,h=g*2;a.save();a.globalAlpha=this.isMoving?b.borderOpacityWhenMoving:1;a.strokeStyle=b.borderColor;b=1/(this.scaleX<
this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var m=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(b,m);b=this.getWidth();m=this.getHeight();a.strokeRect(Math.floor(-(b/2)-g)+0.5,Math.floor(-(m/2)-g)+0.5,Math.floor(b+h),Math.floor(m+h));a.restore();return this},drawCorners:function(a){var b=this.options.cornersize,g=b/2,h=this.options.padding,m=-(this.width/2),l=-(this.height/2),n=b/this.scaleX,c=b/this.scaleY,d=(h+g)/this.scaleY,
k=(h+g)/this.scaleX,o=(h+g-b)/this.scaleX;h=(h+g-b)/this.scaleY;a.save();a.globalAlpha=this.isMoving?this.options.borderOpacityWhenMoving:1;a.fillStyle=this.options.cornerColor;b=m-k;g=l-d;a.fillRect(b,g,n,c);b=m+this.width-k;g=l-d;a.fillRect(b,g,n,c);b=m-k;g=l+this.height+h;a.fillRect(b,g,n,c);b=m+this.width+o;g=l+this.height+h;a.fillRect(b,g,n,c);b=m+this.width/2-k;g=l-d;a.fillRect(b,g,n,c);b=m+this.width/2-k;g=l+this.height+h;a.fillRect(b,g,n,c);b=m+this.width+o;g=l+this.height/2-d;a.fillRect(b,
g,n,c);b=m-k;g=l+this.height/2-d;a.fillRect(b,g,n,c);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),a);return new e.Object(this.toObject())},cloneAsImage:function(a){if(e.Image){var b=new Image;b.onload=function(){a&&a(new e.Image(b),g);b=b.onload=null};var g={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);b.src=this.toDataURL()}return this},
toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();e.util.wrapElement(a,"div");var b=new e.Element(a);b.backgroundColor="transparent";b.renderAll();var g=this.clone();g.left=a.width/2;g.top=a.height/2;g.setActive(false);b.add(g);a=b.toDataURL("png");b.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=
this.get(a)},this);return this},intersectsWithRect:function(a,b){var g=this.oCoords,h=new e.Point(g.tl.x,g.tl.y),m=new e.Point(g.tr.x,g.tr.y),l=new e.Point(g.bl.x,g.bl.y);g=new e.Point(g.br.x,g.br.y);return e.Intersection.intersectPolygonRectangle([h,m,g,l],a,b).status==="Intersection"},intersectsWithObject:function(a){function b(h){return{tl:new e.Point(h.tl.x,h.tl.y),tr:new e.Point(h.tr.x,h.tr.y),bl:new e.Point(h.bl.x,h.bl.y),br:new e.Point(h.br.x,h.br.y)}}var g=b(this.oCoords);a=b(a.oCoords);return e.Intersection.intersectPolygonPolygon([g.tl,
g.tr,g.br,g.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,b){var g=this.oCoords,h=new e.Point(g.tl.x,g.tl.y),m=new e.Point(g.tr.x,g.tr.y),l=new e.Point(g.bl.x,g.bl.y);new e.Point(g.br.x,g.br.y);return h.x>a.x&&m.x<b.x&&h.y>a.y&&l.y<b.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,b){var g=e.util.getPointer(a),h=g.x-b.left;g=g.y-b.top;var m;for(var l in this.oCoords){m=this._getImageLines(this.oCoords[l].corner,l);m=this._findCrossPoints(h,
g,m);if(m%2==1&&m!=0)return this.__corner=l}return false},_findCrossPoints:function(a,b,g){var h,m,l,n=0;for(var c in g){l=g[c];if(!(l.o.y<b&&l.d.y<b))if(!(l.o.y>=b&&l.d.y>=b)){if(l.o.x==l.d.x&&l.o.x>=a)h=l.o.x;else{h=(l.d.y-l.o.y)/(l.d.x-l.o.x);m=b-0*a;l=l.o.y-h*l.o.x;h=-(m-l)/(0-h)}if(h>=a)n+=1;if(n==2)break}}return n},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,
b=this.theta,g=this.cornersize*Math.cos(b),h=this.cornersize*Math.sin(b);b=this.cornersize/2;var m=b-h;a.tl.x-=m;a.tl.y-=b;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+g,y:a.tl.y+h},bl:{x:a.tl.x-h,y:a.tl.y+g}};a.tl.corner.br={x:a.tl.corner.tr.x-h,y:a.tl.corner.tr.y+g};a.tl.x+=m;a.tl.y+=b;a.tr.x+=b;a.tr.y-=b;a.tr.corner={tl:{x:a.tr.x-g,y:a.tr.y-h},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-h,y:a.tr.y+g}};a.tr.corner.bl={x:a.tr.corner.tl.x-h,y:a.tr.corner.tl.y+g};a.tr.x-=b;a.tr.y+=b;a.bl.x-=b;a.bl.y+=
b;a.bl.corner={tl:{x:a.bl.x+h,y:a.bl.y-g},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+g,y:a.bl.y+h}};a.bl.corner.tr={x:a.bl.corner.br.x+h,y:a.bl.corner.br.y-g};a.bl.x+=b;a.bl.y-=b;a.br.x+=b;a.br.y+=b;a.br.corner={tr:{x:a.br.x+h,y:a.br.y-g},bl:{x:a.br.x-g,y:a.br.y-h},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+h,y:a.br.corner.bl.y-g};a.br.x-=b;a.br.y-=b;a.ml.x-=b;a.ml.y-=b;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+g,y:a.ml.y+h},bl:{x:a.ml.x-h,y:a.ml.y+g}};a.ml.corner.br={x:a.ml.corner.tr.x-
h,y:a.ml.corner.tr.y+g};a.ml.x+=b;a.ml.y+=b;a.mt.x-=b;a.mt.y-=b;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+g,y:a.mt.y+h},bl:{x:a.mt.x-h,y:a.mt.y+g}};a.mt.corner.br={x:a.mt.corner.tr.x-h,y:a.mt.corner.tr.y+g};a.mt.x+=b;a.mt.y+=b;a.mr.x-=b;a.mr.y-=b;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+g,y:a.mr.y+h},bl:{x:a.mr.x-h,y:a.mr.y+g}};a.mr.corner.br={x:a.mr.corner.tr.x-h,y:a.mr.corner.tr.y+g};a.mr.x+=b;a.mr.y+=b;a.mb.x-=b;a.mb.y-=b;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+g,y:a.mb.y+
h},bl:{x:a.mb.x-h,y:a.mb.y+g}};a.mb.corner.br={x:a.mb.corner.tr.x-h,y:a.mb.corner.tr.y+g};a.mb.x+=b;a.mb.y+=b;a=a.mb.corner;a.tl.x-=b;a.tl.y-=b;a.tr.x-=b;a.tr.y-=b;a.br.x-=b;a.br.y-=b;a.bl.x-=b;a.bl.y-=b},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new e.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());
return this},fxStraighten:function(a){a=a||{};var b=function(){},g=a.onComplete||b,h=a.onChange||b,m=this;e.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){m.setAngle(l);h()},onComplete:function(){m.setCoords();g()},onStart:function(){m.setActive(false)}});return this},fxRemove:function(a){a||(a={});var b=function(){},g=a.onComplete||b,h=a.onChange||b,m=this;e.util.animate({startValue:this.get("opacity"),endValue:0,
duration:this.FX_DURATION,onChange:function(l){m.set("opacity",l);h()},onComplete:g,onStart:function(){m.setActive(false)}});return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0}});e.Object.prototype.rotate=e.Object.prototype.setAngle}})();
(function(){var e=this.fabric||(this.fabric={});if(!e.Line){e.Line=e.util.createClass(e.Object,{type:"line",initialize:function(f,a){f||(f=[0,0,0,0]);this.callSuper("initialize",a);this.set("x1",f[0]);this.set("y1",f[1]);this.set("x2",f[2]);this.set("y2",f[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(f){f.beginPath();f.moveTo(-this.width/2,-this.height/2);f.lineTo(this.width/2,
this.height/2);var a=f.strokeStyle;f.strokeStyle=f.fillStyle;f.stroke();f.strokeStyle=a},complexity:function(){return 1},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});e.Element.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");e.Line.fromElement=function(f,a){var b=e.parseAttributes(f,e.Element.ATTRIBUTE_NAMES);return new e.Line([b.x1||0,b.y1||0,b.x2||0,b.y2||0],e.util.object.extend(b,
a))};e.Line.fromObject=function(f){return new e.Line([f.x1,f.y1,f.x2,f.y2],f)}}})();
(function(){var e=this.fabric||(this.fabric={}),f=Math.PI*2;if(e.Circle)console.warn("fabric.Circle is already defined.");else{e.Circle=e.util.createClass(e.Object,{type:"circle",initialize:function(a){a=a||{};this.set("radius",a.radius||0);this.callSuper("initialize",a);a=this.get("radius")*2*this.get("scaleX");this.set("width",a).set("height",a)},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(a){a.beginPath();a.arc(0,0,this.radius,
0,f,false);this.fill&&a.fill();this.stroke&&a.stroke()},complexity:function(){return 1}});e.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");e.Circle.fromElement=function(a,b){var g=e.parseAttributes(a,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in g&&g.radius>0))throw Error("value of `r` attribute is required and can not be negative");return new e.Circle(e.util.object.extend(g,b))};e.Circle.fromObject=function(a){return new e.Circle(a)}}})();
(function(){var e=this.fabric||(this.fabric={});if(!e.Triangle){e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(f){f=f||{};this.callSuper("initialize",f);this.set("width",f.width||100).set("height",f.height||100)},_render:function(f){f.beginPath();f.moveTo(-this.width/2,this.height/2);f.lineTo(0,-this.height/2);f.lineTo(this.width/2,this.height/2);this.fill&&f.fill();this.stroke&&f.stroke()},complexity:function(){return 1}});e.Triangle.fromObject=function(f){return new e.Triangle(f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(e.Ellipse)console.warn("fabric.Ellipse is already defined.");else{e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",initialize:function(f){f=f||{};this.callSuper("initialize",f);this.set("rx",f.rx||0);this.set("ry",f.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(f,a){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",f,a)},_render:function(f){f.beginPath();f.save();f.transform(1,0,0,this.ry/this.rx,0,0);f.arc(0,0,this.rx,0,Math.PI*2,false);f.restore();this.stroke&&f.stroke();this.fill&&f.fill()},complexity:function(){return 1}});e.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");e.Ellipse.fromElement=function(f,a){var b=e.parseAttributes(f,e.Ellipse.ATTRIBUTE_NAMES);return new e.Ellipse(e.util.object.extend(b,a))};e.Ellipse.fromObject=
function(f){return new e.Ellipse(f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(!e.Rect){e.Rect=e.util.createClass(e.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(f){this.callSuper("initialize",f);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(f){var a=this.options.rx||0,b=this.options.ry||0,g=-this.width/2,h=-this.height/2,m=this.width,l=this.height;f.beginPath();
f.moveTo(g+a,h);f.lineTo(g+m-a,h);f.bezierCurveTo(g+m,h,g+m,h+b,g+m,h+b);f.lineTo(g+m,h+l-b);f.bezierCurveTo(g+m,h+l,g+m-a,h+l,g+m-a,h+l);f.lineTo(g+a,h+l);f.bezierCurveTo(g,h+l,g,h+l-b,g,h+l-b);f.lineTo(g,h+b);f.bezierCurveTo(g,h,g+a,h,g+a,h);f.closePath();this.fill&&f.fill();this.stroke&&f.stroke()},_normalizeLeftTopProperties:function(f){f.left&&this.set("left",f.left+this.getWidth()/2);f.top&&this.set("top",f.top+this.getHeight()/2);return this},complexity:function(){return 1}});e.Rect.ATTRIBUTE_NAMES=
"x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");e.Rect.fromElement=function(f,a){if(!f)return null;var b=e.parseAttributes(f,e.Rect.ATTRIBUTE_NAMES);b=b;b.left=b.left||0;b.top=b.top||0;b=b;var g=new e.Rect(e.util.object.extend(a||{},b));g._normalizeLeftTopProperties(b);return g};e.Rect.fromObject=function(f){return new e.Rect(f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(e.Polyline)console.warn("fabric.Polyline is already defined");else{e.Polyline=e.util.createClass(e.Object,{type:"polyline",initialize:function(a,b){b=b||{};this.set("points",a);this.callSuper("initialize",b);this._calcDimensions()},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},_toOrigin:function(){return e.Polygon.prototype._toOrigin.call(this)},toObject:function(){return e.Polygon.prototype.toObject.call(this)},
_render:function(a){var b;a.beginPath();for(var g=0,h=this.points.length;g<h;g++){b=this.points[g];a.lineTo(b.x,b.y)}this.fill&&a.fill();this.stroke&&a.stroke()},complexity:function(){return this.get("points").length}});var f="fill fill-opacity stroke stroke-width transform".split(" ");e.Polyline.fromElement=function(a,b){if(!a)return null;var g=e.parsePointsAttribute(a.getAttribute("points")),h=e.parseAttributes(a,f);return new e.Polyline(g,e.util.object.extend(h,b))};e.Polyline.fromObject=function(a){return new e.Polyline(a.points,
a)}}})();
(function(){var e=this.fabric||(this.fabric={});if(e.Polygon)console.warn("fabric.Polygon is already defined");else{e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(f,a){a=a||{};this.points=f;this.callSuper("initialize",a);this._calcDimensions()},_calcDimensions:function(){var f=this.points,a=e.util.array.min(f,"x"),b=e.util.array.min(f,"y"),g=e.util.array.max(f,"x");f=e.util.array.max(f,"y");this.width=g-a;this.height=f-b;this.minX=a;this.minY=b},_toOrigin:function(){this.points=this.points.map(function(f){return{x:f.x-
this.minX,y:f.y-this.minY}},this)},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{points:this.points.concat()})},_render:function(f){var a;f.beginPath();for(var b=0,g=this.points.length;b<g;b++){a=this.points[b];f.lineTo(a.x,a.y)}this.fill&&f.fill();if(this.stroke){f.closePath();f.stroke()}},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");e.Polygon.fromElement=function(f,a){if(!f)return null;
var b=e.parsePointsAttribute(f.getAttribute("points")),g=e.parseAttributes(f,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(b,e.util.object.extend(g,a))};e.Polygon.fromObject=function(f){return new e.Polygon(f.points,f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(e.Path)console.warn("fabric.Path is already defined");else if(e.Object){e.Path=e.util.createClass(e.Object,{type:"path",initialize:function(a,b){b=b||{};this.setOptions(b);this._importProperties();this.originalState={};if(!a)throw Error("`path` argument is required");var g=Object.prototype.toString.call(a)==="[object Array]";if(this.path=g?a:a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g)){g||this._initializeFromArray(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)}},
_initializeFromArray:function(a){var b="width"in a;a="height"in a;this.path=this._parsePath();if(!b||!a){e.util.object.extend(this,this._parseDimensions());if(b)this.width=this.options.width;if(a)this.height=this.options.height}},_render:function(a){for(var b,g=0,h=0,m=0,l=0,n,c,d=-(this.width/2),k=-(this.height/2),o=0,s=this.path.length;o<s;++o){b=this.path[o];switch(b[0]){case "l":g+=b[1];h+=b[2];a.lineTo(g+d,h+k);break;case "L":g=b[1];h=b[2];a.lineTo(g+d,h+k);break;case "h":g+=b[1];a.lineTo(g+
d,h+k);break;case "H":g=b[1];a.lineTo(g+d,h+k);break;case "v":h+=b[1];a.lineTo(g+d,h+k);break;case "V":h=b[1];a.lineTo(g+d,h+k);break;case "m":g+=b[1];h+=b[2];a.moveTo(g+d,h+k);break;case "M":g=b[1];h=b[2];a.moveTo(g+d,h+k);break;case "c":n=g+b[5];c=h+b[6];m=g+b[3];l=h+b[4];a.bezierCurveTo(g+b[1]+d,h+b[2]+k,m+d,l+k,n+d,c+k);g=n;h=c;break;case "C":g=b[5];h=b[6];m=b[3];l=b[4];a.bezierCurveTo(b[1]+d,b[2]+k,m+d,l+k,g+d,h+k);break;case "s":n=g+b[3];c=h+b[4];m=2*g-m;l=2*h-l;a.bezierCurveTo(m+d,l+k,g+b[1]+
d,h+b[2]+k,n+d,c+k);g=n;h=c;break;case "S":n=b[3];c=b[4];m=2*g-m;l=2*h-l;a.bezierCurveTo(m+d,l+k,b[1]+d,b[2]+k,n+d,c+k);g=n;h=c;break;case "q":g+=b[3];h+=b[4];a.quadraticCurveTo(b[1]+d,b[2]+k,g+d,h+k);break;case "Q":g=b[3];h=b[4];m=b[1];l=b[2];a.quadraticCurveTo(m+d,l+k,g+d,h+k);break;case "T":n=g;c=h;g=b[1];h=b[2];m=-m+2*n;l=-l+2*c;a.quadraticCurveTo(m+d,l+k,g+d,h+k);break;case "a":break;case "A":break;case "z":case "Z":a.closePath();break}}},render:function(a,b){a.save();var g=this.transformMatrix;
g&&a.transform(g[0],g[1],g[2],g[3],g[4],g[5]);b||this.transform(a);if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;if(this.stroke)a.strokeStyle=this.stroke;a.beginPath();this.stub?this.stub._render(a):this._render(a);this.fill&&a.fill();if(this.options.stroke){a.strokeStyle=this.options.stroke;a.lineWidth=this.options.strokeWidth;a.stroke()}if(!b&&this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()},toString:function(){return"#<fabric.Path ("+
this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var a=e.util.object.extend(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)a.sourcePath=this.sourcePath;if(this.transformMatrix)a.transformMatrix=this.transformMatrix;return a},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.path=this.sourcePath;delete a.sourcePath;return a},complexity:function(){return this.path.length},set:function(a,b){this.stub&&this.stub.set(a,
b);return this.callSuper("set",a,b)},_parsePath:function(){for(var a=[],b,g,h=0,m=this.path.length;h<m;h++){b=this.path[h];g=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);a.push([b.charAt(0)].concat(g.map(parseFloat)))}return a},_parseDimensions:function(){function a(r){if(r[0]==="H")return r[1];return r[r.length-2]}function b(r){if(r[0]==="V")return r[1];return r[r.length-1]}var g=[],h=[],m,l,n=false,c,d;this.path.forEach(function(r,t){if(r[0]!=="H")m=t===0?a(r):a(this.path[t-1]);
if(r[0]!=="V")l=t===0?b(r):b(this.path[t-1]);if(r[0]===r[0].toLowerCase())n=true;c=n?m+a(r):r[0]==="V"?m:a(r);d=n?l+b(r):r[0]==="H"?l:b(r);var p=parseInt(c,10);isNaN(p)||g.push(p);p=parseInt(d,10);isNaN(p)||h.push(p)},this);var k=e.util.array.min(g),o=e.util.array.min(h),s=deltaY=0;k={top:o-deltaY,left:k-s,bottom:e.util.array.max(h)-deltaY,right:e.util.array.max(g)-s};k.width=k.right-k.left;k.height=k.bottom-k.top;return k}});e.Path.fromObject=function(a){return new e.Path(a.path,a)};var f=e.Path.ATTRIBUTE_NAMES=
"d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");e.Path.fromElement=function(a,b){var g=e.parseAttributes(a,f),h=g.d;delete g.d;return new e.Path(h,e.util.object.extend(g,b))}}else console.warn("fabric.Path requires fabric.Object")})();
(function(){var e=this.fabric||(this.fabric={});if(e.PathGroup)console.warn("fabric.PathGroup is already defined");else{e.PathGroup=e.util.createClass(e.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(f,a){a=a||{};this.originalState={};this.paths=f;this.setOptions(a);this.initProperties();this.setCoords();a.sourcePath&&this.setSourcePath(a.sourcePath)},initProperties:function(){this.stateProperties.forEach(function(f){if(f==="fill")this.set(f,this.options[f]);else if(f==="angle")this.setAngle(this.options[f]);
else this[f]=this.options[f]},this)},render:function(f){if(this.stub){f.save();this.transform(f);this.stub.render(f,false);if(this.active){this.drawBorders(f);this.drawCorners(f)}}else{f.save();var a=this.transformMatrix;a&&f.transform(a[0],a[1],a[2],a[3],a[4],a[5]);this.transform(f);a=0;for(var b=this.paths.length;a<b;++a)this.paths[a].render(f,true);if(this.active){this.drawBorders(f);this.hideCorners||this.drawCorners(f)}}f.restore()},set:function(f,a){if((f==="fill"||f==="overlayFill")&&this.isSameColor()){this[f]=
a;for(var b=this.paths.length;b--;)this.paths[b].set(f,a)}else e.Object.prototype.set.call(this,f,a);return this},toObject:function(){return e.util.object.extend(e.Object.prototype.toObject.call(this),{paths:e.util.array.invoke(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var f=this.toObject();if(this.sourcePath)f.paths=this.sourcePath;return f},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},
isSameColor:function(){var f=this.getObjects()[0].get("fill");return this.getObjects().every(function(a){return a.get("fill")===f})},complexity:function(){return this.paths.reduce(function(f,a){return f+(a&&a.complexity?a.complexity():0)},0)},toGrayscale:function(){for(var f=this.paths.length;f--;)this.paths[f].toGrayscale();return this},getObjects:function(){return this.paths}});e.PathGroup.fromObject=function(f){for(var a=f.paths,b=0,g=a.length;b<g;b++)if(!(a[b]instanceof e.Object)){var h=a[b].type.camelize().capitalize();
a[b]=Canvas[h].fromObject(a[b])}return new e.PathGroup(a,f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(!e.Group){e.Group=e.util.createClass(e.Object,{type:"group",initialize:function(f,a){this.objects=f||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&e.util.object.extend(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var f=this.left,a=this.top;this.forEachObject(function(b){var g=b.get("left"),h=b.get("top");
b.set("originalLeft",g);b.set("originalTop",h);b.set("left",g-f);b.set("top",h-a);b.setCoords();b.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(f){this._restoreObjectsState();this.objects.push(f);f.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(f){this._restoreObjectsState();e.util.removeFromArray(this.objects,f);f.setActive(false);this._calcBounds();
this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(f,a){if(typeof a=="function")this.set(f,a(this[f]));else if(f==="fill"||f==="opacity"){var b=this.objects.length;for(this[f]=a;b--;)this.objects[b].set(f,a)}else this[f]=a;return this},contains:function(f){return this.objects.indexOf(f)>-1},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{objects:e.util.array.invoke(this.objects,"clone")})},render:function(f){f.save();
this.transform(f);for(var a=Math.max(this.scaleX,this.scaleY),b=0,g=this.objects.length;b<g;b++){var h=this.objects[b].borderScaleFactor;this.objects[b].borderScaleFactor=a;this.objects[b].render(f);this.objects[b].borderScaleFactor=h}this.hideBorders||this.drawBorders(f);this.hideCorners||this.drawCorners(f);f.restore();this.setCoords()},item:function(f){return this.getObjects()[f]},complexity:function(){return this.getObjects().reduce(function(f,a){f+=typeof a.complexity=="function"?a.complexity():
0;return f},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(f){var a=this.get("left"),b=this.get("top"),g=this.getAngle()*(Math.PI/180);f.get("originalLeft");f.get("originalTop");var h=Math.cos(g)*f.get("top")+Math.sin(g)*f.get("left");g=-Math.sin(g)*f.get("top")+Math.cos(g)*f.get("left");f.setAngle(f.getAngle()+this.getAngle());f.set("left",a+g*this.get("scaleX"));f.set("top",b+h*this.get("scaleY"));f.set("scaleX",
f.get("scaleX")*this.get("scaleX"));f.set("scaleY",f.get("scaleY")*this.get("scaleY"));f.setCoords();f.hideCorners=false;f.setActive(false);f.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(f){f.setCoords()});
return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(f){this.forEachObject(function(a){a.setActive(f)});return this},forEachObject:function(f,a){for(var b=this.getObjects(),g=b.length;g--;)f.call(a,b[g],g,b);return this},_setOpacityIfSame:function(){var f=this.getObjects(),a=f[0]?f[0].get("opacity"):1;if(f.every(function(b){return b.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var f=[],a=[],b,g;g=0;for(var h=this.objects.length;g<h;++g){b=this.objects[g];
b.setCoords();for(var m in b.oCoords){f.push(b.oCoords[m].x);a.push(b.oCoords[m].y)}}b=e.util.array.min(f);g=e.util.array.max(f);f=e.util.array.min(a);a=e.util.array.max(a);g=g-b;a=a-f;this.width=g;this.height=a;this.left=b+g/2;this.top=f+a/2},containsPoint:function(f){var a=this.get("width")/2,b=this.get("height")/2,g=this.get("left"),h=this.get("top");return g-a<f.x&&g+a>f.x&&h-b<f.y&&h+b>f.y},toGrayscale:function(){for(var f=this.objects.length;f--;)this.objects[f].toGrayscale()}});e.Group.fromObject=
function(f){return new e.Group(f.objects,f)}}})();
(function(){var e=this.fabric||(this.fabric={});if(e.Text)console.warn("fabric.Text is already defined");else if(e.Object){e.Text=e.util.createClass(e.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(f,a){this.originalState={};this.initStateProperties();this.text=f;this.setOptions(a);e.util.object.extend(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},initStateProperties:function(){var f;
if((f=this.constructor)&&(f=f.superclass)&&(f=f.prototype)&&(f=f.stateProperties)&&f.clone){this.stateProperties=f.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(f){var a=Cufon.textOptions||(Cufon.textOptions={});a.left=this.left;a.top=this.top;a.context=f;a.color=this.fill;var b=this._initDummyElement();this.transform(f);Cufon.replaceElement(b,
{separate:"none",fontFamily:this.fontfamily});this.width=a.width;this.height=a.height},_initDummyElement:function(){var f=document.createElement("div");f.innerHTML=this.text;f.style.fontSize="40px";f.style.fontWeight="400";f.style.fontStyle="normal";f.style.letterSpacing="normal";f.style.color="#000000";f.style.fontWeight="600";f.style.fontFamily="Verdana";return f},render:function(f){f.save();this._render(f);if(this.active){this.drawBorders(f);this.drawCorners(f)}f.restore()},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),
{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(f){this.set("fill",f);return this},setFontsize:function(f){this.set("fontsize",f);this.setCoords();return this},getText:function(){return this.text},setText:function(f){this.set("text",f);this.setCoords();return this},set:function(f,a){this[f]=a;if(f==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+a+"$3");return this}});e.Text.fromObject=function(f){return new e.Text(f.text,
e.util.object.clone(f))};e.Text.fromElement=function(){}}else console.warn("fabric.Text requires fabric.Object")})();
(function(){if(!this.fabric)this.fabric={};if(this.fabric.Image)console.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(e,f){this.callSuper("initialize",f);this._initElement(e);this._initConfig(f||{})},getElement:function(){return this._element},setElement:function(e){this._element=e;return this},
getNormalizedSize:function(e,f,a){if(a&&f&&e.width>e.height&&e.width/e.height<f/a){normalizedWidth=Math.floor(e.width*a/e.height);normalizedHeight=a}else if(a&&(e.height==e.width||e.height>e.width||e.height>a)){normalizedWidth=Math.floor(e.width*a/e.height);normalizedHeight=a}else if(f&&f<e.width){normalizedHeight=Math.floor(e.height*f/e.width);normalizedWidth=f}else{normalizedWidth=e.width;normalizedHeight=e.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var e=
this.getElement();return{width:e.width,height:e.height}},setBorderVisibility:function(e){this._resetWidthHeight();this._adjustWidthHeightToBorders(e);this.setCoords()},setCornersVisibility:function(e){this.cornervisibility=!!e},render:function(e,f){e.save();f||this.transform(e);this._render(e);if(this.active&&!f){this.drawBorders(e);this.hideCorners||this.drawCorners(e)}e.restore()},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},
toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(e){this.constructor.fromObject(this.toObject(),e)},toGrayscale:function(e){if(!this.__isGrayscaled){var f=this.getElement(),a=document.createElement("canvas"),b=document.createElement("img"),g=this;a.width=f.width;a.height=f.height;a.getContext("2d").drawImage(f,0,0);fabric.Element.toGrayscale(a);b.onload=function(){g.setElement(b);e&&e();b.onload=a=f=imageData=null};b.width=f.width;b.height=f.height;b.src=a.toDataURL("image/png");
this.__isGrayscaled=true;return this}},_render:function(e){var f=this.getOriginalSize();e.drawImage(this.getElement(),-f.width/2,-f.height/2,f.width,f.height)},_adjustWidthHeightToBorders:function(e){if(e){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width);this.set("height",e.height)},_initElement:function(e){this.setElement(fabric.util.getById(e));
fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){this.setOptions(e);this._setBorder();this._setWidthHeight(e)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var e=2*this.currentBorder;this.width=(this.getElement().width||0)+e;this.height=(this.getElement().height||0)+e}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(e,f){var a=document.createElement("img"),b=e.src;if(e.width)a.width=
e.width;if(e.height)a.height=e.height;a.onload=function(){f&&f(new fabric.Image(a,e));a=a.onload=null};a.src=b};fabric.Image.fromURL=function(e,f,a){var b=document.createElement("img");b.onload=function(){f&&f(new fabric.Image(b,a));b=b.onload=null};b.src=e}}else console.warn("fabric.Object is required for fabric.Image initialization")})();
