if(typeof console=="undefined")var console={log:function(){},warn:function(){}};if(!this.JSON)this.JSON={};
(function(){function g(h){return h<10?"0"+h:h}function o(h){k.lastIndex=0;return k.test(h)?'"'+h.replace(k,function(n){var q=a[n];return typeof q==="string"?q:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function d(h,n){var q,r,s,x,t=e,v,u=n[h];if(u&&typeof u==="object"&&typeof u.toJSON==="function")u=u.toJSON(h);if(typeof c==="function")u=c.call(n,h,u);switch(typeof u){case "string":return o(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);
case "object":if(!u)return"null";e+=b;v=[];if(Object.prototype.toString.apply(u)==="[object Array]"){x=u.length;for(q=0;q<x;q+=1)v[q]=d(q,u)||"null";s=v.length===0?"[]":e?"[\n"+e+v.join(",\n"+e)+"\n"+t+"]":"["+v.join(",")+"]";e=t;return s}if(c&&typeof c==="object"){x=c.length;for(q=0;q<x;q+=1){r=c[q];if(typeof r==="string")if(s=d(r,u))v.push(o(r)+(e?": ":":")+s)}}else for(r in u)if(Object.hasOwnProperty.call(u,r))if(s=d(r,u))v.push(o(r)+(e?": ":":")+s);s=v.length===0?"{}":e?"{\n"+e+v.join(",\n"+e)+
"\n"+t+"}":"{"+v.join(",")+"}";e=t;return s}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var m=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,b,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,n,q){var r;b=e="";if(typeof q==="number")for(r=0;r<q;r+=1)b+=" ";else if(typeof q==="string")b=q;if((c=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return d("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,n){function q(s,x){var t,v,u=s[x];if(u&&typeof u==="object")for(t in u)if(Object.hasOwnProperty.call(u,t)){v=q(u,t);if(v!==undefined)u[t]=v;else delete u[t]}return n.call(s,x,u)}var r;h=String(h);m.lastIndex=0;if(m.test(h))h=h.replace(m,function(s){return"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+h+")");return typeof n==="function"?q({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
(function(){function g(k,e){for(var b in e)k[b]=e[b];return k}function o(k,e){var b=document.createElement(k);for(var a in e)if(a==="class")b.className=e[a];else if(a==="for")b.htmlFor=e[a];else b.setAttribute(a,e[a]);return b}var d=this.fabric||(this.fabric={}),m=Array.prototype.slice;d.util={};(function(){var k=Math.PI/180;d.util.removeFromArray=function(e,b){var a=e.indexOf(b);a!==-1&&e.splice(a,1);return e};d.util.degreesToRadians=function(e){return e*k};d.util.toFixed=function(e,b){return parseFloat(Number(e).toFixed(b))};
d.util.getRandomInt=function(e,b){return Math.floor(Math.random()*(b-e+1))+e};d.util.falseFunction=function(){return false}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(k,e){var b=this.length>>>0;e=Number(e)||0;e=Math[e<0?"ceil":"floor"](e);if(e<0)e+=b;for(;e<b;e++)if(e in this&&this[e]===k)return e;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(k,e){for(var b=0,a=this.length>>>0;b<a;b++)b in this&&k.call(e,this[b],b,this)};if(!Array.prototype.map)Array.prototype.map=
function(k,e){for(var b=[],a=0,c=this.length>>>0;a<c;a++)if(a in this)b[a]=k.call(e,this[a],a,this);return b};if(!Array.prototype.every)Array.prototype.every=function(k,e){for(var b=0,a=this.length>>>0;b<a;b++)if(b in this&&!k.call(e,this[b],b,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(k,e){for(var b=0,a=this.length>>>0;b<a;b++)if(b in this&&k.call(e,this[b],b,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(k,e){for(var b=
[],a,c=0,h=this.length>>>0;c<h;c++)if(c in this){a=this[c];k.call(e,a,c,this)&&b.push(a)}return res};if(!Array.prototype.reduce)Array.prototype.reduce=function(k){var e=this.length>>>0,b=0,a;if(arguments.length>1)a=arguments[1];else{do{if(b in this){a=this[b++];break}if(++b>=e)throw new TypeError;}while(1)}for(;b<e;b++)if(b in this)a=k.call(null,a,this[b],b,this);return a};d.util.array={invoke:function(k,e){for(var b=m.call(arguments,2),a=[],c=0,h=k.length;c<h;c++)a[c]=b.length?k[c][e].apply(k[c],
b):k[c][e].call(k[c]);return a},min:function(k,e){var b=k.length-1,a=e?k[b][e]:k[b];if(e)for(;b--;){if(k[b][e]<a)a=k[b][e]}else for(;b--;)if(k[b]<a)a=k[b];return a},max:function(k,e){var b=k.length-1,a=e?k[b][e]:k[b];if(e)for(;b--;){if(k[b][e]>=a)a=k[b][e]}else for(;b--;)if(k[b]>=a)a=k[b];return a}};d.util.object={extend:g,clone:function(k){return g({},k)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};d.util.string={camelize:function(k){return k.replace(/-+(.)?/g,
function(e,b){return b?b.toUpperCase():""})},capitalize:function(k){return k.charAt(0).toUpperCase()+k.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(k){var e=this,b=Array.prototype.slice.call(arguments,1);return function(){return e.apply(k,b.concat(Array.prototype.slice.call(arguments)))}};(function(){function k(){}var e;e=function(){for(var b in{toString:1})if(b==="toString")return false;return true}()?function(b,a){if(a.toString!==Object.prototype.toString)b.prototype.toString=
a.toString;if(a.valueOf!==Object.prototype.valueOf)b.prototype.valueOf=a.valueOf;for(var c in a)b.prototype[c]=a[c]}:function(b,a){for(var c in a)b.prototype[c]=a[c]};d.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var a=null,c=m.call(arguments,0);if(typeof c[0]==="function")a=c.shift();b.superclass=a;b.subclasses=[];if(a){k.prototype=a.prototype;b.prototype=new k;a.subclasses.push(b)}a=0;for(var h=c.length;a<h;a++)e(b,c[a]);if(!b.prototype.initialize)b.prototype.initialize=
emptyFunction;return b.prototype.constructor=b}})();(function(){function k(t){var v=Array.prototype.slice.call(arguments,1),u,y,D=v.length;for(y=0;y<D;y++){u=typeof t[v[y]];if(!/^(?:function|object|unknown)$/.test(u))return false}return true}function e(t,v){return function(u){v.call(c(t),u||window.event)}}function b(t,v){return function(u){if(s[t]&&s[t][v])for(var y=s[t][v],D=0,f=y.length;D<f;D++)y[D].call(this,u||window.event)}}var a=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(v){return v.uniqueID};
var t=0;return function(v){return v.__uniqueID||(v.__uniqueID="uniqueID__"+t++)}}(),c,h;(function(){var t={};c=function(v){return t[v]};h=function(v,u){t[v]=u}})();var n=k(document.documentElement,"addEventListener","removeEventListener")&&k(window,"addEventListener","removeEventListener"),q=k(document.documentElement,"attachEvent","detachEvent")&&k(window,"attachEvent","detachEvent"),r={},s={};if(n){addListener=function(t,v,u){t.addEventListener(v,u,false)};removeListener=function(t,v,u){t.removeEventListener(v,
u,false)}}else if(q){addListener=function(t,v,u){var y=a(t);h(y,t);r[y]||(r[y]={});r[y][v]||(r[y][v]=[]);u={handler:u,wrappedHandler:e(y,u)};r[y][v].push(u);t.attachEvent("on"+v,u.wrappedHandler)};removeListener=function(t,v,u){var y=a(t),D;if(r[y]&&r[y][v])for(var f=0,l=r[y][v].length;f<l;f++)if((D=r[y][v][f])&&D.handler===u){t.detachEvent("on"+v,D.wrappedHandler);r[y][v][f]=null}}}else{addListener=function(t,v,u){var y=a(t);s[y]||(s[y]={});if(!s[y][v]){s[y][v]=[];var D=t["on"+v];D&&s[y][v].push(D);
t["on"+v]=b(y,v)}s[y][v].push(u)};removeListener=function(t,v,u){t=a(t);if(s[t]&&s[t][v]){v=s[t][v];t=0;for(var y=v.length;t<y;t++)v[t]===u&&v.splice(t,1)}}}d.util.addListener=addListener;d.util.removeListener=removeListener;var x={};d.util.observeEvent=function(t,v){x[t]||(x[t]=[]);x[t].push(v)};d.util.fireEvent=function(t,v){var u=x[t];if(u)for(var y=0,D=u.length;y<D;y++)u[y]({memo:v})};d.util.getPointer=function(t){var v=document.documentElement,u=document.body||{scrollLeft:0},y=document.documentElement,
D=document.body||{scrollTop:0};return{x:t.pageX||t.clientX+(v.scrollLeft||u.scrollLeft)-(v.clientLeft||0),y:t.pageY||t.clientY+(y.scrollTop||D.scrollTop)-(y.clientTop||0)}}})(this);(function(){var k=document.createElement("div"),e=typeof k.style.filter==="string",b=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(c){return c};if(typeof k.style.opacity==="string")a=function(c,h){c.style.opacity=h;return c};else if(e)a=function(c,h){var n=c.style;if(c.currentStyle&&!c.currentStyle.hasLayout)n.zoom=
1;if(b.test(n.filter)){h=h>=0.9999?"":"alpha(opacity="+h*100+")";n.filter=n.filter.replace(b,h)}else n.filter+=" alpha(opacity="+h*100+")";return c};d.util.setStyle=function(c,h){var n=c.style;if(typeof h==="string"){c.style.cssText+=";"+h;return h.indexOf("opacity")>-1?a(c,h.match(/opacity:\s*(\d?\.?\d*)/)[1]):c}for(var q in h)if(q==="opacity")a(c,h[q]);else n[q==="float"||q==="cssFloat"?typeof n.styleFloat==="undefined"?"cssFloat":"styleFloat":q]=h[q];return c}})();(function(){var k=document.documentElement.style,
e="userSelect"in k?"userSelect":"MozUserSelect"in k?"MozUserSelect":"WebkitUserSelect"in k?"WebkitUserSelect":"KhtmlUserSelect"in k?"KhtmlUserSelect":"";d.util.makeElementUnselectable=function(b){if(typeof b.onselectstart!=="undefined")b.onselectstart=d.util.falseFunction;if(e)b.style[e]="none";else if(typeof b.unselectable=="string")b.unselectable="on";return b}})();(function(){function k(b,a){e.load(b);a()}d.util.getScript=function(b,a){var c=document.getElementsByTagName("head")[0],h=document.createElement("script"),
n=true;h.type="text/javascript";h.setAttribute("runat","server");h.onload=h.onreadystatechange=function(q){if(n)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){n=false;a(q||window.event);h=h.onload=h.onreadystatechange=null}};h.src=b;c.appendChild(h)};var e=this.Jaxer;if(e&&e.load)d.util.getScript=k})();d.util.getById=function(k){return typeof k==="string"?document.getElementById(k):k};d.util.toArray=function(k){for(var e=[],b=k.length;b--;)e[b]=k[b];
return e};d.util.makeElement=o;d.util.addClass=function(k,e){if((" "+k.className+" ").indexOf(" "+e+" ")===-1)k.className+=(k.className?" ":"")+e};d.util.wrapElement=function(k,e,b){if(typeof e==="string")e=o(e,b);k.parentNode&&k.parentNode.replaceChild(e,k);e.appendChild(k);return e};d.util.getElementOffset=function(k){var e=0,b=0;do{e+=k.offsetTop||0;b+=k.offsetLeft||0;k=k.offsetParent}while(k);return{left:b,top:e}};d.util.animate=function(k){k||(k={});var e=+new Date,b=k.duration||500,a=e+b,c,
h,n=k.onChange||function(){},q=k.easing||function(v){return-Math.cos(v*Math.PI)/2+0.5},r="startValue"in k?k.startValue:0,s="endValue"in k?k.endValue:100,x=r>s;k.onStart&&k.onStart();var t=setInterval(function(){c=+new Date;h=c>a?1:(c-e)/b;n(x?r-(r-s)*q(h):r+(s-r)*q(h));if(c>a){clearInterval(t);k.onComplete&&k.onComplete()}},10)};(function(){function k(){}var e=function(){for(var b=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},
function(){return new XMLHttpRequest}],a=b.length;a--;)try{if(b[a]())return b[a]}catch(c){}}();d.util.request=function(b,a){a||(a={});var c=a.method?a.method.toUpperCase():"GET",h=a.onComplete||function(){},n=e(),q;n.onreadystatechange=function(){if(n.readyState===4){h(n);n.onreadystatechange=k}};if(c==="GET"){q=null;if(typeof a.parameters=="string")b=b+(/\?/.test(b)?"&":"?")+a.parameters}n.open(c,b,true);if(c==="POST"||c==="PUT")n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
n.send(q);return n}})()})(this);
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.string.capitalize,m=g.util.object.clone,k={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};g.parseTransformAttribute=function(){function e(q,r){var s=r[0];q[0]=Math.cos(s);q[1]=Math.sin(s);q[2]=-Math.sin(s);q[3]=Math.cos(s)}function b(q,r){var s=r.length===2?r[1]:r[0];q[0]=r[0];q[3]=s}function a(q,r){q[4]=r[0];if(r.length===
2)q[5]=r[1]}var c=[1,0,0,1,0,0],h=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
n=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(q){var r=c.concat();if(!q||q&&!h.test(q))return r;q.replace(n,function(s){var x=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(s).filter(function(t){return t!==
""&&t!=null});s=x[1];x=x.slice(2).map(parseFloat);switch(s){case "translate":a(r,x);break;case "rotate":e(r,x);break;case "scale":b(r,x);break;case "skewX":r[2]=x[0];break;case "skewY":r[1]=x[0];break;case "matrix":r=x;break}});return r}}();g.parseSVGDocument=function(){var e=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,b=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(a,c){if(a){var h=g.util.toArray(a.getElementsByTagName("*")).filter(function(t){var v;if(v=e.test(t.tagName)){a:{for(t=t;t&&(t=t.parentNode);)if(t.nodeName==="pattern"){t=true;break a}t=false}v=!t}return v});if(!(!h||h&&!h.length)){var n=a.getAttribute("viewBox"),q=a.getAttribute("width"),r=a.getAttribute("height"),s=null,x=null;if(n&&(n=n.match(b))){parseInt(n[1],10);parseInt(n[2],10);s=parseInt(n[3],10);x=parseInt(n[4],10)}s=q?parseFloat(q):s;x=r?parseFloat(r):x;n={width:s,height:x};
h=g.parseElements(h,m(n));!h||h&&!h.length||c&&c(h,n)}}}}();o(g,{parseAttributes:function(e,b){if(e){var a,c,h={};if(e.parentNode&&/^g$/i.test(e.parentNode.nodeName))h=g.parseAttributes(e.parentNode,b);var n=b.reduce(function(q,r){a=e.getAttribute(r);c=parseFloat(a);if(a){if((r==="fill"||r==="stroke")&&a==="none")a="";if(r==="fill-rule")a=a==="evenodd"?"destination-over":a;if(r==="transform")a=g.parseTransformAttribute(a);if(r in k)r=k[r];q[r]=isNaN(c)?a:c}return q},{});n=o(g.parseStyleAttribute(e),
n);return o(h,n)}},parseElements:function(e,b){var a=e.map(function(c){var h=g[d(c.tagName)];if(h&&h.fromElement)try{return h.fromElement(c,b)}catch(n){console.log(n.message||n)}});return a=a.filter(function(c){return c!=null})},parseStyleAttribute:function(e){var b={};if(e=e.getAttribute("style"))if(typeof e=="string"){e=e.split(";");e.pop();b=e.reduce(function(c,h){var n=h.split(":"),q=n[0].trim();n=n[1].trim();c[q]=n;return c},{})}else for(var a in e)if(typeof e[a]!=="undefined")b[a]=e[a];return b},
parsePointsAttribute:function(e){if(!e)return null;e=e.trim().split(/\s+/);e=e.reduce(function(b,a){a=a.split(",");b.push({x:parseFloat(a[0]),y:parseFloat(a[1])});return b},[]);if(e.length%2!==0)return null;return e}})})();
(function(){function g(d,m){arguments.length>0&&this.init(d,m)}var o=this.fabric||(this.fabric={});if(o.Point)console.warn("fabric.Point is already defined");else{g.prototype={constructor:g,init:function(d,m){this.x=d;this.y=m},add:function(d){return new g(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new g(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new g(this.x-d.x,
this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new g(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new g(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new g(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return this.x==d.x&&this.y==d.y},lt:function(d){return this.x<
d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(d,m){return new g(this.x+(d.x-this.x)*m,this.y+(d.y-this.y)*m)},distanceFrom:function(d){var m=this.x-d.x;d=this.y-d.y;return Math.sqrt(m*m+d*d)},min:function(d){return new g(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new g(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+
","+this.y},setXY:function(d,m){this.x=d;this.y=m},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(d){var m=this.x,k=this.y;this.x=d.x;this.y=d.y;d.x=m;d.y=k}};o.Point=g}})();
(function(){function g(d){arguments.length>0&&this.init(d)}var o=this.fabric||(this.fabric={});if(o.Intersection)console.warn("fabric.Intersection is already defined");else{g.prototype.init=function(d){this.status=d;this.points=[]};g.prototype.appendPoint=function(d){this.points.push(d)};g.prototype.appendPoints=function(d){this.points=this.points.concat(d)};g.intersectLineLine=function(d,m,k,e){var b,a=(e.x-k.x)*(d.y-k.y)-(e.y-k.y)*(d.x-k.x);b=(m.x-d.x)*(d.y-k.y)-(m.y-d.y)*(d.x-k.x);k=(e.y-k.y)*
(m.x-d.x)-(e.x-k.x)*(m.y-d.y);if(k!=0){a=a/k;b=b/k;if(0<=a&&a<=1&&0<=b&&b<=1){b=new g("Intersection");b.points.push(new o.Point(d.x+a*(m.x-d.x),d.y+a*(m.y-d.y)))}else b=new g("No Intersection")}else b=a==0||b==0?new g("Coincident"):new g("Parallel");return b};g.intersectLinePolygon=function(d,m,k){for(var e=new g("No Intersection"),b=k.length,a=0;a<b;a++){var c=g.intersectLineLine(d,m,k[a],k[(a+1)%b]);e.appendPoints(c.points)}if(e.points.length>0)e.status="Intersection";return e};g.intersectPolygonPolygon=
function(d,m){for(var k=new g("No Intersection"),e=d.length,b=0;b<e;b++){var a=g.intersectLinePolygon(d[b],d[(b+1)%e],m);k.appendPoints(a.points)}if(k.points.length>0)k.status="Intersection";return k};g.intersectPolygonRectangle=function(d,m,k){var e=m.min(k),b=m.max(k);k=new o.Point(b.x,e.y);var a=new o.Point(e.x,b.y);m=g.intersectLinePolygon(e,k,d);k=g.intersectLinePolygon(k,b,d);b=g.intersectLinePolygon(b,a,d);d=g.intersectLinePolygon(a,e,d);e=new g("No Intersection");e.appendPoints(m.points);
e.appendPoints(k.points);e.appendPoints(b.points);e.appendPoints(d.points);if(e.points.length>0)e.status="Intersection";return e};o.Intersection=g}})();
(function(){function g(d){d?this._tryParsingColor(d):this.setSource([0,0,0,1])}var o=this.fabric||(this.fabric={});if(o.Color)console.warn("fabric.Color is already defined.");else{o.Color=g;g.prototype._tryParsingColor=function(d){var m=g.sourceFromHex(d);m||(m=g.sourceFromRgb(d));m&&this.setSource(m)};g.prototype.getSource=function(){return this._source};g.prototype.setSource=function(d){this._source=d};g.prototype.toRgb=function(){var d=this.getSource();return"rgb("+d[0]+","+d[1]+","+d[2]+")"};
g.prototype.toRgba=function(){var d=this.getSource();return"rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")"};g.prototype.toHex=function(){var d=this.getSource(),m=d[0].toString(16);m=m.length==1?"0"+m:m;var k=d[1].toString(16);k=k.length==1?"0"+k:k;d=d[2].toString(16);d=d.length==1?"0"+d:d;return m.toUpperCase()+k.toUpperCase()+d.toUpperCase()};g.prototype.getAlpha=function(){return this.getSource()[3]};g.prototype.setAlpha=function(d){var m=this.getSource();m[3]=d;this.setSource(m);return this};g.prototype.toGrayscale=
function(){var d=this.getSource(),m=parseInt((d[0]*0.3+d[1]*0.59+d[2]*0.11).toFixed(0),10);this.setSource([m,m,m,d[3]]);return this};g.prototype.toBlackWhite=function(d){var m=this.getSource(),k=(m[0]*0.3+m[1]*0.59+m[2]*0.11).toFixed(0);m=m[3];d=d||127;k=Number(k)<Number(d)?0:255;this.setSource([k,k,k,m]);return this};g.prototype.overlayWith=function(d){d=new g(d);var m=[],k=this.getAlpha(),e=this.getSource();d=d.getSource();for(var b=0;b<3;b++)m.push(Math.round(e[b]*0.5+d[b]*0.5));m[4]=k;this.setSource(m);
return this};g.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;g.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;g.fromRgb=function(d){return g.fromSource(g.sourceFromRgb(d))};g.sourceFromRgb=function(d){if(d=d.match(g.reRGBa))return[parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10),d[4]?parseFloat(d[4]):1]};g.fromRgba=g.fromRgb;g.fromHex=function(d){return g.fromSource(g.sourceFromHex(d))};g.sourceFromHex=function(d){if(d.match(g.reHex)){var m=d.slice(d.indexOf("#")+
1),k=m.length===3;d=k?m.charAt(0)+m.charAt(0):m.substring(0,2);var e=k?m.charAt(1)+m.charAt(1):m.substring(2,4);m=k?m.charAt(2)+m.charAt(2):m.substring(4,6);return[parseInt(d,16),parseInt(e,16),parseInt(m,16),1]}};g.fromSource=function(d){var m=new g;m.setSource(d);return m}}})();
(function(){if(fabric.Element)console.warn("fabric.Element is already defined.");else{var g=this.window,o=g.document,d=fabric.util.object.extend,m=fabric.util.string.capitalize,k=fabric.util.string.camelize,e=fabric.util.fireEvent,b=fabric.util.getPointer,a=fabric.util.getElementOffset,c=fabric.util.removeFromArray,h=fabric.util.addListener,n=fabric.util.removeListener,q=Math.sqrt,r=Math.pow,s=Math.atan2,x=Math.abs,t=Math.min,v=Math.max,u=Error("Could not initialize `canvas` element"),y={tr:"ne-resize",
br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},D=function(){var f=o.createElement("canvas");if(f&&f.getContext)if(f=f.getContext("2d")){try{f.fillStyle="transparent";return true}catch(l){}return false}}();fabric.Element=function(f,l){this._groupSelector=null;this._objects=[];this._activeGroup=this._currentTransform=this._element=this._context=null;this._config={width:300,height:150};l=l||{};this._initElement(f);this._initConfig(l);l.overlayImage&&
this.setOverlayImage(l.overlayImage);if(l.afterRender)this.afterRender=l.afterRender;this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};d(fabric.Element.prototype,{selectionColor:"rgba(100,100,255,0.3)",selectionBorderColor:"rgba(255,255,255,0.3)",selectionLineWidth:1,backgroundColor:"rgba(255,255,255,1)",includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},calcOffset:function(){this._offset=
a(this.getElement());return this},setOverlayImage:function(f,l){if(f){var p=this,w=new Image;w.onload=function(){p.overlayImage=w;l&&l();w=w.onload=null};w.src=f}return this},_initElement:function(f){this._element=fabric.util.getById(f)||o.createElement("canvas");typeof this._element.getContext==="undefined"&&G_vmlCanvasManager.initElement(this._element);if(typeof this._element.getContext==="undefined")throw u;if(!(this.contextTop=this._element.getContext("2d")))throw u;f=this._element.width||0;var l=
this._element.height||0;this._initWrapperElement(f,l);this._setElementStyle(f,l)},_initWrapperElement:function(f,l){var p=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(p,{width:f+"px",height:l+"px"});fabric.util.makeElementUnselectable(p);this.wrapper=p},_setElementStyle:function(f,l){fabric.util.setStyle(this.getElement(),{position:"absolute",width:f+"px",height:l+"px",left:0,top:0})},_initConfig:function(f){d(this._config,f||{});this._config.width=
parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var f=this;this._onMouseDown=function(l){f.__onMouseDown(l)};this._onMouseUp=function(l){f.__onMouseUp(l)};this._onMouseMove=function(l){f.__onMouseMove(l)};this._onResize=function(){f.calcOffset()};h(this._element,"mousedown",this._onMouseDown);h(o,"mousemove",this._onMouseMove);h(o,
"mouseup",this._onMouseUp);h(g,"resize",this._onResize)},_createCanvasElement:function(f){var l=o.createElement("canvas");if(l){l.className=f;f=this._element.parentNode.insertBefore(l,this._element);f.width=this.getWidth();f.height=this.getHeight();f.style.width=this.getWidth()+"px";f.style.height=this.getHeight()+"px";f.style.position="absolute";f.style.left=0;f.style.top=0;typeof l.getContext==="undefined"&&G_vmlCanvasManager.initElement(l);if(typeof l.getContext==="undefined")throw u;fabric.util.makeElementUnselectable(f);
return f}},_createCanvasContainer:function(){var f=this._createCanvasElement("canvas-container");this.contextContainerEl=f;this.contextContainer=f.getContext("2d")},_createCanvasBackground:function(){var f=this._createCanvasElement("canvas-container");this._contextBackgroundEl=f;this._contextBackground=f.getContext("2d")},getWidth:function(){return this._config.width},getHeight:function(){return this._config.height},setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",
f)},setDimensions:function(f){for(var l in f)this._setDimension(l,f[l]);return this},_setDimension:function(f,l){this.contextContainerEl[f]=l;this.contextContainerEl.style[f]=l+"px";this._contextBackgroundEl[f]=l;this._contextBackgroundEl.style[f]=l+"px";this._element[f]=l;this._element.style[f]=l+"px";this._element.parentNode.style[f]=l+"px";this._config[f]=l;this.calcOffset();this.renderAll();return this},__onMouseUp:function(f){if(this._currentTransform){var l=this._currentTransform.target;if(l._scaling){e("object:scaled",
{target:l});l._scaling=false}for(var p=this._objects.length;p--;)this._objects[p].setCoords();if(l.hasStateChanged()){l.isMoving=false;e("object:modified",{target:l})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(f);if(p=this.getActiveGroup()){p.hasStateChanged()&&p.containsPoint(this.getPointer(f))&&e("group:modified",{target:p});p.setObjectsCoords();p.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(f,
l);this._setCursor("");var w=this;setTimeout(function(){w._setCursorFromEvent(f,l)},50)},shouldClearSelection:function(f){var l=this.findTarget(f),p=this.getActiveGroup();return!l||l&&p&&!p.contains(l)&&p!==l&&!f.shiftKey},__onMouseDown:function(f){if(!this._currentTransform){var l=this.findTarget(f),p=this.getPointer(f),w=this.getActiveGroup();if(this.shouldClearSelection(f)){this._groupSelector={ex:p.x,ey:p.y,top:0,left:0};this.deactivateAllWithDispatch()}else{l.saveState();l._findTargetCorner(f,
this._offset)&&this.onBeforeScaleRotate(l);this._setupCurrentTransform(f,l);if(f.shiftKey&&(w||this.getActiveObject()))this._handleGroupLogic(f,l);else{l!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(l)}}this.renderAll()}},getElement:function(){return this._element},deactivateAllWithDispatch:function(){var f=this.getActiveGroup();f&&e("before:group:destroyed",{target:f});this.deactivateAll();f&&e("after:group:destroyed");e("selection:cleared");return this},_setupCurrentTransform:function(f,
l){var p="drag",w,z=b(f);if(w=l._findTargetCorner(f,this._offset))p=w==="ml"||w==="mr"?"scaleX":w==="mt"||w==="mb"?"scaleY":"rotate";this._currentTransform={target:l,action:p,scaleX:l.scaleX,scaleY:l.scaleY,offsetX:z.x-l.left,offsetY:z.y-l.top,ex:z.x,ey:z.y,left:l.left,top:l.top,theta:l.theta,width:l.width*l.scaleX};this._currentTransform.original={left:l.left,top:l.top}},_handleGroupLogic:function(f,l){if(l.isType("group")){l=this.findTarget(f,true);if(!l||l.isType("group"))return}var p=this.getActiveGroup();
if(p){if(p.contains(l)){p.remove(l);l.setActive(false);p.size()===1&&this.removeActiveGroup()}else p.add(l);e("group:selected",{target:p});p.setActive(true)}else{if(this._activeObject)if(l!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,l]));p=this.getActiveGroup()}l.setActive(true)}p&&p.saveCoords()},__onMouseMove:function(f){if(this._groupSelector!==null){var l=b(f);this._groupSelector.left=l.x-this._offset.left-this._groupSelector.ex;this._groupSelector.top=l.y-this._offset.top-
this._groupSelector.ey;this.renderTop()}else if(this._currentTransform){l=b(f);var p=l.x;l=l.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){f.shiftKey||this._rotateObject(p,l);this._scaleObject(p,l)}else if(this._currentTransform.action==="scaleX")this._scaleObject(p,l,"x");else this._currentTransform.action==="scaleY"?this._scaleObject(p,l,"y"):this._translateObject(p,l);this.renderAll()}else{p=this._element.style;if(l=this.findTarget(f)){this._setCursorFromEvent(f,
l);l.isActive()&&l.setCornersVisibility&&l.setCornersVisibility(true)}else{for(f=this._objects.length;f--;)this._objects[f].active||this._objects[f].setActive(false);p.cursor="default"}}},_translateObject:function(f,l){var p=this._currentTransform.target;p.set("left",f-this._currentTransform.offsetX);p.set("top",l-this._currentTransform.offsetY)},_scaleObject:function(f,l,p){var w=q(r(this._currentTransform.ey-this._currentTransform.top-this._offset.top,2)+r(this._currentTransform.ex-this._currentTransform.left-
this._offset.left,2));f=q(r(l-this._currentTransform.top-this._offset.top,2)+r(f-this._currentTransform.left-this._offset.left,2));l=this._currentTransform.target;l._scaling=true;if(p)if(p==="x")l.set("scaleX",this._currentTransform.scaleX*f/w);else p==="y"&&l.set("scaleY",this._currentTransform.scaleY*f/w);else{l.set("scaleX",this._currentTransform.scaleX*f/w);l.set("scaleY",this._currentTransform.scaleY*f/w)}},_rotateObject:function(f,l){var p=s(this._currentTransform.ey-this._currentTransform.top-
this._offset.top,this._currentTransform.ex-this._currentTransform.left-this._offset.left);this._currentTransform.target.set("theta",s(l-this._currentTransform.top-this._offset.top,f-this._currentTransform.left-this._offset.left)-p+this._currentTransform.theta)},_setCursor:function(f){this._element.style.cursor=f},_setCursorFromEvent:function(f,l){var p=this._element.style;if(l){var w=this.getActiveGroup();if(w=!!l._findTargetCorner&&(!w||!w.contains(l))&&l._findTargetCorner(f,this._offset))if(w in
y)p.cursor=y[w];else{p.cursor="default";return false}else p.cursor="move"}else{p.cursor="default";return false}return true},_draw:function(f,l){l&&l.render(f)},_drawSelection:function(){var f=this._groupSelector.left,l=this._groupSelector.top,p=x(f),w=x(l);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(this._groupSelector.ex-(f>0?0:-f),this._groupSelector.ey-(l>0?0:-l),p,w);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;
this.contextTop.strokeRect(this._groupSelector.ex+0.5-(f>0?0:p),this._groupSelector.ey+0.5-(l>0?0:w),p,w)},_findSelectedObjects:function(){var f=[],l=this._groupSelector.ex,p=this._groupSelector.ey,w=l+this._groupSelector.left,z=p+this._groupSelector.top,A=new fabric.Point(t(l,w),t(p,z));p=new fabric.Point(v(l,w),v(p,z));w=0;for(z=this._objects.length;w<z;++w){l=this._objects[w];if(l.intersectsWithRect(A,p)||l.isContainedWithinRect(A,p)){l.setActive(true);f.push(l)}}if(f.length===1){this.setActiveObject(f[0]);
e("object:selected",{target:f[0]})}else if(f.length>1){f=new fabric.Group(f);this.setActiveGroup(f);f.saveCoords();e("group:selected",{target:f})}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);this.renderAll();return this},insertAt:function(f,l){this._objects.splice(l,0,f);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},clearContext:function(f){f.clearRect(0,0,this._config.width,this._config.height);
return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(f){var l=this._config.width,p=this._config.height,w=f?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);w!==this.contextTop&&this.clearContext(w);if(f){if(!D&&this.backgroundColor==="transparent")var z=true;if(!z)w.fillStyle=this.backgroundColor;w.fillRect(0,0,l,p)}f=this._objects.length;l=this.getActiveGroup();
p=new Date;if(f)for(z=0;z<f;++z)if(!l||l&&!l.contains(this._objects[z]))this._draw(w,this._objects[z]);l&&this._draw(this.contextTop,l);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this.onFpsUpdate(~~(1E3/(new Date-p)));this.afterRender&&this.afterRender();return this},renderTop:function(){this.clearContext(this.contextTop);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&this._drawSelection();var f=this.getActiveGroup();f&&f.render(this.contextTop);
this.afterRender&&this.afterRender();return this},containsPoint:function(f,l){var p=this.getPointer(f),w=this._normalizePointer(l,p);p=w.x;w=w.y;var z=l._getImageLines(l.oCoords);if((p=l._findCrossPoints(p,w,z))&&p%2===1||l._findTargetCorner(f,this._offset))return true;return false},_normalizePointer:function(f,l){var p=this.getActiveGroup(),w=l.x,z=l.y;if(p&&f.type!=="group"&&p.contains(f)){w-=p.left;z-=p.top}return{x:w,y:z}},findTarget:function(f,l){var p;this.getPointer(f);var w=this.getActiveGroup();
if(w&&!l&&this.containsPoint(f,w))return p=w;for(w=this._objects.length;w--;)if(this.containsPoint(f,this._objects[w])){this.relatedTarget=p=this._objects[w];break}return p},toDataURL:function(f){var l;f||(f="png");if(f==="jpeg"||f==="png"){this.renderAll(true);l=this.getElement().toDataURL("image/"+f)}return l},toDataURLWithMultiplier:function(f,l){var p=this.getWidth(),w=this.getHeight(),z=p*l,A=w*l,B=this.getActiveObject();this.setWidth(z).setHeight(A);this.contextTop.scale(l,l);B&&this.deactivateAll().renderAll();
z=this.toDataURL(f);this.contextTop.scale(1/l,1/l);this.setWidth(p).setHeight(w);B&&this.setActiveObject(B);this.renderAll();return z},getPointer:function(f){f=b(f);return{x:f.x-this._offset.left,y:f.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){f.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(f,l){l=l||{};var p=function(){},w=l.onComplete||p,z=l.onChange||p,A=this;fabric.util.animate({startValue:f.get("left"),
endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(B){f.set("left",B);A.renderAll();z()},onComplete:function(){f.setCoords();w()}});return this},centerObjectV:function(f){f.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(f,l){l=l||{};var p=function(){},w=l.onComplete||p,z=l.onChange||p,A=this;fabric.util.animate({startValue:f.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(B){f.set("top",B);A.renderAll();
z()},onComplete:function(){f.setCoords();w()}});return this},straightenObject:function(f){f.straighten();this.renderAll();return this},fxStraightenObject:function(f){f.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(f){return{objects:this._objects.map(function(l){if(!this.includeDefaultValues){var p=
l.includeDefaultValues;l.includeDefaultValues=false}var w=l[f]();if(!this.includeDefaultValues)l.includeDefaultValues=p;return w},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(f,l){if(f){var p=JSON.parse(f);if(!(!p||p&&!p.objects)){this.clear();var w=this;this._enlivenObjects(p.objects,function(){w.backgroundColor=p.background;l&&l()});return this}}},_enlivenObjects:function(f,l){var p=0,w=f.filter(function(A){return A.type==="image"}).length,
z=this;f.forEach(function(A){if(A.type)switch(A.type){case "image":case "font":fabric[m(A.type)].fromObject(A,function(C){z.add(C);++p===w&&l&&l()});break;default:var B=fabric[k(m(A.type))];B&&B.fromObject&&z.add(B.fromObject(A));break}});w===0&&l&&l()},loadFromDatalessJSON:function(f,l){if(f){var p=typeof f==="string"?JSON.parse(f):f;if(!(!p||p&&!p.objects)){this.clear();this.backgroundColor=p.background;this._enlivenDatalessObjects(p.objects,l)}}},_enlivenDatalessObjects:function(f,l){function p(C,
F){w.insertAt(C,F);C.setCoords();++z===A&&l&&l()}var w=this,z=0,A=f.length;A===0&&l&&l();try{f.forEach(function(C,F){var H=C.paths?"paths":"path",G=C[H];delete C[H];if(typeof G!=="string")switch(C.type){case "image":case "text":fabric[m(C.type)].fromObject(C,function(E){p(E,F)});break;default:(H=fabric[k(m(C.type))])&&H.fromObject&&p(H.fromObject(C),F);break}else if(C.type==="image")w.loadImageFromURL(G,function(E){E.setSourcePath(G);d(E,C);E.setAngle(C.angle);p(E,F)});else if(C.type==="text"){C.path=
G;var I=fabric.Text.fromObject(C);fabric.util.getScript(G,function(){Object.prototype.toString.call(g.opera)==="[object Opera]"?setTimeout(function(){p(I,F)},500):p(I,F)})}else w.loadSVGFromURL(G,function(E){E=E.length>1?new fabric.PathGroup(E,C):E[0];E.setSourcePath(G);if(!(E instanceof fabric.PathGroup)){d(E,C);typeof C.angle!=="undefined"&&E.setAngle(C.angle)}p(E,F)})},this)}catch(B){console.log(B.message)}},loadImageFromURL:function(){var f={};return function(l,p){function w(){var B=o.getElementById(f[l]);
B.width&&B.height?p(new fabric.Image(B)):setTimeout(w,50)}var z=this;if(f[l])w();else{var A=new Image;A.onload=function(){A.onload=null;z._resizeImageToFit(A);var B=new fabric.Image(A);p(B)};A.className="canvas-img-clone";A.src=l;if(this.shouldCacheImages)f[l]=Element.identify(A);o.body.appendChild(A)}}}(),loadSVGFromURL:function(f,l){function p(A){if(A=A.responseXML)(A=A.documentElement)&&fabric.parseSVGDocument(A,function(B,C){z.cache.set(f,{objects:B.invoke("toObject"),options:C});l(B,C)})}function w(){console.log("ERROR!")}
var z=this;f=f.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(f,function(A){if(A)z.cache.get(f,function(B){B=z._enlivenCachedObject(B);l(B.objects,B.options)});else new Ajax.Request(f,{method:"get",onComplete:p,onFailure:w})})},_enlivenCachedObject:function(f){var l=f.objects;f=f.options;l=l.map(function(p){return fabric[m(p.type)].fromObject(p)});return{objects:l,options:f}},remove:function(f){c(this._objects,f);this.renderAll();return f},fxRemove:function(f,l){var p=this;f.fxRemove({onChange:this.renderAll.bind(this),
onComplete:function(){p.remove(f);typeof l==="function"&&l()}});return this},sendToBack:function(f){c(this._objects,f);this._objects.unshift(f);return this.renderAll()},bringToFront:function(f){c(this._objects,f);this._objects.push(f);return this.renderAll()},sendBackwards:function(f){var l=this._objects.indexOf(f),p=l;if(l!==0){for(l=l-1;l>=0;--l)if(f.intersectsWithObject(this._objects[l])){p=l;break}c(this._objects,f);this._objects.splice(p,0,f)}return this.renderAll()},bringForward:function(f){var l=
this.getObjects(),p=l.indexOf(f),w=p;if(p!==l.length-1){p=p+1;for(var z=this._objects.length;p<z;++p)if(f.intersectsWithObject(l[p])){w=p;break}c(l,f);l.splice(w,0,f)}this.renderAll()},setActiveObject:function(f){this._activeObject&&this._activeObject.setActive(false);this._activeObject=f;f.setActive(true);this.renderAll();e("object:selected",{target:f});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);
this._activeObject=null;return this},setActiveGroup:function(f){this._activeGroup=f;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var f=this.getActiveGroup();f&&f.destroy();return this.setActiveGroup(null)},item:function(f){return this.getObjects()[f]},deactivateAll:function(){for(var f=this.getObjects(),l=0,p=f.length;l<p;l++)f[l].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(f,
l){f+=l.complexity?l.complexity():0;return f},0)},dispose:function(){this.clear();n(this.getElement(),"mousedown",this._onMouseDown);n(o,"mouseup",this._onMouseUp);n(o,"mousemove",this._onMouseMove);n(g,"resize",this._onResize);return this},clone:function(f){var l=o.createElement("canvas");l.width=this.getWidth();l.height=this.getHeight();var p=this.__clone||(this.__clone=new fabric.Element(l));return p.loadFromJSON(this.toJSON(),function(){f&&f(p)})},_toDataURL:function(f,l){this.clone(function(p){l(p.toDataURL(f))})},
_toDataURLWithMultiplier:function(f,l,p){this.clone(function(w){p(w.toDataURLWithMultiplier(f,l))})},_resizeImageToFit:function(f){var l=f.width||f.offsetWidth,p=this.getWidth()/l;if(l)f.width=l*p},cache:{has:function(f,l){l(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};d(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(f){var l=
f.getContext("2d");f=l.getImageData(0,0,f.width,f.height);var p=f.data,w=f.width,z=f.height,A,B;for(i=0;i<w;i++)for(j=0;j<z;j++){A=i*4*z+j*4;B=(p[A]+p[A+1]+p[A+2])/3;p[A]=B;p[A+1]=B;p[A+2]=B}l.putImageData(f,0,0)},supports:function(f){var l=o.createElement("canvas");if(!l||!l.getContext)return null;var p=l.getContext("2d");if(!p)return null;switch(f){case "getImageData":return typeof p.getImageData!=="undefined";case "toDataURL":return typeof l.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=
fabric.Element.prototype.toObject}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.object.clone,m=g.util.toFixed,k=g.util.string.capitalize,e=g.util.getPointer,b=Array.prototype.slice;if(!g.Object){g.Object=g.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),options:{top:0,
left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var c=this.constructor.superclass.prototype[a];return arguments.length>1?c.apply(this,b.call(arguments,1)):c.call(this)},initialize:function(a){this.setOptions(a);
this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(a){this.options=o(this._getOptions(),a)},_getOptions:function(){return o(d(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?this.setAngle(this.options[a]):this[a]=this.options[a]},
this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var a={type:this.type,left:m(this.left,this.NUM_FRACTION_DIGITS),top:m(this.top,this.NUM_FRACTION_DIGITS),width:m(this.width,this.NUM_FRACTION_DIGITS),height:m(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,scaleX:m(this.scaleX,
this.NUM_FRACTION_DIGITS),scaleY:m(this.scaleY,this.NUM_FRACTION_DIGITS),angle:m(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:m(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var c=g.Object.prototype.options;this.stateProperties.forEach(function(h){a[h]===c[h]&&delete a[h]});return a},isActive:function(){return!!this.active},
setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+k(this.type)+">"},set:function(a,c){if((a==="scaleX"||a==="scaleY")&&c<this.MIN_SCALE_LIMIT)c=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(c);else this[a]=c;return this},toggle:function(a){var c=this.get(a);typeof c==="boolean"&&this.set(a,!c);return this},setSourcePath:function(a){this.sourcePath=a;return this},get:function(a){return a==="angle"?this.getAngle():this[a]},render:function(a,c){if(!(this.width===
0||this.height===0)){a.save();var h=this.transformMatrix;h&&a.setTransform(h[0],h[1],h[2],h[3],h[4],h[5]);c||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a);if(this.active&&!c){this.drawBorders(a);this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(a){this.scaleY=
this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/
2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,c=Math.sin(this._angle+this.theta)*this._hypotenuse,h=this.theta,n=Math.sin(h);h=Math.cos(h);a={x:this.left-a,y:this.top-c};c={x:a.x+this.currentWidth*h,y:a.y+this.currentWidth*n};var q={x:a.x-this.currentHeight*n,y:a.y+this.currentHeight*h};this.oCoords={tl:a,tr:c,br:{x:c.x-this.currentHeight*n,y:c.y+this.currentHeight*h},bl:q,ml:{x:a.x-this.currentHeight/2*n,y:a.y+this.currentHeight/
2*h},mt:{x:a.x+this.currentWidth/2*h,y:a.y+this.currentWidth/2*n},mr:{x:c.x-this.currentHeight/2*n,y:c.y+this.currentHeight/2*h},mb:{x:q.x+this.currentWidth/2*h,y:q.y+this.currentWidth/2*n}};this._setCornerCoords();return this},drawBorders:function(a){var c=this.options,h=c.padding,n=h*2;a.save();a.globalAlpha=this.isMoving?c.borderOpacityWhenMoving:1;a.strokeStyle=c.borderColor;c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var q=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:
this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,q);c=this.getWidth();q=this.getHeight();a.strokeRect(~~(-(c/2)-h)+0.5,~~(-(q/2)-h)+0.5,~~(c+n),~~(q+n));a.restore();return this},drawCorners:function(a){var c=this.options.cornersize,h=c/2,n=this.options.padding,q=-(this.width/2),r=-(this.height/2),s=c/this.scaleX,x=c/this.scaleY,t=(n+h)/this.scaleY,v=(n+h)/this.scaleX,u=(n+h-c)/this.scaleX;n=(n+h-c)/this.scaleY;a.save();a.globalAlpha=this.isMoving?this.options.borderOpacityWhenMoving:1;
a.fillStyle=this.options.cornerColor;c=q-v;h=r-t;a.fillRect(c,h,s,x);c=q+this.width-v;h=r-t;a.fillRect(c,h,s,x);c=q-v;h=r+this.height+n;a.fillRect(c,h,s,x);c=q+this.width+u;h=r+this.height+n;a.fillRect(c,h,s,x);c=q+this.width/2-v;h=r-t;a.fillRect(c,h,s,x);c=q+this.width/2-v;h=r+this.height+n;a.fillRect(c,h,s,x);c=q+this.width+u;h=r+this.height/2-t;a.fillRect(c,h,s,x);c=q-v;h=r+this.height/2-t;a.fillRect(c,h,s,x);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),
a);return new g.Object(this.toObject())},cloneAsImage:function(a){if(g.Image){var c=new Image;c.onload=function(){a&&a(new g.Image(c),h);c=c.onload=null};var h={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);c.src=this.toDataURL()}return this},toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();g.util.wrapElement(a,"div");var c=new g.Element(a);c.backgroundColor=
"transparent";c.renderAll();var h=this.clone();h.left=a.width/2;h.top=a.height/2;h.setActive(false);c.add(h);a=c.toDataURL("png");c.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},intersectsWithRect:function(a,c){var h=this.oCoords,n=new g.Point(h.tl.x,h.tl.y),q=new g.Point(h.tr.x,h.tr.y),r=new g.Point(h.bl.x,
h.bl.y);h=new g.Point(h.br.x,h.br.y);return g.Intersection.intersectPolygonRectangle([n,q,h,r],a,c).status==="Intersection"},intersectsWithObject:function(a){function c(n){return{tl:new g.Point(n.tl.x,n.tl.y),tr:new g.Point(n.tr.x,n.tr.y),bl:new g.Point(n.bl.x,n.bl.y),br:new g.Point(n.br.x,n.br.y)}}var h=c(this.oCoords);a=c(a.oCoords);return g.Intersection.intersectPolygonPolygon([h.tl,h.tr,h.br,h.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,c){var h=this.oCoords,
n=new g.Point(h.tl.x,h.tl.y),q=new g.Point(h.tr.x,h.tr.y),r=new g.Point(h.bl.x,h.bl.y);new g.Point(h.br.x,h.br.y);return n.x>a.x&&q.x<c.x&&n.y>a.y&&r.y<c.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,c){var h=e(a),n=h.x-c.left;h=h.y-c.top;var q;for(var r in this.oCoords){q=this._getImageLines(this.oCoords[r].corner,r);q=this._findCrossPoints(n,h,q);if(q%2==1&&q!=0)return this.__corner=r}return false},_findCrossPoints:function(a,c,h){var n,q,r,s=0;for(var x in h){r=h[x];
if(!(r.o.y<c&&r.d.y<c))if(!(r.o.y>=c&&r.d.y>=c)){if(r.o.x==r.d.x&&r.o.x>=a)n=r.o.x;else{n=(r.d.y-r.o.y)/(r.d.x-r.o.x);q=c-0*a;r=r.o.y-n*r.o.x;n=-(q-r)/(0-n)}if(n>=a)s+=1;if(s==2)break}}return s},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,c=this.theta,h=this.cornersize*Math.cos(c),n=this.cornersize*Math.sin(c);c=this.cornersize/2;var q=c-n;a.tl.x-=q;a.tl.y-=
c;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+h,y:a.tl.y+n},bl:{x:a.tl.x-n,y:a.tl.y+h}};a.tl.corner.br={x:a.tl.corner.tr.x-n,y:a.tl.corner.tr.y+h};a.tl.x+=q;a.tl.y+=c;a.tr.x+=c;a.tr.y-=c;a.tr.corner={tl:{x:a.tr.x-h,y:a.tr.y-n},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-n,y:a.tr.y+h}};a.tr.corner.bl={x:a.tr.corner.tl.x-n,y:a.tr.corner.tl.y+h};a.tr.x-=c;a.tr.y+=c;a.bl.x-=c;a.bl.y+=c;a.bl.corner={tl:{x:a.bl.x+n,y:a.bl.y-h},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+h,y:a.bl.y+n}};a.bl.corner.tr={x:a.bl.corner.br.x+
n,y:a.bl.corner.br.y-h};a.bl.x+=c;a.bl.y-=c;a.br.x+=c;a.br.y+=c;a.br.corner={tr:{x:a.br.x+n,y:a.br.y-h},bl:{x:a.br.x-h,y:a.br.y-n},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+n,y:a.br.corner.bl.y-h};a.br.x-=c;a.br.y-=c;a.ml.x-=c;a.ml.y-=c;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+h,y:a.ml.y+n},bl:{x:a.ml.x-n,y:a.ml.y+h}};a.ml.corner.br={x:a.ml.corner.tr.x-n,y:a.ml.corner.tr.y+h};a.ml.x+=c;a.ml.y+=c;a.mt.x-=c;a.mt.y-=c;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+h,y:a.mt.y+
n},bl:{x:a.mt.x-n,y:a.mt.y+h}};a.mt.corner.br={x:a.mt.corner.tr.x-n,y:a.mt.corner.tr.y+h};a.mt.x+=c;a.mt.y+=c;a.mr.x-=c;a.mr.y-=c;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+h,y:a.mr.y+n},bl:{x:a.mr.x-n,y:a.mr.y+h}};a.mr.corner.br={x:a.mr.corner.tr.x-n,y:a.mr.corner.tr.y+h};a.mr.x+=c;a.mr.y+=c;a.mb.x-=c;a.mb.y-=c;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+h,y:a.mb.y+n},bl:{x:a.mb.x-n,y:a.mb.y+h}};a.mb.corner.br={x:a.mb.corner.tr.x-n,y:a.mb.corner.tr.y+h};a.mb.x+=c;a.mb.y+=c;a=a.mb.corner;
a.tl.x-=c;a.tl.y-=c;a.tr.x-=c;a.tr.y-=c;a.br.x-=c;a.br.y-=c;a.bl.x-=c;a.bl.y-=c},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new g.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var c=function(){},h=a.onComplete||c,n=a.onChange||
c,q=this;g.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){q.setAngle(r);n()},onComplete:function(){q.setCoords();h()},onStart:function(){q.setActive(false)}});return this},fxRemove:function(a){a||(a={});var c=function(){},h=a.onComplete||c,n=a.onChange||c,q=this;g.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(r){q.set("opacity",r);n()},onComplete:h,onStart:function(){q.setActive(false)}});
return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0},toJSON:function(){return this.toObject()}});g.Object.prototype.rotate=g.Object.prototype.setAngle}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend;if(!g.Line){g.Line=g.util.createClass(g.Object,{type:"line",initialize:function(d,m){d||(d=[0,0,0,0]);this.callSuper("initialize",m);this.set("x1",d[0]);this.set("y1",d[1]);this.set("x2",d[2]);this.set("y2",d[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(d){d.beginPath();d.moveTo(-this.width/2,-this.height/2);
d.lineTo(this.width/2,this.height/2);var m=d.strokeStyle;d.strokeStyle=d.fillStyle;d.stroke();d.strokeStyle=m},complexity:function(){return 1},toObject:function(){return o(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});g.Element.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");g.Line.fromElement=function(d,m){var k=g.parseAttributes(d,g.Element.ATTRIBUTE_NAMES);return new g.Line([k.x1||0,k.y1||0,k.x2||0,k.y2||0],o(k,m))};
g.Line.fromObject=function(d){return new g.Line([d.x1,d.y1,d.x2,d.y2],d)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=Math.PI*2,d=g.util.object.extend;if(g.Circle)console.warn("fabric.Circle is already defined.");else{g.Circle=g.util.createClass(g.Object,{type:"circle",initialize:function(m){m=m||{};this.set("radius",m.radius||0);this.callSuper("initialize",m);m=this.get("radius")*2*this.get("scaleX");this.set("width",m).set("height",m)},toObject:function(){return d(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(m){m.beginPath();m.arc(0,
0,this.radius,0,o,false);this.fill&&m.fill();this.stroke&&m.stroke()},complexity:function(){return 1}});g.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");g.Circle.fromElement=function(m,k){var e=g.parseAttributes(m,g.Circle.ATTRIBUTE_NAMES);if(!("radius"in e&&e.radius>0))throw Error("value of `r` attribute is required and can not be negative");return new g.Circle(d(e,k))};g.Circle.fromObject=function(m){return new g.Circle(m)}}})();
(function(){var g=this.fabric||(this.fabric={});if(!g.Triangle){g.Triangle=g.util.createClass(g.Object,{type:"triangle",initialize:function(o){o=o||{};this.callSuper("initialize",o);this.set("width",o.width||100).set("height",o.height||100)},_render:function(o){o.beginPath();o.moveTo(-this.width/2,this.height/2);o.lineTo(0,-this.height/2);o.lineTo(this.width/2,this.height/2);this.fill&&o.fill();this.stroke&&o.stroke()},complexity:function(){return 1}});g.Triangle.fromObject=function(o){return new g.Triangle(o)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend;if(g.Ellipse)console.warn("fabric.Ellipse is already defined.");else{g.Ellipse=g.util.createClass(g.Object,{type:"ellipse",initialize:function(d){d=d||{};this.callSuper("initialize",d);this.set("rx",d.rx||0);this.set("ry",d.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return o(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(d,m){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",d,m)},_render:function(d){d.beginPath();d.save();d.transform(1,0,0,this.ry/this.rx,0,0);d.arc(0,0,this.rx,0,Math.PI*2,false);d.restore();this.stroke&&d.stroke();this.fill&&d.fill()},complexity:function(){return 1}});g.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");g.Ellipse.fromElement=function(d,m){var k=g.parseAttributes(d,g.Ellipse.ATTRIBUTE_NAMES);return new g.Ellipse(o(k,m))};g.Ellipse.fromObject=
function(d){return new g.Ellipse(d)}}})();
(function(){var g=this.fabric||(this.fabric={});if(!g.Rect){g.Rect=g.util.createClass(g.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(o){this.callSuper("initialize",o);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(o){var d=this.options.rx||0,m=this.options.ry||0,k=-this.width/2,e=-this.height/2,b=this.width,a=this.height;o.beginPath();
o.moveTo(k+d,e);o.lineTo(k+b-d,e);o.bezierCurveTo(k+b,e,k+b,e+m,k+b,e+m);o.lineTo(k+b,e+a-m);o.bezierCurveTo(k+b,e+a,k+b-d,e+a,k+b-d,e+a);o.lineTo(k+d,e+a);o.bezierCurveTo(k,e+a,k,e+a-m,k,e+a-m);o.lineTo(k,e+m);o.bezierCurveTo(k,e,k+d,e,k+d,e);o.closePath();this.fill&&o.fill();this.stroke&&o.stroke()},_normalizeLeftTopProperties:function(o){o.left&&this.set("left",o.left+this.getWidth()/2);o.top&&this.set("top",o.top+this.getHeight()/2);return this},complexity:function(){return 1}});g.Rect.ATTRIBUTE_NAMES=
"x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");g.Rect.fromElement=function(o,d){if(!o)return null;var m=g.parseAttributes(o,g.Rect.ATTRIBUTE_NAMES);m=m;m.left=m.left||0;m.top=m.top||0;m=m;var k=new g.Rect(g.util.object.extend(d||{},m));k._normalizeLeftTopProperties(m);return k};g.Rect.fromObject=function(o){return new g.Rect(o)}}})();
(function(){var g=this.fabric||(this.fabric={});if(g.Polyline)console.warn("fabric.Polyline is already defined");else{g.Polyline=g.util.createClass(g.Object,{type:"polyline",initialize:function(d,m){m=m||{};this.set("points",d);this.callSuper("initialize",m);this._calcDimensions()},_calcDimensions:function(){return g.Polygon.prototype._calcDimensions.call(this)},_toOrigin:function(){return g.Polygon.prototype._toOrigin.call(this)},toObject:function(){return g.Polygon.prototype.toObject.call(this)},
_render:function(d){var m;d.beginPath();for(var k=0,e=this.points.length;k<e;k++){m=this.points[k];d.lineTo(m.x,m.y)}this.fill&&d.fill();this.stroke&&d.stroke()},complexity:function(){return this.get("points").length}});var o="fill fill-opacity stroke stroke-width transform".split(" ");g.Polyline.fromElement=function(d,m){if(!d)return null;var k=g.parsePointsAttribute(d.getAttribute("points")),e=g.parseAttributes(d,o);return new g.Polyline(k,g.util.object.extend(e,m))};g.Polyline.fromObject=function(d){return new g.Polyline(d.points,
d)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.array.min,m=g.util.array.max;if(g.Polygon)console.warn("fabric.Polygon is already defined");else{g.Polygon=g.util.createClass(g.Object,{type:"polygon",initialize:function(k,e){e=e||{};this.points=k;this.callSuper("initialize",e);this._calcDimensions()},_calcDimensions:function(){var k=this.points,e=d(k,"x"),b=d(k,"y"),a=m(k,"x");k=m(k,"y");this.width=a-e;this.height=k-b;this.minX=e;this.minY=b},_toOrigin:function(){this.points=this.points.map(function(k){return{x:k.x-
this.minX,y:k.y-this.minY}},this)},toObject:function(){return o(this.callSuper("toObject"),{points:this.points.concat()})},_render:function(k){var e;k.beginPath();for(var b=0,a=this.points.length;b<a;b++){e=this.points[b];k.lineTo(e.x,e.y)}this.fill&&k.fill();if(this.stroke){k.closePath();k.stroke()}},complexity:function(){return this.points.length}});g.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");g.Polygon.fromElement=function(k,e){if(!k)return null;var b=
g.parsePointsAttribute(k.getAttribute("points")),a=g.parseAttributes(k,g.Polygon.ATTRIBUTE_NAMES);return new g.Polygon(b,o(a,e))};g.Polygon.fromObject=function(k){return new g.Polygon(k.points,k)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.array.min,d=g.util.array.max,m=g.util.object.extend;if(g.Path)console.warn("fabric.Path is already defined");else if(g.Object){g.Path=g.util.createClass(g.Object,{type:"path",initialize:function(e,b){b=b||{};this.setOptions(b);this._importProperties();this.originalState={};if(!e)throw Error("`path` argument is required");var a=Object.prototype.toString.call(e)==="[object Array]";if(this.path=a?e:e.match&&e.match(/[a-zA-Z][^a-zA-Z]*/g)){a||this._initializeFromArray(b);
this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)}},_initializeFromArray:function(e){var b="width"in e;e="height"in e;this.path=this._parsePath();if(!b||!e){m(this,this._parseDimensions());if(b)this.width=this.options.width;if(e)this.height=this.options.height}},_render:function(e){for(var b,a=0,c=0,h=0,n=0,q,r,s=-(this.width/2),x=-(this.height/2),t=0,v=this.path.length;t<v;++t){b=this.path[t];switch(b[0]){case "l":a+=b[1];c+=b[2];e.lineTo(a+s,c+x);break;case "L":a=b[1];c=b[2];e.lineTo(a+
s,c+x);break;case "h":a+=b[1];e.lineTo(a+s,c+x);break;case "H":a=b[1];e.lineTo(a+s,c+x);break;case "v":c+=b[1];e.lineTo(a+s,c+x);break;case "V":c=b[1];e.lineTo(a+s,c+x);break;case "m":a+=b[1];c+=b[2];e.moveTo(a+s,c+x);break;case "M":a=b[1];c=b[2];e.moveTo(a+s,c+x);break;case "c":q=a+b[5];r=c+b[6];h=a+b[3];n=c+b[4];e.bezierCurveTo(a+b[1]+s,c+b[2]+x,h+s,n+x,q+s,r+x);a=q;c=r;break;case "C":a=b[5];c=b[6];h=b[3];n=b[4];e.bezierCurveTo(b[1]+s,b[2]+x,h+s,n+x,a+s,c+x);break;case "s":q=a+b[3];r=c+b[4];h=2*
a-h;n=2*c-n;e.bezierCurveTo(h+s,n+x,a+b[1]+s,c+b[2]+x,q+s,r+x);a=q;c=r;break;case "S":q=b[3];r=b[4];h=2*a-h;n=2*c-n;e.bezierCurveTo(h+s,n+x,b[1]+s,b[2]+x,q+s,r+x);a=q;c=r;break;case "q":a+=b[3];c+=b[4];e.quadraticCurveTo(b[1]+s,b[2]+x,a+s,c+x);break;case "Q":a=b[3];c=b[4];h=b[1];n=b[2];e.quadraticCurveTo(h+s,n+x,a+s,c+x);break;case "T":q=a;r=c;a=b[1];c=b[2];h=-h+2*q;n=-n+2*r;e.quadraticCurveTo(h+s,n+x,a+s,c+x);break;case "a":break;case "A":break;case "z":case "Z":e.closePath();break}}},render:function(e,
b){e.save();var a=this.transformMatrix;a&&e.transform(a[0],a[1],a[2],a[3],a[4],a[5]);b||this.transform(e);if(this.overlayFill)e.fillStyle=this.overlayFill;else if(this.fill)e.fillStyle=this.fill;if(this.stroke)e.strokeStyle=this.stroke;e.beginPath();this._render(e);this.fill&&e.fill();if(this.options.stroke){e.strokeStyle=this.options.stroke;e.lineWidth=this.options.strokeWidth;e.stroke()}if(!b&&this.active){this.drawBorders(e);this.hideCorners||this.drawCorners(e)}e.restore()},toString:function(){return"#<fabric.Path ("+
this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var e=m(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)e.sourcePath=this.sourcePath;if(this.transformMatrix)e.transformMatrix=this.transformMatrix;return e},toDatalessObject:function(){var e=this.toObject();if(this.sourcePath)e.path=this.sourcePath;delete e.sourcePath;return e},complexity:function(){return this.path.length},set:function(e,b){return this.callSuper("set",e,b)},_parsePath:function(){for(var e=
[],b,a,c=0,h=this.path.length;c<h;c++){b=this.path[c];a=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);e.push([b.charAt(0)].concat(a.map(parseFloat)))}return e},_parseDimensions:function(){function e(u){if(u[0]==="H")return u[1];return u[u.length-2]}function b(u){if(u[0]==="V")return u[1];return u[u.length-1]}var a=[],c=[],h,n,q=false,r,s;this.path.forEach(function(u,y){if(u[0]!=="H")h=y===0?e(u):e(this.path[y-1]);if(u[0]!=="V")n=y===0?b(u):b(this.path[y-1]);if(u[0]===u[0].toLowerCase())q=
true;r=q?h+e(u):u[0]==="V"?h:e(u);s=q?n+b(u):u[0]==="H"?n:b(u);var D=parseInt(r,10);isNaN(D)||a.push(D);D=parseInt(s,10);isNaN(D)||c.push(D)},this);var x=o(a),t=o(c),v=deltaY=0;x={top:t-deltaY,left:x-v,bottom:d(c)-deltaY,right:d(a)-v};x.width=x.right-x.left;x.height=x.bottom-x.top;return x}});g.Path.fromObject=function(e){return new g.Path(e.path,e)};var k=g.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");g.Path.fromElement=function(e,b){var a=g.parseAttributes(e,
k),c=a.d;delete a.d;return new g.Path(c,m(a,b))}}else console.warn("fabric.Path requires fabric.Object")})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.array.invoke,m=g.Object.prototype.set,k=g.Object.prototype.toObject,e=g.util.string.camelize,b=g.util.string.capitalize;if(g.PathGroup)console.warn("fabric.PathGroup is already defined");else{g.PathGroup=g.util.createClass(g.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(a,c){c=c||{};this.originalState={};this.paths=a;this.setOptions(c);this.initProperties();this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},
initProperties:function(){this.stateProperties.forEach(function(a){if(a==="fill")this.set(a,this.options[a]);else if(a==="angle")this.setAngle(this.options[a]);else this[a]=this.options[a]},this)},render:function(a){if(this.stub){a.save();this.transform(a);this.stub.render(a,false);if(this.active){this.drawBorders(a);this.drawCorners(a)}}else{a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(a);c=0;for(var h=this.paths.length;c<h;++c)this.paths[c].render(a,
true);if(this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}}a.restore()},set:function(a,c){if((a==="fill"||a==="overlayFill")&&this.isSameColor()){this[a]=c;for(var h=this.paths.length;h--;)this.paths[h].set(a,c)}else m.call(this,a,c);return this},toObject:function(){return o(k.call(this),{paths:d(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.paths=this.sourcePath;return a},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(c){return c.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}});g.PathGroup.fromObject=function(a){for(var c=a.paths,
h=0,n=c.length;h<n;h++)if(!(c[h]instanceof g.Object)){var q=e(b(c[h].type));c[h]=g[q].fromObject(c[h])}return new g.PathGroup(c,a)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.array.min,m=g.util.array.max,k=g.util.array.invoke,e=g.util.removeFromArray;if(!g.Group){g.Group=g.util.createClass(g.Object,{type:"group",initialize:function(b,a){this.objects=b||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&o(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var b=
this.left,a=this.top;this.forEachObject(function(c){var h=c.get("left"),n=c.get("top");c.set("originalLeft",h);c.set("originalTop",n);c.set("left",h-b);c.set("top",n-a);c.setCoords();c.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(b){this._restoreObjectsState();this.objects.push(b);b.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(b){this._restoreObjectsState();
e(this.objects,b);b.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(b,a){if(typeof a=="function")this.set(b,a(this[b]));else if(b==="fill"||b==="opacity"){var c=this.objects.length;for(this[b]=a;c--;)this.objects[c].set(b,a)}else this[b]=a;return this},contains:function(b){return this.objects.indexOf(b)>-1},toObject:function(){return o(this.callSuper("toObject"),{objects:k(this.objects,"clone")})},render:function(b){b.save();
this.transform(b);for(var a=Math.max(this.scaleX,this.scaleY),c=0,h=this.objects.length;c<h;c++){var n=this.objects[c].borderScaleFactor;this.objects[c].borderScaleFactor=a;this.objects[c].render(b);this.objects[c].borderScaleFactor=n}this.hideBorders||this.drawBorders(b);this.hideCorners||this.drawCorners(b);b.restore();this.setCoords()},item:function(b){return this.getObjects()[b]},complexity:function(){return this.getObjects().reduce(function(b,a){b+=typeof a.complexity=="function"?a.complexity():
0;return b},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(b){var a=this.get("left"),c=this.get("top"),h=this.getAngle()*(Math.PI/180);b.get("originalLeft");b.get("originalTop");var n=Math.cos(h)*b.get("top")+Math.sin(h)*b.get("left");h=-Math.sin(h)*b.get("top")+Math.cos(h)*b.get("left");b.setAngle(b.getAngle()+this.getAngle());b.set("left",a+h*this.get("scaleX"));b.set("top",c+n*this.get("scaleY"));b.set("scaleX",
b.get("scaleX")*this.get("scaleX"));b.set("scaleY",b.get("scaleY")*this.get("scaleY"));b.setCoords();b.hideCorners=false;b.setActive(false);b.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(b){b.setCoords()});
return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(b){this.forEachObject(function(a){a.setActive(b)});return this},forEachObject:function(b,a){for(var c=this.getObjects(),h=c.length;h--;)b.call(a,c[h],h,c);return this},_setOpacityIfSame:function(){var b=this.getObjects(),a=b[0]?b[0].get("opacity"):1;if(b.every(function(c){return c.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var b=[],a=[],c,h;h=0;for(var n=this.objects.length;h<n;++h){c=this.objects[h];
c.setCoords();for(var q in c.oCoords){b.push(c.oCoords[q].x);a.push(c.oCoords[q].y)}}c=d(b);h=m(b);b=d(a);a=m(a);h=h-c;a=a-b;this.width=h;this.height=a;this.left=c+h/2;this.top=b+a/2},containsPoint:function(b){var a=this.get("width")/2,c=this.get("height")/2,h=this.get("left"),n=this.get("top");return h-a<b.x&&h+a>b.x&&n-c<b.y&&n+c>b.y},toGrayscale:function(){for(var b=this.objects.length;b--;)this.objects[b].toGrayscale()}});g.Group.fromObject=function(b){return new g.Group(b.objects,b)}}})();
(function(){var g=this.fabric||(this.fabric={}),o=g.util.object.extend,d=g.util.object.clone;if(g.Text)console.warn("fabric.Text is already defined");else if(g.Object){g.Text=g.util.createClass(g.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(m,k){this.originalState={};this.initStateProperties();this.text=m;this.setOptions(k);o(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},
initStateProperties:function(){var m;if((m=this.constructor)&&(m=m.superclass)&&(m=m.prototype)&&(m=m.stateProperties)&&m.clone){this.stateProperties=m.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(m){var k=Cufon.textOptions||(Cufon.textOptions={});k.left=this.left;k.top=this.top;k.context=m;k.color=this.fill;var e=this._initDummyElement();
this.transform(m);Cufon.replaceElement(e,{separate:"none",fontFamily:this.fontfamily});this.width=k.width;this.height=k.height},_initDummyElement:function(){var m=document.createElement("div");m.innerHTML=this.text;m.style.fontSize="40px";m.style.fontWeight="400";m.style.fontStyle="normal";m.style.letterSpacing="normal";m.style.color="#000000";m.style.fontWeight="600";m.style.fontFamily="Verdana";return m},render:function(m){m.save();this._render(m);if(this.active){this.drawBorders(m);this.drawCorners(m)}m.restore()},
toObject:function(){return o(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(m){this.set("fill",m);return this},setFontsize:function(m){this.set("fontsize",m);this.setCoords();return this},getText:function(){return this.text},setText:function(m){this.set("text",m);this.setCoords();return this},set:function(m,k){this[m]=k;if(m==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+k+"$3");return this}});g.Text.fromObject=function(m){return new g.Text(m.text,d(m))};g.Text.fromElement=function(){}}else console.warn("fabric.Text requires fabric.Object")})();
(function(){var g=fabric.util.object.extend;if(!this.fabric)this.fabric={};if(this.fabric.Image)console.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(o,d){this.callSuper("initialize",d);this._initElement(o);this._initConfig(d||{})},getElement:function(){return this._element},setElement:function(o){this._element=
o;return this},getNormalizedSize:function(o,d,m){if(m&&d&&o.width>o.height&&o.width/o.height<d/m){normalizedWidth=~~(o.width*m/o.height);normalizedHeight=m}else if(m&&(o.height==o.width||o.height>o.width||o.height>m)){normalizedWidth=~~(o.width*m/o.height);normalizedHeight=m}else if(d&&d<o.width){normalizedHeight=~~(o.height*d/o.width);normalizedWidth=d}else{normalizedWidth=o.width;normalizedHeight=o.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var o=this.getElement();
return{width:o.width,height:o.height}},setBorderVisibility:function(o){this._resetWidthHeight();this._adjustWidthHeightToBorders(o);this.setCoords()},setCornersVisibility:function(o){this.cornervisibility=!!o},render:function(o,d){o.save();d||this.transform(o);this._render(o);if(this.active&&!d){this.drawBorders(o);this.hideCorners||this.drawCorners(o)}o.restore()},toObject:function(){return g(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(o){this.constructor.fromObject(this.toObject(),o)},toGrayscale:function(o){if(!this.__isGrayscaled){var d=this.getElement(),m=document.createElement("canvas"),k=document.createElement("img"),e=this;m.width=d.width;m.height=d.height;m.getContext("2d").drawImage(d,0,0);fabric.Element.toGrayscale(m);k.onload=function(){e.setElement(k);o&&o();k.onload=m=d=imageData=null};k.width=d.width;k.height=d.height;k.src=m.toDataURL("image/png");this.__isGrayscaled=true;return this}},
_render:function(o){var d=this.getOriginalSize();o.drawImage(this.getElement(),-d.width/2,-d.height/2,d.width,d.height)},_adjustWidthHeightToBorders:function(o){if(o){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var o=this.getElement();this.set("width",o.width);this.set("height",o.height)},_initElement:function(o){this.setElement(fabric.util.getById(o));fabric.util.addClass(this.getElement(),
fabric.Image.CSS_CANVAS)},_initConfig:function(o){this.setOptions(o);this._setBorder();this._setWidthHeight(o)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var o=2*this.currentBorder;this.width=(this.getElement().width||0)+o;this.height=(this.getElement().height||0)+o}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(o,d){var m=document.createElement("img"),k=o.src;if(o.width)m.width=o.width;if(o.height)m.height=
o.height;m.onload=function(){d&&d(new fabric.Image(m,o));m=m.onload=null};m.src=k};fabric.Image.fromURL=function(o,d,m){var k=document.createElement("img");k.onload=function(){d&&d(new fabric.Image(k,m));k=k.onload=null};k.src=o}}else console.warn("fabric.Object is required for fabric.Image initialization")})();
