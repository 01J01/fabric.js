var fabric=fabric||{version:0.1};fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply)fabric.log=function(){return console.log.apply(console,arguments)};if(typeof console.warn!=="undefined"&&console.warn.apply)fabric.warn=function(){return console.warn.apply(console,arguments)}}if(!this.JSON)this.JSON={};
(function(){function m(e){return e<10?"0"+e:e}function p(e){o.lastIndex=0;return o.test(e)?'"'+e.replace(o,function(n){var q=a[n];return typeof q==="string"?q:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e,n){var q,s,x,y,A=l,u,v=n[e];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(e);if(typeof c==="function")v=c.call(n,e,v);switch(typeof v){case "string":return p(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";l+=g;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){y=v.length;for(q=0;q<y;q+=1)u[q]=f(q,v)||"null";x=u.length===0?"[]":l?"[\n"+l+u.join(",\n"+l)+"\n"+A+"]":"["+u.join(",")+"]";l=A;return x}if(c&&typeof c==="object"){y=c.length;for(q=0;q<y;q+=1){s=c[q];if(typeof s==="string")if(x=f(s,v))u.push(p(s)+(l?": ":":")+x)}}else for(s in v)if(Object.hasOwnProperty.call(v,s))if(x=f(s,v))u.push(p(s)+(l?": ":":")+x);x=u.length===0?"{}":l?"{\n"+l+u.join(",\n"+l)+
"\n"+A+"}":"{"+u.join(",")+"}";l=A;return x}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,g,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,n,q){var s;g=l="";if(typeof q==="number")for(s=0;s<q;s+=1)g+=" ";else if(typeof q==="string")g=q;if((c=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return f("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,n){function q(x,y){var A,u,v=x[y];if(v&&typeof v==="object")for(A in v)if(Object.hasOwnProperty.call(v,A)){u=q(v,A);if(u!==undefined)v[A]=u;else delete v[A]}return n.call(x,y,v)}var s;e=String(e);h.lastIndex=0;if(h.test(e))e=e.replace(h,function(x){return"\\u"+("0000"+x.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){s=eval("("+e+")");return typeof n==="function"?q({"":s},""):s}throw new SyntaxError("JSON.parse");}})();(function(){var m=document.defaultView;if(m&&m.getComputedStyle)if(m.getComputedStyle(document.documentElement,"")===null)m.getComputedStyle=function(p){return p.style}})();
var Cufon=function(){function m(t){var b=this.face=t.face;this.glyphs=t.glyphs;this.w=t.w;this.baseSize=parseInt(b["units-per-em"],10);this.family=b["font-family"].toLowerCase();this.weight=b["font-weight"];this.style=b["font-style"]||"normal";this.viewBox=function(){var d=b.bbox.split(/\s+/);d={minX:parseInt(d[0],10),minY:parseInt(d[1],10),maxX:parseInt(d[2],10),maxY:parseInt(d[3],10)};d.width=d.maxX-d.minX;d.height=d.maxY-d.minY;d.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return d}();this.ascent=-parseInt(b.ascent,10);this.descent=-parseInt(b.descent,10);this.height=-this.ascent+this.descent}function p(){var t={},b={oblique:"italic",italic:"oblique"};this.add=function(d){(t[d.style]||(t[d.style]={}))[d.weight]=d};this.get=function(d,k){var r=t[d]||t[b[d]]||t.normal||t.italic||t.oblique;if(!r)return null;k={normal:400,bold:700}[k]||parseInt(k,10);if(r[k])return r[k];var w={1:1,99:0}[k%100],z=[],B,D;if(w===undefined)w=k>400;if(k==500)k=400;for(var G in r){G=parseInt(G,
10);if(!B||G<B)B=G;if(!D||G>D)D=G;z.push(G)}if(k<B)k=B;if(k>D)k=D;z.sort(function(F,H){return(w?F>k&&H>k?F<H:F>H:F<k&&H<k?F>H:F<H)?-1:1});return r[z[0]]}}function f(t){var b={},d={};this.get=function(k){return b[k]!=undefined?b[k]:t[k]};this.getSize=function(k,r){return d[k]||(d[k]=new q.Size(this.get(k),r))};this.extend=function(k){for(var r in k)b[r]=k[r];return this}}function h(t,b,d){if(t.addEventListener)t.addEventListener(b,d,false);else t.attachEvent&&t.attachEvent("on"+b,function(){return d.call(t,
window.event)})}function o(t){var b={};return function(d){b.hasOwnProperty(d)||(b[d]=t.apply(null,arguments));return b[d]}}function l(t){return document.getElementsByTagName(t)}function g(){for(var t={},b,d=0,k=arguments.length;d<k;++d)for(b in arguments[d])t[b]=arguments[d][b];return t}function a(t,b,d,k,r,w){var z=k.separate;if(z=="none")return u[k.engine].apply(null,arguments);var B=document.createDocumentFragment(),D=b.split(C[z]),G=z=="words";if(G&&s){/^\s/.test(b)&&D.unshift("");/\s$/.test(b)&&
D.push("")}for(var F=0,H=D.length;F<H;++F)(z=u[k.engine](t,G?q.textAlign(D[F],d,F,H):D[F],d,k,r,w,F<H-1))&&B.appendChild(z);return B}function c(t,b){var d,k,r,w;r=x.get(t);if(!r.options){b.hover&&b.hoverables[t.nodeName.toLowerCase()]&&y.attach(t);r.options=b}for(var z=t.firstChild;z;z=r){r=z.nextSibling;w=false;if(z.nodeType==1){if(!z.firstChild)continue;if(/cufon/.test(z.className))w=true;else{arguments.callee(z,b);continue}}k||(k=q.getStyle(t).extend(b));if(!d)a:{(d=k)||(d=q.getStyle(t));for(var B=
q.quotedList(d.get("fontFamily").toLowerCase()),D=void 0,G=0,F=B.length;G<F;++G){D=B[G];if(v[D]){d=v[D].get(d.get("fontStyle"),d.get("fontWeight"));break a}}d=null}if(d)if(w)u[b.engine](d,null,k,b,z,t);else{w=z.data;if(w!=="")(w=a(d,w,k,b,z,t))?z.parentNode.replaceChild(w,z):z.parentNode.removeChild(z)}}}var e=function(){return e.replace.apply(null,arguments)},n=e.DOM={ready:function(){var t=false,b={loaded:1,complete:1},d=[],k=function(){if(!t){t=true;for(var r;r=d.shift();r());}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",
k,false);window.addEventListener("pageshow",k,false)}!window.opera&&document.readyState&&function(){b[document.readyState]?k():setTimeout(arguments.callee,10)}();document.readyState&&document.createStyleSheet&&function(){try{document.body.doScroll("left");k()}catch(r){setTimeout(arguments.callee,1)}}();h(window,"load",k);return function(r){if(arguments.length)t?r():d.push(r);else k()}}()},q=e.CSS={Size:function(t,b){this.value=parseFloat(t);this.unit=String(t).match(/[a-z%]*$/)[0]||"px";this.convert=
function(d){return d/b*this.value};this.convertFrom=function(d){return d/this.value*b};this.toString=function(){return this.value+this.unit}},getStyle:function(t){return new f(t.style)},quotedList:o(function(t){for(var b=[],d=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,k;k=d.exec(t);)b.push(k[3]||k[1]);return b}),ready:function(){var t=false,b=[],d=Object.prototype.propertyIsEnumerable?l("style"):{length:0},k=l("link");n.ready(function(){for(var r=0,w,z=0,B=k.length;w=k[z],z<B;++z)!w.disabled&&w.rel.toLowerCase()==
"stylesheet"&&++r;if(document.styleSheets.length>=d.length+r)for(t=true;r=b.shift();r());else setTimeout(arguments.callee,10)});return function(r){t?r():b.push(r)}}(),supports:function(t,b){var d=document.createElement("span").style;if(d[t]===undefined)return false;d[t]=b;return d[t]===b},textAlign:function(t,b,d,k){if(b.get("textAlign")=="right"){if(d>0)t=" "+t}else if(d<k-1)t+=" ";return t},textDecoration:function(t,b){b||(b=this.getStyle(t));for(var d={underline:null,overline:null,"line-through":null},
k=t;k.parentNode&&k.parentNode.nodeType==1;){var r=true;for(var w in d)if(!d[w]){if(b.get("textDecoration").indexOf(w)!=-1)d[w]=b.get("color");r=false}if(r)break;b=this.getStyle(k=k.parentNode)}return d},textShadow:o(function(t){if(t=="none")return null;for(var b=[],d={},k,r=0,w=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;k=w.exec(t);)if(k[0]==","){b.push(d);d={};r=0}else if(k[1])d.color=k[1];else d[["offX","offY","blur"][r++]]=k[2];b.push(d);return b}),color:o(function(t){var b={};
b.color=t.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(d,k,r){b.opacity=parseFloat(r);return"rgb("+k+")"});return b}),textTransform:function(t,b){return t[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[b.get("textTransform")]||"toString"]()}},s=" ".split(/\s+/).length==0,x=new function(){var t={},b=0;this.get=function(d){d=d.cufid||(d.cufid=++b);return t[d]||(t[d]={})}},y=new (function(){function t(k){k=k.relatedTarget;var r;if(!(r=!k))r=this.contains?this.contains(k):this.compareDocumentPosition(k)&
16;r||d(this)}function b(){d(this)}function d(k){setTimeout(function(){e.replace(k,x.get(k).options,true)},10)}this.attach=function(k){if(k.onmouseenter===undefined){h(k,"mouseover",t);h(k,"mouseout",t)}else{h(k,"mouseenter",b);h(k,"mouseleave",b)}}}),A=[],u={},v={},E={enableTextDecoration:false,engine:null,hover:false,hoverables:{a:true},printable:true,selector:window.Sizzle||window.jQuery&&function(t){return jQuery(t)}||window.dojo&&dojo.query||window.$$&&function(t){return $$(t)}||window.$&&function(t){return $(t)}||
document.querySelectorAll&&function(t){return document.querySelectorAll(t)}||l,separate:"words",textShadow:"none"},C={words:/\s+/,characters:""};e.now=function(){n.ready();return e};e.refresh=function(){for(var t=A.splice(0,A.length),b=0,d=t.length;b<d;++b)e.replace.apply(null,t[b]);return e};e.registerEngine=function(t,b){if(!b)return e;u[t]=b;return e.set("engine",t)};e.registerFont=function(t){t=new m(t);var b=t.family;v[b]||(v[b]=new p);v[b].add(t);return e.set("fontFamily",'"'+b+'"')};e.replace=
function(t,b,d){b=g(E,b);if(!b.engine)return e;if(typeof b.textShadow=="string")b.textShadow=q.textShadow(b.textShadow);d||A.push(arguments);if(t.nodeType||typeof t=="string")t=[t];q.ready(function(){for(var k=0,r=t.length;k<r;++k){var w=t[k];typeof w=="string"?e.replace(b.selector(w),b,true):c(w,b)}});return e};e.replaceElement=function(t,b){b=g(E,b);if(typeof b.textShadow=="string")b.textShadow=q.textShadow(b.textShadow);return c(t,b)};e.engines=u;e.fonts=v;e.getOptions=function(){return g(E)};
e.set=function(t,b){E[t]=b;return e};return e}();
Cufon.registerEngine("canvas",function(){var m=document.createElement("canvas");if(!(!m||!m.getContext||!m.getContext.apply)){m=null;var p=Cufon.CSS.supports("display","inline-block");m=!p&&(document.compatMode=="BackCompat"||/frameset|transitional/i.test(document.doctype.publicId));var f=document.createElement("style");f.type="text/css";f.appendChild(document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(m?
"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(p?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}"));document.getElementsByTagName("head")[0].appendChild(f);return function(h,o,l,g,a,c){function e(D,G){B.strokeStyle=G;B.beginPath();B.moveTo(0,
D);B.lineTo(z,D);B.stroke()}function n(){for(var D=0,G=w.length;D<G;++D){var F=h.glyphs[w[D]]||h.missingGlyph;if(F){B.beginPath();if(F.d)if(F.code)for(var H=F.code,L=B,I=0,M=H.length;I<M;++I){var K=H[I];L[K.m].apply(L,K.a)}else{H=F;L="m"+F.d;I=B;K=M=0;var N=[],Q=/([mrvxe])([^a-z]*)/g,P=void 0,O=0;a:for(;P=Q.exec(L);++O){var J=P[2].split(",");switch(P[1]){case "v":N[O]={m:"bezierCurveTo",a:[M+~~J[0],K+~~J[1],M+~~J[2],K+~~J[3],M+=~~J[4],K+=~~J[5]]};break;case "r":N[O]={m:"lineTo",a:[M+=~~J[0],K+=~~J[1]]};
break;case "m":N[O]={m:"moveTo",a:[M=~~J[0],K=~~J[1]]};break;case "x":N[O]={m:"closePath"};break;case "e":break a}I[N[O].m].apply(I,N[O].a)}H.code=N}B.fill();B.translate(Number(F.w||h.w)+y,0)}}}var q=o===null,s=h.viewBox,x=l.getSize("fontSize",h.baseSize),y=l.get("letterSpacing");y=y=="normal"?0:x.convertFrom(parseInt(y,10));var A=0,u=0,v=0,E=0,C=g.textShadow,t=[];if(C)for(var b=0,d=C.length;b<d;++b){var k=C[b],r=x.convertFrom(parseFloat(k.offX));k=x.convertFrom(parseFloat(k.offY));t[b]=[r,k];if(k<
A)A=k;if(r>u)u=r;if(k>v)v=k;if(r<E)E=r}var w=Cufon.CSS.textTransform(q?a.alt:o,l).split(""),z=0;k=null;b=0;for(d=w.length;b<d;++b)if(r=h.glyphs[w[b]]||h.missingGlyph)z+=k=Number(r.w||h.w)+y;if(k===null)return null;u+=s.width-k;E+=s.minX;if(q){q=a;b=a.firstChild}else{q=document.createElement("span");q.className="cufon cufon-canvas";q.alt=o;b=document.createElement("canvas");q.appendChild(b);if(g.printable){d=document.createElement("span");d.className="cufon-alt";d.appendChild(document.createTextNode(o));
q.appendChild(d)}}o=q.style;d=b.style;a=x.convert(s.height-A+v);v=Math.ceil(a);a=v/a;b.width=Math.ceil(x.convert(z+u-E)*a);b.height=v;A+=s.minY;d.top=Math.round(x.convert(A-h.ascent))+"px";d.left=Math.round(x.convert(E))+"px";u=Math.ceil(x.convert(z*a));d=u+"px";x=x.convert(h.height);Cufon.textOptions.width=u;Cufon.textOptions.height=x;if(p){o.width=d;o.height=x+"px"}else{o.paddingLeft=d;o.paddingBottom=x-1+"px"}var B=Cufon.textOptions.context||b.getContext("2d");s=v/s.height;B.save();B.scale(s,s);
B.translate(-E-1/s*b.width/2+(Cufon.fonts[h.family].offsetLeft||0),-A-1/s*b.height/2);B.lineWidth=h.face["underline-thickness"];B.save();g=g.enableTextDecoration?Cufon.CSS.textDecoration(c,l):{};g.underline&&e(-h.face["underline-position"],g.underline);g.overline&&e(h.ascent,g.overline);B.fillStyle=Cufon.textOptions.color||l.get("color");if(C){b=0;for(d=C.length;b<d;++b){k=C[b];B.save();B.fillStyle=k.color;B.translate.apply(B,t[b]);n();B.restore()}}n();B.restore();B.restore();g["line-through"]&&e(-h.descent,
g["line-through"]);return q}}}());
Cufon.registerEngine("vml",function(){function m(f,h){if(/px$/i.test(h))return parseFloat(h);var o=f.style.left,l=f.runtimeStyle.left;f.runtimeStyle.left=f.currentStyle.left;f.style.left=h;var g=f.style.pixelLeft;f.style.left=o;f.runtimeStyle.left=l;return g}if(document.namespaces){document.namespaces.cvml==null&&document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var p=document.createElement("cvml:shape");p.style.behavior="url(#default#VML)";if(p.coordsize){p=null;document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');
return function(f,h,o,l,g,a,c){var e=h===null;if(e)h=g.alt;var n=f.viewBox,q;if(!(q=o.computedFontSize)){q=Cufon.CSS.Size;var s;s=o.get("fontSize");s=m(a,/(?:em|ex|%)$/i.test(s)?"1em":s);q=o.computedFontSize=new q(s+"px",f.baseSize)}q=q;s=o.computedLSpacing;if(s==undefined){s=o.get("letterSpacing");o.computedLSpacing=s=s=="normal"?0:~~q.convertFrom(m(a,s))}var x;if(e){x=g;g=g.firstChild}else{x=document.createElement("span");x.className="cufon cufon-vml";x.alt=h;g=document.createElement("span");g.className=
"cufon-vml-canvas";x.appendChild(g);if(l.printable){var y=document.createElement("span");y.className="cufon-alt";y.appendChild(document.createTextNode(h));x.appendChild(y)}c||x.appendChild(document.createElement("cvml:shape"))}c=x.style;var A=g.style,u=q.convert(n.height);y=Math.ceil(u);u=y/u;var v=n.minX,E=n.minY;A.height=y;A.top=Math.round(q.convert(E-f.ascent));A.left=Math.round(q.convert(v));c.height=q.convert(f.height)+"px";l.enableTextDecoration&&Cufon.CSS.textDecoration(a,o);a=o.get("color");
h=Cufon.CSS.textTransform(h,o).split("");A=o=0;var C=null,t;l=l.textShadow;for(var b=0,d=0,k=h.length;b<k;++b)if(t=f.glyphs[h[b]]||f.missingGlyph)o+=C=~~(t.w||f.w)+s;if(C===null)return null;t=-v+o+(n.width-C);b=q.convert(t*u);C=Math.round(b);var r=t+","+n.height,w,z="r"+r+"nsnf";for(b=0;b<k;++b)if(t=f.glyphs[h[b]]||f.missingGlyph){if(e){n=g.childNodes[d];n.firstChild&&n.removeChild(n.firstChild)}else{n=document.createElement("cvml:shape");g.appendChild(n)}n.stroked="f";n.coordsize=r;n.coordorigin=
w=v-A+","+E;n.path=(t.d?"m"+t.d+"xe":"")+"m"+w+z;n.fillcolor=a;w=n.style;w.width=C;w.height=y;if(l){w=l[0];var B=l[1],D=Cufon.CSS.color(w.color),G,F=document.createElement("cvml:shadow");F.on="t";F.color=D.color;F.offset=w.offX+","+w.offY;if(B){G=Cufon.CSS.color(B.color);F.type="double";F.color2=G.color;F.offset2=B.offX+","+B.offY}F.opacity=D.opacity||G&&G.opacity||1;n.appendChild(F)}A+=~~(t.w||f.w)+s;++d}c.width=Math.max(Math.ceil(q.convert(o*u)),0);return x}}}}());
(function(){function m(l,g){for(var a in g)l[a]=g[a];return l}function p(l,g){var a=document.createElement(l);for(var c in g)if(c==="class")a.className=g[c];else if(c==="for")a.htmlFor=g[c];else a.setAttribute(c,g[c]);return a}var f=this.fabric||(this.fabric={}),h=Array.prototype.slice,o=Function.prototype.apply;f.util={};(function(){var l=Math.PI/180;f.util.removeFromArray=function(g,a){var c=g.indexOf(a);c!==-1&&g.splice(c,1);return g};f.util.degreesToRadians=function(g){return g*l};f.util.toFixed=
function(g,a){return parseFloat(Number(g).toFixed(a))};f.util.getRandomInt=function(g,a){return Math.floor(Math.random()*(a-g+1))+g};f.util.falseFunction=function(){return false}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(l,g){var a=this.length>>>0;g=Number(g)||0;g=Math[g<0?"ceil":"floor"](g);if(g<0)g+=a;for(;g<a;g++)if(g in this&&this[g]===l)return g;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(l,g){for(var a=0,c=this.length>>>0;a<c;a++)a in this&&
l.call(g,this[a],a,this)};if(!Array.prototype.map)Array.prototype.map=function(l,g){for(var a=[],c=0,e=this.length>>>0;c<e;c++)if(c in this)a[c]=l.call(g,this[c],c,this);return a};if(!Array.prototype.every)Array.prototype.every=function(l,g){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&!l.call(g,this[a],a,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(l,g){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&l.call(g,this[a],a,this))return true;return false};
if(!Array.prototype.filter)Array.prototype.filter=function(l,g){for(var a=[],c,e=0,n=this.length>>>0;e<n;e++)if(e in this){c=this[e];l.call(g,c,e,this)&&a.push(c)}return a};if(!Array.prototype.reduce)Array.prototype.reduce=function(l){var g=this.length>>>0,a=0,c;if(arguments.length>1)c=arguments[1];else{do{if(a in this){c=this[a++];break}if(++a>=g)throw new TypeError;}while(1)}for(;a<g;a++)if(a in this)c=l.call(null,c,this[a],a,this);return c};f.util.array={invoke:function(l,g){for(var a=h.call(arguments,
2),c=[],e=0,n=l.length;e<n;e++)c[e]=a.length?l[e][g].apply(l[e],a):l[e][g].call(l[e]);return c},min:function(l,g){var a=l.length-1,c=g?l[a][g]:l[a];if(g)for(;a--;){if(l[a][g]<c)c=l[a][g]}else for(;a--;)if(l[a]<c)c=l[a];return c},max:function(l,g){var a=l.length-1,c=g?l[a][g]:l[a];if(g)for(;a--;){if(l[a][g]>=c)c=l[a][g]}else for(;a--;)if(l[a]>=c)c=l[a];return c}};f.util.object={extend:m,clone:function(l){return m({},l)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,
"").replace(/[\s\xA0]+$/,"")};f.util.string={camelize:function(l){return l.replace(/-+(.)?/g,function(g,a){return a?a.toUpperCase():""})},capitalize:function(l){return l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(l){var g=this,a=h.call(arguments,1);return a.length?function(){return o.call(g,l,a.concat(h.call(arguments)))}:function(){return o.call(g,l,arguments)}};(function(){function l(){}var g;g=function(){for(var a in{toString:1})if(a===
"toString")return false;return true}()?function(a,c){if(c.toString!==Object.prototype.toString)a.prototype.toString=c.toString;if(c.valueOf!==Object.prototype.valueOf)a.prototype.valueOf=c.valueOf;for(var e in c)a.prototype[e]=c[e]}:function(a,c){for(var e in c)a.prototype[e]=c[e]};f.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var c=null,e=h.call(arguments,0);if(typeof e[0]==="function")c=e.shift();a.superclass=c;a.subclasses=[];if(c){l.prototype=c.prototype;a.prototype=
new l;c.subclasses.push(a)}c=0;for(var n=e.length;c<n;c++)g(a,e[c]);if(!a.prototype.initialize)a.prototype.initialize=emptyFunction;return a.prototype.constructor=a}})();(function(){function l(u){var v=Array.prototype.slice.call(arguments,1),E,C,t=v.length;for(C=0;C<t;C++){E=typeof u[v[C]];if(!/^(?:function|object|unknown)$/.test(E))return false}return true}function g(u,v){return function(E){v.call(e(u),E||window.event)}}function a(u,v){return function(E){if(y[u]&&y[u][v])for(var C=y[u][v],t=0,b=
C.length;t<b;t++)C[t].call(this,E||window.event)}}var c=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(v){return v.uniqueID};var u=0;return function(v){return v.__uniqueID||(v.__uniqueID="uniqueID__"+u++)}}(),e,n;(function(){var u={};e=function(v){return u[v]};n=function(v,E){u[v]=E}})();var q=l(document.documentElement,"addEventListener","removeEventListener")&&l(window,"addEventListener","removeEventListener"),s=l(document.documentElement,"attachEvent","detachEvent")&&
l(window,"attachEvent","detachEvent"),x={},y={};if(q){q=function(u,v,E){u.addEventListener(v,E,false)};s=function(u,v,E){u.removeEventListener(v,E,false)}}else if(s){q=function(u,v,E){var C=c(u);n(C,u);x[C]||(x[C]={});x[C][v]||(x[C][v]=[]);E={handler:E,wrappedHandler:g(C,E)};x[C][v].push(E);u.attachEvent("on"+v,E.wrappedHandler)};s=function(u,v,E){var C=c(u),t;if(x[C]&&x[C][v])for(var b=0,d=x[C][v].length;b<d;b++)if((t=x[C][v][b])&&t.handler===E){u.detachEvent("on"+v,t.wrappedHandler);x[C][v][b]=
null}}}else{q=function(u,v,E){var C=c(u);y[C]||(y[C]={});if(!y[C][v]){y[C][v]=[];var t=u["on"+v];t&&y[C][v].push(t);u["on"+v]=a(C,v)}y[C][v].push(E)};s=function(u,v,E){u=c(u);if(y[u]&&y[u][v]){v=y[u][v];u=0;for(var C=v.length;u<C;u++)v[u]===E&&v.splice(u,1)}}}f.util.addListener=q;f.util.removeListener=s;var A={};f.util.getPointer=function(u){var v=document.documentElement,E=document.body||{scrollLeft:0},C=document.documentElement,t=document.body||{scrollTop:0};return{x:u.pageX||(typeof u.clientX!=
"unknown"?u.clientX:0)+(v.scrollLeft||E.scrollLeft)-(v.clientLeft||0),y:u.pageY||(typeof u.clientY!="unknown"?u.clientY:0)+(C.scrollTop||t.scrollTop)-(C.clientTop||0)}};f.util.observeEvent=function(u,v){A[u]||(A[u]=[]);A[u].push(v)};f.util.fireEvent=function(u,v){var E=A[u];if(E)for(var C=0,t=E.length;C<t;C++)E[C]({memo:v})}})(this);(function(){var l=document.createElement("div"),g=typeof l.style.filter==="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(e){return e};if(typeof l.style.opacity===
"string")c=function(e,n){e.style.opacity=n;return e};else if(g)c=function(e,n){var q=e.style;if(e.currentStyle&&!e.currentStyle.hasLayout)q.zoom=1;if(a.test(q.filter)){n=n>=0.9999?"":"alpha(opacity="+n*100+")";q.filter=q.filter.replace(a,n)}else q.filter+=" alpha(opacity="+n*100+")";return e};f.util.setStyle=function(e,n){var q=e.style;if(typeof n==="string"){e.style.cssText+=";"+n;return n.indexOf("opacity")>-1?c(e,n.match(/opacity:\s*(\d?\.?\d*)/)[1]):e}for(var s in n)if(s==="opacity")c(e,n[s]);
else q[s==="float"||s==="cssFloat"?typeof q.styleFloat==="undefined"?"cssFloat":"styleFloat":s]=n[s];return e}})();(function(){var l=document.documentElement.style,g="userSelect"in l?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"";f.util.makeElementUnselectable=function(a){if(typeof a.onselectstart!=="undefined")a.onselectstart=f.util.falseFunction;if(g)a.style[g]="none";else if(typeof a.unselectable=="string")a.unselectable=
"on";return a}})();(function(){function l(a,c){g.load(a);c()}f.util.getScript=function(a,c){var e=document.getElementsByTagName("head")[0],n=document.createElement("script"),q=true;n.type="text/javascript";n.setAttribute("runat","server");n.onload=n.onreadystatechange=function(s){if(q)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){q=false;c(s||window.event);n=n.onload=n.onreadystatechange=null}};n.src=a;e.appendChild(n)};var g=this.Jaxer;if(g&&g.load)f.util.getScript=
l})();f.util.getById=function(l){return typeof l==="string"?document.getElementById(l):l};f.util.toArray=function(l){for(var g=[],a=l.length;a--;)g[a]=l[a];return g};f.util.makeElement=p;f.util.addClass=function(l,g){if((" "+l.className+" ").indexOf(" "+g+" ")===-1)l.className+=(l.className?" ":"")+g};f.util.wrapElement=function(l,g,a){if(typeof g==="string")g=p(g,a);l.parentNode&&l.parentNode.replaceChild(g,l);g.appendChild(l);return g};f.util.getElementOffset=function(l){var g=0,a=0;do{g+=l.offsetTop||
0;a+=l.offsetLeft||0;l=l.offsetParent}while(l);return{left:a,top:g}};f.util.animate=function(l){l||(l={});var g=+new Date,a=l.duration||500,c=g+a,e,n,q=l.onChange||function(){},s=l.easing||function(v){return-Math.cos(v*Math.PI)/2+0.5},x="startValue"in l?l.startValue:0,y="endValue"in l?l.endValue:100,A=x>y;l.onStart&&l.onStart();var u=setInterval(function(){e=+new Date;n=e>c?1:(e-g)/a;q(A?x-(x-y)*s(n):x+(y-x)*s(n));if(e>c){clearInterval(u);l.onComplete&&l.onComplete()}},10)};(function(){function l(){}
var g=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(e){}}();f.util.request=function(a,c){c||(c={});var e=c.method?c.method.toUpperCase():"GET",n=c.onComplete||function(){},q=g(),s;q.onreadystatechange=function(){if(q.readyState===4){n(q);q.onreadystatechange=l}};if(e===
"GET"){s=null;if(typeof c.parameters=="string")a=a+(/\?/.test(a)?"&":"?")+c.parameters}q.open(e,a,true);if(e==="POST"||e==="PUT")q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(s);return q}})()})(this);
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.string.capitalize,h=m.util.object.clone,o={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};m.parseTransformAttribute=function(){function l(q,s){var x=s[0];q[0]=Math.cos(x);q[1]=Math.sin(x);q[2]=-Math.sin(x);q[3]=Math.cos(x)}function g(q,s){var x=s.length===2?s[1]:s[0];q[0]=s[0];q[3]=x}function a(q,s){q[4]=s[0];if(s.length===
2)q[5]=s[1]}var c=[1,0,0,1,0,0],e=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
n=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(q){var s=c.concat();if(!q||q&&!e.test(q))return s;q.replace(n,function(x){var y=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(x).filter(function(A){return A!==
""&&A!=null});x=y[1];y=y.slice(2).map(parseFloat);switch(x){case "translate":a(s,y);break;case "rotate":l(s,y);break;case "scale":g(s,y);break;case "skewX":s[2]=y[0];break;case "skewY":s[1]=y[0];break;case "matrix":s=y;break}});return s}}();m.parseSVGDocument=function(){var l=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,g=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(a,c){if(a){var e=m.util.toArray(a.getElementsByTagName("*")).filter(function(A){var u;if(u=l.test(A.tagName)){a:{for(A=A;A&&(A=A.parentNode);)if(A.nodeName==="pattern"){A=true;break a}A=false}u=!A}return u});if(!(!e||e&&!e.length)){var n=a.getAttribute("viewBox"),q=a.getAttribute("width"),s=a.getAttribute("height"),x=null,y=null;if(n&&(n=n.match(g))){parseInt(n[1],10);parseInt(n[2],10);x=parseInt(n[3],10);y=parseInt(n[4],10)}x=q?parseFloat(q):x;y=s?parseFloat(s):y;n={width:x,height:y};
e=m.parseElements(e,h(n));!e||e&&!e.length||c&&c(e,n)}}}}();p(m,{parseAttributes:function(l,g){if(l){var a,c,e={};if(l.parentNode&&/^g$/i.test(l.parentNode.nodeName))e=m.parseAttributes(l.parentNode,g);var n=g.reduce(function(q,s){a=l.getAttribute(s);c=parseFloat(a);if(a){if((s==="fill"||s==="stroke")&&a==="none")a="";if(s==="fill-rule")a=a==="evenodd"?"destination-over":a;if(s==="transform")a=m.parseTransformAttribute(a);if(s in o)s=o[s];q[s]=isNaN(c)?a:c}return q},{});n=p(m.parseStyleAttribute(l),
n);return p(e,n)}},parseElements:function(l,g){var a=l.map(function(c){var e=m[f(c.tagName)];if(e&&e.fromElement)try{return e.fromElement(c,g)}catch(n){m.log(n.message||n)}});return a=a.filter(function(c){return c!=null})},parseStyleAttribute:function(l){var g={};if(l=l.getAttribute("style"))if(typeof l=="string"){l=l.split(";");l.pop();g=l.reduce(function(c,e){var n=e.split(":"),q=n[0].trim();n=n[1].trim();c[q]=n;return c},{})}else for(var a in l)if(typeof l[a]!=="undefined")g[a]=l[a];return g},
parsePointsAttribute:function(l){if(!l)return null;l=l.trim();var g=l.indexOf(",")>-1;l=l.split(/\s+/);var a=[];if(g){g=0;for(var c=l.length;g<c;g++){var e=l[g].split(",");a.push({x:parseFloat(e[0]),y:parseFloat(e[1])})}}else{g=0;for(c=l.length;g<c;g+=2)a.push({x:parseFloat(l[g]),y:parseFloat(l[g+1])})}return a}})})();
(function(){function m(f,h){arguments.length>0&&this.init(f,h)}var p=this.fabric||(this.fabric={});if(p.Point)p.warn("fabric.Point is already defined");else{p.Point=m;m.prototype={constructor:m,init:function(f,h){this.x=f;this.y=h},add:function(f){return new m(this.x+f.x,this.y+f.y)},addEquals:function(f){this.x+=f.x;this.y+=f.y;return this},scalarAdd:function(f){return new m(this.x+f,this.y+f)},scalarAddEquals:function(f){this.x+=f;this.y+=f;return this},subtract:function(f){return new m(this.x-
f.x,this.y-f.y)},subtractEquals:function(f){this.x-=f.x;this.y-=f.y;return this},scalarSubtract:function(f){return new m(this.x-f,this.y-f)},scalarSubtractEquals:function(f){this.x-=f;this.y-=f;return this},multiply:function(f){return new m(this.x*f,this.y*f)},multiplyEquals:function(f){this.x*=f;this.y*=f;return this},divide:function(f){return new m(this.x/f,this.y/f)},divideEquals:function(f){this.x/=f;this.y/=f;return this},eq:function(f){return this.x==f.x&&this.y==f.y},lt:function(f){return this.x<
f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,h){return new m(this.x+(f.x-this.x)*h,this.y+(f.y-this.y)*h)},distanceFrom:function(f){var h=this.x-f.x;f=this.y-f.y;return Math.sqrt(h*h+f*f)},min:function(f){return new m(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new m(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+
","+this.y},setXY:function(f,h){this.x=f;this.y=h},setFromPoint:function(f){this.x=f.x;this.y=f.y},swap:function(f){var h=this.x,o=this.y;this.x=f.x;this.y=f.y;f.x=h;f.y=o}}}})();
(function(){function m(f){arguments.length>0&&this.init(f)}var p=this.fabric||(this.fabric={});if(p.Intersection)p.warn("fabric.Intersection is already defined");else{p.Intersection=m;p.Intersection.prototype={init:function(f){this.status=f;this.points=[]},appendPoint:function(f){this.points.push(f)},appendPoints:function(f){this.points=this.points.concat(f)}};p.Intersection.intersectLineLine=function(f,h,o,l){var g,a=(l.x-o.x)*(f.y-o.y)-(l.y-o.y)*(f.x-o.x);g=(h.x-f.x)*(f.y-o.y)-(h.y-f.y)*(f.x-o.x);
o=(l.y-o.y)*(h.x-f.x)-(l.x-o.x)*(h.y-f.y);if(o!=0){a=a/o;g=g/o;if(0<=a&&a<=1&&0<=g&&g<=1){g=new m("Intersection");g.points.push(new p.Point(f.x+a*(h.x-f.x),f.y+a*(h.y-f.y)))}else g=new m("No Intersection")}else g=a==0||g==0?new m("Coincident"):new m("Parallel");return g};p.Intersection.intersectLinePolygon=function(f,h,o){for(var l=new m("No Intersection"),g=o.length,a=0;a<g;a++){var c=m.intersectLineLine(f,h,o[a],o[(a+1)%g]);l.appendPoints(c.points)}if(l.points.length>0)l.status="Intersection";return l};
p.Intersection.intersectPolygonPolygon=function(f,h){for(var o=new m("No Intersection"),l=f.length,g=0;g<l;g++){var a=m.intersectLinePolygon(f[g],f[(g+1)%l],h);o.appendPoints(a.points)}if(o.points.length>0)o.status="Intersection";return o};p.Intersection.intersectPolygonRectangle=function(f,h,o){var l=h.min(o),g=h.max(o);o=new p.Point(g.x,l.y);var a=new p.Point(l.x,g.y);h=m.intersectLinePolygon(l,o,f);o=m.intersectLinePolygon(o,g,f);g=m.intersectLinePolygon(g,a,f);f=m.intersectLinePolygon(a,l,f);
l=new m("No Intersection");l.appendPoints(h.points);l.appendPoints(o.points);l.appendPoints(g.points);l.appendPoints(f.points);if(l.points.length>0)l.status="Intersection";return l}}})();
(function(){function m(f){f?this._tryParsingColor(f):this.setSource([0,0,0,1])}var p=this.fabric||(this.fabric={});if(p.Color)p.warn("fabric.Color is already defined.");else{p.Color=m;p.Color.prototype={_tryParsingColor:function(f){var h=m.sourceFromHex(f);h||(h=m.sourceFromRgb(f));h&&this.setSource(h)},getSource:function(){return this._source},setSource:function(f){this._source=f},toRgb:function(){var f=this.getSource();return"rgb("+f[0]+","+f[1]+","+f[2]+")"},toRgba:function(){var f=this.getSource();
return"rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+")"},toHex:function(){var f=this.getSource(),h=f[0].toString(16);h=h.length==1?"0"+h:h;var o=f[1].toString(16);o=o.length==1?"0"+o:o;f=f[2].toString(16);f=f.length==1?"0"+f:f;return h.toUpperCase()+o.toUpperCase()+f.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var h=this.getSource();h[3]=f;this.setSource(h);return this},toGrayscale:function(){var f=this.getSource(),h=parseInt((f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),
10);this.setSource([h,h,h,f[3]]);return this},toBlackWhite:function(f){var h=this.getSource(),o=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0);h=h[3];f=f||127;o=Number(o)<Number(f)?0:255;this.setSource([o,o,o,h]);return this},overlayWith:function(f){f instanceof m||(f=new m(f));var h=[],o=this.getAlpha(),l=this.getSource();f=f.getSource();for(var g=0;g<3;g++)h.push(Math.round(l[g]*0.5+f[g]*0.5));h[4]=o;this.setSource(h);return this}};p.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;
p.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;p.Color.fromRgb=function(f){return m.fromSource(m.sourceFromRgb(f))};p.Color.sourceFromRgb=function(f){if(f=f.match(m.reRGBa))return[parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10),f[4]?parseFloat(f[4]):1]};p.Color.fromRgba=m.fromRgb;p.Color.fromHex=function(f){return m.fromSource(m.sourceFromHex(f))};p.Color.sourceFromHex=function(f){if(f.match(m.reHex)){var h=f.slice(f.indexOf("#")+1),o=h.length===3;f=o?h.charAt(0)+h.charAt(0):h.substring(0,2);
var l=o?h.charAt(1)+h.charAt(1):h.substring(2,4);h=o?h.charAt(2)+h.charAt(2):h.substring(4,6);return[parseInt(f,16),parseInt(l,16),parseInt(h,16),1]}};p.Color.fromSource=function(f){var h=new m;h.setSource(f);return h}}})();
(function(){if(fabric.Element)fabric.warn("fabric.Element is already defined.");else{var m=this.window,p=m.document,f=fabric.util.object.extend,h=fabric.util.string.capitalize,o=fabric.util.string.camelize,l=fabric.util.fireEvent,g=fabric.util.getPointer,a=fabric.util.getElementOffset,c=fabric.util.removeFromArray,e=fabric.util.addListener,n=fabric.util.removeListener,q=fabric.util.array.min,s=fabric.util.array.max,x=Math.sqrt,y=Math.pow,A=Math.atan2,u=Math.abs,v=Math.min,E=Math.max,C=Error("Could not initialize `canvas` element"),
t={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(b,d){this._groupSelector=null;this._objects=[];this._activeGroup=this._currentTransform=this._element=this._context=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._config={width:300,height:150};d=d||{};this._initElement(b);this._initConfig(d);d.overlayImage&&this.setOverlayImage(d.overlayImage);if(d.afterRender)this.afterRender=d.afterRender;
this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};f(fabric.Element.prototype,{selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",freeDrawingColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0)",freeDrawingLineWidth:1,selectionLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},calcOffset:function(){this._offset=
a(this.getElement());return this},setOverlayImage:function(b,d){if(b){var k=this,r=new Image;r.onload=function(){k.overlayImage=r;d&&d();r=r.onload=null};r.src=b}return this},_initElement:function(b){this._element=fabric.util.getById(b)||p.createElement("canvas");typeof this._element.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(this._element);if(typeof this._element.getContext==="undefined")throw C;if(!(this.contextTop=this._element.getContext("2d")))throw C;
b=this._element.width||0;var d=this._element.height||0;this._initWrapperElement(b,d);this._setElementStyle(b,d)},_initWrapperElement:function(b,d){var k=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(k,{width:b+"px",height:d+"px"});fabric.util.makeElementUnselectable(k);this.wrapper=k},_setElementStyle:function(b,d){fabric.util.setStyle(this.getElement(),{position:"absolute",width:b+"px",height:d+"px",left:0,top:0})},_initConfig:function(b){f(this._config,
b||{});this._config.width=parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var b=this;this._onMouseDown=function(d){b.__onMouseDown(d)};this._onMouseUp=function(d){b.__onMouseUp(d)};this._onMouseMove=function(d){b.__onMouseMove(d)};this._onResize=function(){b.calcOffset()};e(this._element,"mousedown",this._onMouseDown);e(p,"mousemove",
this._onMouseMove);e(p,"mouseup",this._onMouseUp);e(m,"resize",this._onResize)},_createCanvasElement:function(b){var d=p.createElement("canvas");if(d){d.className=b;b=this._element.parentNode.insertBefore(d,this._element);b.width=this.getWidth();b.height=this.getHeight();b.style.width=this.getWidth()+"px";b.style.height=this.getHeight()+"px";b.style.position="absolute";b.style.left=0;b.style.top=0;typeof d.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(d);
if(typeof d.getContext==="undefined")throw C;fabric.util.makeElementUnselectable(b);return b}},_createCanvasContainer:function(){var b=this._createCanvasElement("canvas-container");this.contextContainerEl=b;this.contextContainer=b.getContext("2d")},_createCanvasBackground:function(){var b=this._createCanvasElement("canvas-container");this._contextBackgroundEl=b;this._contextBackground=b.getContext("2d")},getWidth:function(){return this._config.width},getHeight:function(){return this._config.height},
setWidth:function(b){return this._setDimension("width",b)},setHeight:function(b){return this._setDimension("height",b)},setDimensions:function(b){for(var d in b)this._setDimension(d,b[d]);return this},_setDimension:function(b,d){this.contextContainerEl[b]=d;this.contextContainerEl.style[b]=d+"px";this._contextBackgroundEl[b]=d;this._contextBackgroundEl.style[b]=d+"px";this._element[b]=d;this._element.style[b]=d+"px";this._element.parentNode.style[b]=d+"px";this._config[b]=d;this.calcOffset();this.renderAll();
return this},__onMouseUp:function(b){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._finalizeDrawingPath();else{if(this._currentTransform){var d=this._currentTransform.target;if(d._scaling){l("object:scaled",{target:d});d._scaling=false}for(var k=this._objects.length;k--;)this._objects[k].setCoords();if(d.hasStateChanged()){d.isMoving=false;l("object:modified",{target:d})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(b);if(k=this.getActiveGroup()){k.hasStateChanged()&&
k.containsPoint(this.getPointer(b))&&l("group:modified",{target:k});k.setObjectsCoords();k.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(b,d);this._setCursor("");var r=this;setTimeout(function(){r._setCursorFromEvent(b,d)},50)}},_shouldClearSelection:function(b){var d=this.findTarget(b),k=this.getActiveGroup();return!d||d&&k&&!k.contains(d)&&k!==d&&!b.shiftKey},__onMouseDown:function(b){if(this.isDrawingMode){this._prepareForDrawing(b);
this._captureDrawingPath(b)}else if(!this._currentTransform){var d=this.findTarget(b),k=this.getPointer(b),r=this.getActiveGroup();if(this._shouldClearSelection(b)){this._groupSelector={ex:k.x,ey:k.y,top:0,left:0};this.deactivateAllWithDispatch()}else{d.saveState();d._findTargetCorner(b,this._offset)&&this.onBeforeScaleRotate(d);this._setupCurrentTransform(b,d);if(b.shiftKey&&(r||this.getActiveObject()))this._handleGroupLogic(b,d);else{d!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(d)}}this.renderAll()}},
getElement:function(){return this._element},deactivateAllWithDispatch:function(){var b=this.getActiveGroup();b&&l("before:group:destroyed",{target:b});this.deactivateAll();b&&l("after:group:destroyed");l("selection:cleared");return this},_setupCurrentTransform:function(b,d){var k="drag",r,w=g(b);if(r=d._findTargetCorner(b,this._offset))k=r==="ml"||r==="mr"?"scaleX":r==="mt"||r==="mb"?"scaleY":"rotate";this._currentTransform={target:d,action:k,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:w.x-d.left,offsetY:w.y-
d.top,ex:w.x,ey:w.y,left:d.left,top:d.top,theta:d.theta,width:d.width*d.scaleX};this._currentTransform.original={left:d.left,top:d.top}},_handleGroupLogic:function(b,d){if(d.isType("group")){d=this.findTarget(b,true);if(!d||d.isType("group"))return}var k=this.getActiveGroup();if(k){if(k.contains(d)){k.remove(d);d.setActive(false);k.size()===1&&this.removeActiveGroup()}else k.add(d);l("group:selected",{target:k});k.setActive(true)}else{if(this._activeObject)if(d!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,
d]));k=this.getActiveGroup()}d.setActive(true)}k&&k.saveCoords()},_prepareForDrawing:function(b){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();b=this.getPointer(b);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(b.x);this._freeDrawingYPoints.push(b.y);this.contextTop.beginPath();this.contextTop.moveTo(b.x,b.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=
this.contextTop.lineJoin="round"},_captureDrawingPath:function(b){b=this.getPointer(b);this._freeDrawingXPoints.push(b.x);this._freeDrawingYPoints.push(b.y);this.contextTop.lineTo(b.x,b.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var b=q(this._freeDrawingXPoints),d=q(this._freeDrawingYPoints),k=s(this._freeDrawingXPoints),r=s(this._freeDrawingYPoints),w=[],z=this._freeDrawingXPoints,B=this._freeDrawingYPoints;w.push("M ",
z[0]-b," ",B[0]-d," ");for(var D=1;xPoint=z[D],yPoint=B[D];D++)w.push("L ",xPoint-b," ",yPoint-d," ");w=new fabric.Path(w.join(""));w.fill=null;w.stroke=this.freeDrawingColor;w.strokeWidth=this.freeDrawingLineWidth;this.add(w);w.set("left",b+(k-b)/2).set("top",d+(r-d)/2).setCoords();this.renderAll();l("path:created",{path:w})},__onMouseMove:function(b){if(this.isDrawingMode)this._isCurrentlyDrawing&&this._captureDrawingPath(b);else{var d=this._groupSelector;if(d!==null){var k=g(b);d.left=k.x-this._offset.left-
d.ex;d.top=k.y-this._offset.top-d.ey;this.renderTop()}else if(this._currentTransform){k=g(b);d=k.x;k=k.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){b.shiftKey||this._rotateObject(d,k);this._scaleObject(d,k)}else if(this._currentTransform.action==="scaleX")this._scaleObject(d,k,"x");else this._currentTransform.action==="scaleY"?this._scaleObject(d,k,"y"):this._translateObject(d,k);this.renderAll()}else{k=this._element.style;if(d=this.findTarget(b)){this._setCursorFromEvent(b,
d);d.isActive()&&d.setCornersVisibility&&d.setCornersVisibility(true)}else{for(b=this._objects.length;b--;)this._objects[b].active||this._objects[b].setActive(false);k.cursor="default"}}}},_translateObject:function(b,d){var k=this._currentTransform.target;k.lockHorizontally||k.set("left",b-this._currentTransform.offsetX);k.lockVertically||k.set("top",d-this._currentTransform.offsetY)},_scaleObject:function(b,d,k){var r=this._currentTransform,w=this._offset,z=r.target;if(!z.lockScaling){var B=x(y(r.ey-
r.top-w.top,2)+y(r.ex-r.left-w.left,2));b=x(y(d-r.top-w.top,2)+y(b-r.left-w.left,2));z._scaling=true;if(k)if(k==="x")z.set("scaleX",r.scaleX*b/B);else k==="y"&&z.set("scaleY",r.scaleY*b/B);else{z.set("scaleX",r.scaleX*b/B);z.set("scaleY",r.scaleY*b/B)}}},_rotateObject:function(b,d){var k=this._currentTransform,r=this._offset;if(!k.target.lockRotation){var w=A(k.ey-k.top-r.top,k.ex-k.left-r.left);r=A(d-k.top-r.top,b-k.left-r.left);k.target.set("theta",r-w+k.theta)}},_setCursor:function(b){this._element.style.cursor=
b},_setCursorFromEvent:function(b,d){var k=this._element.style;if(d){var r=this.getActiveGroup();if(r=!!d._findTargetCorner&&(!r||!r.contains(d))&&d._findTargetCorner(b,this._offset))if(r in t)k.cursor=t[r];else{k.cursor="default";return false}else k.cursor="move"}else{k.cursor="default";return false}return true},_draw:function(b,d){d&&d.render(b)},_drawSelection:function(){var b=this._groupSelector,d=b.left,k=b.top,r=u(d),w=u(k);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(b.ex-
(d>0?0:-d),b.ey-(k>0?0:-k),r,w);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(b.ex+0.5-(d>0?0:r),b.ey+0.5-(k>0?0:w),r,w)},_findSelectedObjects:function(){var b=[],d=this._groupSelector.ex,k=this._groupSelector.ey,r=d+this._groupSelector.left,w=k+this._groupSelector.top,z=new fabric.Point(v(d,r),v(k,w));k=new fabric.Point(E(d,r),E(k,w));r=0;for(w=this._objects.length;r<w;++r){d=this._objects[r];if(d.intersectsWithRect(z,
k)||d.isContainedWithinRect(z,k)){d.setActive(true);b.push(d)}}if(b.length===1){this.setActiveObject(b[0]);l("object:selected",{target:b[0]})}else if(b.length>1){b=new fabric.Group(b);this.setActiveGroup(b);b.saveCoords();l("group:selected",{target:b})}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);this.renderAll();return this},insertAt:function(b,d){this._objects.splice(d,0,b);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},
clearContext:function(b){b.clearRect(0,0,this._config.width,this._config.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(b){var d=this._config.width,k=this._config.height,r=b?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);b||this.clearContext(r);r.fillStyle=this.backgroundColor;r.fillRect(0,0,d,k);b=this._objects.length;d=this.getActiveGroup();
k=new Date;if(b)for(var w=0;w<b;++w)if(!d||d&&!d.contains(this._objects[w]))this._draw(r,this._objects[w]);d&&this._draw(this.contextTop,d);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this.onFpsUpdate(~~(1E3/(new Date-k)));this.afterRender&&this.afterRender();return this},renderTop:function(){this.clearContext(this.contextTop);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(this.contextTop);
this.afterRender&&this.afterRender();return this},containsPoint:function(b,d){var k=this.getPointer(b),r=this._normalizePointer(d,k);k=r.x;r=r.y;var w=d._getImageLines(d.oCoords);if((k=d._findCrossPoints(k,r,w))&&k%2===1||d._findTargetCorner(b,this._offset))return true;return false},_normalizePointer:function(b,d){var k=this.getActiveGroup(),r=d.x,w=d.y;if(k&&b.type!=="group"&&k.contains(b)){r-=k.left;w-=k.top}return{x:r,y:w}},findTarget:function(b,d){var k;this.getPointer(b);var r=this.getActiveGroup();
if(r&&!d&&this.containsPoint(b,r))return k=r;for(r=this._objects.length;r--;)if(this.containsPoint(b,this._objects[r])){this.relatedTarget=k=this._objects[r];break}return k},toDataURL:function(b){var d;b||(b="png");if(b==="jpeg"||b==="png"){this.renderAll(true);d=this.getElement().toDataURL("image/"+b);this.renderAll()}return d},toDataURLWithMultiplier:function(b,d){var k=this.getWidth(),r=this.getHeight(),w=k*d,z=r*d,B=this.getActiveObject();this.setWidth(w).setHeight(z);this.contextTop.scale(d,
d);B&&this.deactivateAll().renderAll();w=this.toDataURL(b);this.contextTop.scale(1/d,1/d);this.setWidth(k).setHeight(r);B&&this.setActiveObject(B);this.renderAll();return w},getPointer:function(b){b=g(b);return{x:b.x-this._offset.left,y:b.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(b){b.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(b,d){d=d||{};var k=function(){},r=d.onComplete||
k,w=d.onChange||k,z=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(B){b.set("left",B);z.renderAll();w()},onComplete:function(){b.setCoords();r()}});return this},centerObjectV:function(b){b.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(b,d){d=d||{};var k=function(){},r=d.onComplete||k,w=d.onChange||k,z=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,
duration:this.FX_DURATION,onChange:function(B){b.set("top",B);z.renderAll();w()},onComplete:function(){b.setCoords();r()}});return this},straightenObject:function(b){b.straighten();this.renderAll();return this},fxStraightenObject:function(b){b.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},
_toObjectMethod:function(b){return{objects:this._objects.map(function(d){if(!this.includeDefaultValues){var k=d.includeDefaultValues;d.includeDefaultValues=false}var r=d[b]();if(!this.includeDefaultValues)d.includeDefaultValues=k;return r},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(b,d){if(b){var k=JSON.parse(b);if(!(!k||k&&!k.objects)){this.clear();var r=this;this._enlivenObjects(k.objects,function(){r.backgroundColor=k.background;
d&&d()});return this}}},_enlivenObjects:function(b,d){var k=0,r=b.filter(function(z){return z.type==="image"}).length,w=this;b.forEach(function(z,B){if(z.type)switch(z.type){case "image":case "font":fabric[h(z.type)].fromObject(z,function(G){w.insertAt(G,B);++k===r&&d&&d()});break;default:var D=fabric[o(h(z.type))];D&&D.fromObject&&w.insertAt(D.fromObject(z),B);break}});r===0&&d&&d()},loadFromDatalessJSON:function(b,d){if(b){var k=typeof b==="string"?JSON.parse(b):b;if(!(!k||k&&!k.objects)){this.clear();
this.backgroundColor=k.background;this._enlivenDatalessObjects(k.objects,d)}}},_enlivenDatalessObjects:function(b,d){function k(D,G){r.insertAt(D,G);D.setCoords();++w===z&&d&&d()}var r=this,w=0,z=b.length;z===0&&d&&d();try{b.forEach(function(D,G){var F=D.paths?"paths":"path",H=D[F];delete D[F];if(typeof H!=="string")switch(D.type){case "image":case "text":fabric[h(D.type)].fromObject(D,function(I){k(I,G)});break;default:(F=fabric[o(h(D.type))])&&F.fromObject&&k(F.fromObject(D),G);break}else if(D.type===
"image")r.loadImageFromURL(H,function(I){I.setSourcePath(H);f(I,D);I.setAngle(D.angle);k(I,G)});else if(D.type==="text"){D.path=H;var L=fabric.Text.fromObject(D);fabric.util.getScript(H,function(){Object.prototype.toString.call(m.opera)==="[object Opera]"?setTimeout(function(){k(L,G)},500):k(L,G)})}else r.loadSVGFromURL(H,function(I){I=I.length>1?new fabric.PathGroup(I,D):I[0];I.setSourcePath(H);if(!(I instanceof fabric.PathGroup)){f(I,D);typeof D.angle!=="undefined"&&I.setAngle(D.angle)}k(I,G)})},
this)}catch(B){fabric.log(B.message)}},loadImageFromURL:function(){var b={};return function(d,k){function r(){var B=p.getElementById(b[d]);B.width&&B.height?k(new fabric.Image(B)):setTimeout(r,50)}var w=this;if(b[d])r();else{var z=new Image;z.onload=function(){z.onload=null;w._resizeImageToFit(z);var B=new fabric.Image(z);k(B)};z.className="canvas-img-clone";z.src=d;if(this.shouldCacheImages)b[d]=Element.identify(z);p.body.appendChild(z)}}}(),loadSVGFromURL:function(b,d){function k(z){if(z=z.responseXML)(z=
z.documentElement)&&fabric.parseSVGDocument(z,function(B,D){w.cache.set(b,{objects:B.invoke("toObject"),options:D});d(B,D)})}function r(){fabric.log("ERROR!")}var w=this;b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(b,function(z){if(z)w.cache.get(b,function(B){B=w._enlivenCachedObject(B);d(B.objects,B.options)});else new Ajax.Request(b,{method:"get",onComplete:k,onFailure:r})})},_enlivenCachedObject:function(b){var d=b.objects;b=b.options;d=d.map(function(k){return fabric[h(k.type)].fromObject(k)});
return{objects:d,options:b}},remove:function(b){c(this._objects,b);this.renderAll();return b},fxRemove:function(b,d){var k=this;b.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){k.remove(b);typeof d==="function"&&d()}});return this},sendToBack:function(b){c(this._objects,b);this._objects.unshift(b);return this.renderAll()},bringToFront:function(b){c(this._objects,b);this._objects.push(b);return this.renderAll()},sendBackwards:function(b){var d=this._objects.indexOf(b),k=d;if(d!==
0){for(d=d-1;d>=0;--d)if(b.intersectsWithObject(this._objects[d])){k=d;break}c(this._objects,b);this._objects.splice(k,0,b)}return this.renderAll()},bringForward:function(b){var d=this.getObjects(),k=d.indexOf(b),r=k;if(k!==d.length-1){k=k+1;for(var w=this._objects.length;k<w;++k)if(b.intersectsWithObject(d[k])){r=k;break}c(d,b);d.splice(r,0,b)}this.renderAll()},setActiveObject:function(b){this._activeObject&&this._activeObject.setActive(false);this._activeObject=b;b.setActive(true);this.renderAll();
l("object:selected",{target:b});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;return this},setActiveGroup:function(b){this._activeGroup=b;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var b=this.getActiveGroup();b&&b.destroy();return this.setActiveGroup(null)},item:function(b){return this.getObjects()[b]},deactivateAll:function(){for(var b=
this.getObjects(),d=0,k=b.length;d<k;d++)b[d].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(b,d){b+=d.complexity?d.complexity():0;return b},0)},dispose:function(){this.clear();n(this.getElement(),"mousedown",this._onMouseDown);n(p,"mouseup",this._onMouseUp);n(p,"mousemove",this._onMouseMove);n(m,"resize",this._onResize);return this},clone:function(b){var d=p.createElement("canvas");d.width=this.getWidth();
d.height=this.getHeight();var k=this.__clone||(this.__clone=new fabric.Element(d));return k.loadFromJSON(JSON.stringify(this.toJSON()),function(){b&&b(k)})},_toDataURL:function(b,d){this.clone(function(k){d(k.toDataURL(b))})},_toDataURLWithMultiplier:function(b,d,k){this.clone(function(r){k(r.toDataURLWithMultiplier(b,d))})},_resizeImageToFit:function(b){var d=b.width||b.offsetWidth,k=this.getWidth()/d;if(d)b.width=d*k},cache:{has:function(b,d){d(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=
function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};f(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(b){var d=b.getContext("2d");b=d.getImageData(0,0,b.width,b.height);var k=b.data,r=b.width,w=b.height,z,B;for(i=0;i<r;i++)for(j=0;j<w;j++){z=i*4*w+j*4;B=(k[z]+k[z+1]+k[z+2])/3;k[z]=B;k[z+1]=B;k[z+2]=B}d.putImageData(b,0,0)},supports:function(b){var d=p.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&
G_vmlCanvasManager.initElement(d);if(!d||!d.getContext)return null;var k=d.getContext("2d");if(!k)return null;switch(b){case "getImageData":return typeof k.getImageData!=="undefined";case "toDataURL":return typeof d.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject}})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.object.clone,h=m.util.toFixed,o=m.util.string.capitalize,l=m.util.getPointer,g=Array.prototype.slice;if(!m.Object){m.Object=m.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),
options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var c=this.constructor.superclass.prototype[a];return arguments.length>1?c.apply(this,g.call(arguments,1)):c.call(this)},
initialize:function(a){this.setOptions(a);this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(a){this.options=p(this._getOptions(),a)},_getOptions:function(){return p(f(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?
this.setAngle(this.options[a]):this[a]=this.options[a]},this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var a={type:this.type,left:h(this.left,this.NUM_FRACTION_DIGITS),top:h(this.top,this.NUM_FRACTION_DIGITS),width:h(this.width,this.NUM_FRACTION_DIGITS),height:h(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,
strokeWidth:this.strokeWidth,scaleX:h(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:h(this.scaleY,this.NUM_FRACTION_DIGITS),angle:h(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:h(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var c=m.Object.prototype.options;this.stateProperties.forEach(function(e){a[e]===c[e]&&delete a[e]});
return a},isActive:function(){return!!this.active},setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+o(this.type)+">"},set:function(a,c){if((a==="scaleX"||a==="scaleY")&&c<this.MIN_SCALE_LIMIT)c=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(c);else this[a]=c;return this},toggle:function(a){var c=this.get(a);typeof c==="boolean"&&this.set(a,!c);return this},setSourcePath:function(a){this.sourcePath=a;return this},get:function(a){return a==="angle"?this.getAngle():
this[a]},render:function(a,c){if(!(this.width===0||this.height===0)){a.save();var e=this.transformMatrix;e&&a.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]);c||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a,c);if(this.active&&!c){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*
this.scaleY},scale:function(a){this.scaleY=this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/
2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,c=Math.sin(this._angle+this.theta)*this._hypotenuse,e=this.theta,n=Math.sin(e);e=Math.cos(e);a={x:this.left-a,y:this.top-c};c={x:a.x+this.currentWidth*e,y:a.y+this.currentWidth*n};var q={x:a.x-this.currentHeight*n,y:a.y+this.currentHeight*e};this.oCoords={tl:a,tr:c,br:{x:c.x-this.currentHeight*n,y:c.y+this.currentHeight*e},bl:q,ml:{x:a.x-this.currentHeight/
2*n,y:a.y+this.currentHeight/2*e},mt:{x:a.x+this.currentWidth/2*e,y:a.y+this.currentWidth/2*n},mr:{x:c.x-this.currentHeight/2*n,y:c.y+this.currentHeight/2*e},mb:{x:q.x+this.currentWidth/2*e,y:q.y+this.currentWidth/2*n}};this._setCornerCoords();return this},drawBorders:function(a){var c=this.options,e=c.padding,n=e*2;a.save();a.globalAlpha=this.isMoving?c.borderOpacityWhenMoving:1;a.strokeStyle=c.borderColor;c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var q=1/(this.scaleY<
this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,q);c=this.getWidth();q=this.getHeight();a.strokeRect(~~(-(c/2)-e)+0.5,~~(-(q/2)-e)+0.5,~~(c+n),~~(q+n));a.restore();return this},drawCorners:function(a){var c=this.options.cornersize,e=c/2,n=this.options.padding,q=-(this.width/2),s=-(this.height/2),x=c/this.scaleX,y=c/this.scaleY,A=(n+e)/this.scaleY,u=(n+e)/this.scaleX,v=(n+e-c)/this.scaleX;n=(n+e-c)/this.scaleY;a.save();a.globalAlpha=this.isMoving?
this.options.borderOpacityWhenMoving:1;a.fillStyle=this.options.cornerColor;c=q-u;e=s-A;a.fillRect(c,e,x,y);c=q+this.width-u;e=s-A;a.fillRect(c,e,x,y);c=q-u;e=s+this.height+n;a.fillRect(c,e,x,y);c=q+this.width+v;e=s+this.height+n;a.fillRect(c,e,x,y);c=q+this.width/2-u;e=s-A;a.fillRect(c,e,x,y);c=q+this.width/2-u;e=s+this.height+n;a.fillRect(c,e,x,y);c=q+this.width+v;e=s+this.height/2-A;a.fillRect(c,e,x,y);c=q-u;e=s+this.height/2-A;a.fillRect(c,e,x,y);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),
a);return new m.Object(this.toObject())},cloneAsImage:function(a){if(m.Image){var c=new Image;c.onload=function(){a&&a(new m.Image(c),e);c=c.onload=null};var e={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);c.src=this.toDataURL()}return this},toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();m.util.wrapElement(a,"div");var c=new m.Element(a);c.backgroundColor=
"transparent";c.renderAll();var e=this.clone();e.left=a.width/2;e.top=a.height/2;e.setActive(false);c.add(e);a=c.toDataURL("png");c.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},intersectsWithRect:function(a,c){var e=this.oCoords,n=new m.Point(e.tl.x,e.tl.y),q=new m.Point(e.tr.x,e.tr.y),s=new m.Point(e.bl.x,
e.bl.y);e=new m.Point(e.br.x,e.br.y);return m.Intersection.intersectPolygonRectangle([n,q,e,s],a,c).status==="Intersection"},intersectsWithObject:function(a){function c(n){return{tl:new m.Point(n.tl.x,n.tl.y),tr:new m.Point(n.tr.x,n.tr.y),bl:new m.Point(n.bl.x,n.bl.y),br:new m.Point(n.br.x,n.br.y)}}var e=c(this.oCoords);a=c(a.oCoords);return m.Intersection.intersectPolygonPolygon([e.tl,e.tr,e.br,e.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,c){var e=this.oCoords,
n=new m.Point(e.tl.x,e.tl.y),q=new m.Point(e.tr.x,e.tr.y),s=new m.Point(e.bl.x,e.bl.y);new m.Point(e.br.x,e.br.y);return n.x>a.x&&q.x<c.x&&n.y>a.y&&s.y<c.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,c){var e=l(a),n=e.x-c.left;e=e.y-c.top;var q;for(var s in this.oCoords){q=this._getImageLines(this.oCoords[s].corner,s);q=this._findCrossPoints(n,e,q);if(q%2==1&&q!=0)return this.__corner=s}return false},_findCrossPoints:function(a,c,e){var n,q,s,x=0;for(var y in e){s=e[y];
if(!(s.o.y<c&&s.d.y<c))if(!(s.o.y>=c&&s.d.y>=c)){if(s.o.x==s.d.x&&s.o.x>=a)n=s.o.x;else{n=(s.d.y-s.o.y)/(s.d.x-s.o.x);q=c-0*a;s=s.o.y-n*s.o.x;n=-(q-s)/(0-n)}if(n>=a)x+=1;if(x==2)break}}return x},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,c=this.theta,e=this.cornersize*Math.cos(c),n=this.cornersize*Math.sin(c);c=this.cornersize/2;var q=c-n;a.tl.x-=q;a.tl.y-=
c;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+e,y:a.tl.y+n},bl:{x:a.tl.x-n,y:a.tl.y+e}};a.tl.corner.br={x:a.tl.corner.tr.x-n,y:a.tl.corner.tr.y+e};a.tl.x+=q;a.tl.y+=c;a.tr.x+=c;a.tr.y-=c;a.tr.corner={tl:{x:a.tr.x-e,y:a.tr.y-n},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-n,y:a.tr.y+e}};a.tr.corner.bl={x:a.tr.corner.tl.x-n,y:a.tr.corner.tl.y+e};a.tr.x-=c;a.tr.y+=c;a.bl.x-=c;a.bl.y+=c;a.bl.corner={tl:{x:a.bl.x+n,y:a.bl.y-e},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+e,y:a.bl.y+n}};a.bl.corner.tr={x:a.bl.corner.br.x+
n,y:a.bl.corner.br.y-e};a.bl.x+=c;a.bl.y-=c;a.br.x+=c;a.br.y+=c;a.br.corner={tr:{x:a.br.x+n,y:a.br.y-e},bl:{x:a.br.x-e,y:a.br.y-n},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+n,y:a.br.corner.bl.y-e};a.br.x-=c;a.br.y-=c;a.ml.x-=c;a.ml.y-=c;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+e,y:a.ml.y+n},bl:{x:a.ml.x-n,y:a.ml.y+e}};a.ml.corner.br={x:a.ml.corner.tr.x-n,y:a.ml.corner.tr.y+e};a.ml.x+=c;a.ml.y+=c;a.mt.x-=c;a.mt.y-=c;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+e,y:a.mt.y+
n},bl:{x:a.mt.x-n,y:a.mt.y+e}};a.mt.corner.br={x:a.mt.corner.tr.x-n,y:a.mt.corner.tr.y+e};a.mt.x+=c;a.mt.y+=c;a.mr.x-=c;a.mr.y-=c;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+e,y:a.mr.y+n},bl:{x:a.mr.x-n,y:a.mr.y+e}};a.mr.corner.br={x:a.mr.corner.tr.x-n,y:a.mr.corner.tr.y+e};a.mr.x+=c;a.mr.y+=c;a.mb.x-=c;a.mb.y-=c;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+e,y:a.mb.y+n},bl:{x:a.mb.x-n,y:a.mb.y+e}};a.mb.corner.br={x:a.mb.corner.tr.x-n,y:a.mb.corner.tr.y+e};a.mb.x+=c;a.mb.y+=c;a=a.mb.corner;
a.tl.x-=c;a.tl.y-=c;a.tr.x-=c;a.tr.y-=c;a.br.x-=c;a.br.y-=c;a.bl.x-=c;a.bl.y-=c},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new m.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var c=function(){},e=a.onComplete||c,n=a.onChange||
c,q=this;m.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){q.setAngle(s);n()},onComplete:function(){q.setCoords();e()},onStart:function(){q.setActive(false)}});return this},fxRemove:function(a){a||(a={});var c=function(){},e=a.onComplete||c,n=a.onChange||c,q=this;m.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(s){q.set("opacity",s);n()},onComplete:e,onStart:function(){q.setActive(false)}});
return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0},toJSON:function(){return this.toObject()}});m.Object.prototype.rotate=m.Object.prototype.setAngle}})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend;if(m.Line)m.warn("fabric.Line is already defined");else{m.Line=m.util.createClass(m.Object,{type:"line",initialize:function(f,h){f||(f=[0,0,0,0]);this.callSuper("initialize",h);this.set("x1",f[0]);this.set("y1",f[1]);this.set("x2",f[2]);this.set("y2",f[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(f){f.beginPath();
f.moveTo(-this.width/2,-this.height/2);f.lineTo(this.width/2,this.height/2);var h=f.strokeStyle;f.strokeStyle=f.fillStyle;f.stroke();f.strokeStyle=h},complexity:function(){return 1},toObject:function(){return p(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});m.Element.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");m.Line.fromElement=function(f,h){var o=m.parseAttributes(f,m.Element.ATTRIBUTE_NAMES);return new m.Line([o.x1||
0,o.y1||0,o.x2||0,o.y2||0],p(o,h))};m.Line.fromObject=function(f){return new m.Line([f.x1,f.y1,f.x2,f.y2],f)}}})();
(function(){var m=this.fabric||(this.fabric={}),p=Math.PI*2,f=m.util.object.extend;if(m.Circle)m.warn("fabric.Circle is already defined.");else{m.Circle=m.util.createClass(m.Object,{type:"circle",initialize:function(h){h=h||{};this.set("radius",h.radius||0);this.callSuper("initialize",h);h=this.get("radius")*2*this.get("scaleX");this.set("width",h).set("height",h)},toObject:function(){return f(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(h,o){h.beginPath();h.arc(o?this.left:
0,o?this.top:0,this.radius,0,p,false);h.closePath();this.fill&&h.fill();this.stroke&&h.stroke()},complexity:function(){return 1}});m.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");m.Circle.fromElement=function(h,o){o||(o={});var l=m.parseAttributes(h,m.Circle.ATTRIBUTE_NAMES);if(!("radius"in l&&l.radius>0))throw Error("value of `r` attribute is required and can not be negative");if("left"in l)l.left-=o.width/2||0;if("top"in l)l.top-=o.height/2||0;return new m.Circle(f(l,
o))};m.Circle.fromObject=function(h){return new m.Circle(h)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Triangle)m.warn("fabric.Triangle is already defined");else{m.Triangle=m.util.createClass(m.Object,{type:"triangle",initialize:function(p){p=p||{};this.callSuper("initialize",p);this.set("width",p.width||100).set("height",p.height||100)},_render:function(p){var f=this.width/2,h=this.height/2;p.beginPath();p.moveTo(-f,h);p.lineTo(0,-h);p.lineTo(f,h);p.closePath();this.fill&&p.fill();this.stroke&&p.stroke()},complexity:function(){return 1}});m.Triangle.fromObject=
function(p){return new m.Triangle(p)}}})();
(function(){var m=this.fabric||(this.fabric={}),p=Math.PI*2,f=m.util.object.extend;if(m.Ellipse)m.warn("fabric.Ellipse is already defined.");else{m.Ellipse=m.util.createClass(m.Object,{type:"ellipse",initialize:function(h){h=h||{};this.callSuper("initialize",h);this.set("rx",h.rx||0);this.set("ry",h.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return f(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(h,o){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",h,o)},_render:function(h,o){h.beginPath();h.save();h.transform(1,0,0,this.ry/this.rx,0,0);h.arc(o?this.left:0,o?this.top:0,this.rx,0,p,false);h.restore();this.stroke&&h.stroke();this.fill&&h.fill()},complexity:function(){return 1}});m.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");m.Ellipse.fromElement=function(h,o){o||(o={});var l=m.parseAttributes(h,m.Ellipse.ATTRIBUTE_NAMES);if("left"in l)l.left-=o.width/
2||0;if("top"in l)l.top-=o.height/2||0;return new m.Ellipse(f(l,o))};m.Ellipse.fromObject=function(h){return new m.Ellipse(h)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Rect)console.warn("fabric.Rect is already defined");else{m.Rect=m.util.createClass(m.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(p){this.callSuper("initialize",p);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(p){var f=this.options.rx||0,h=this.options.ry||0,o=-this.width/2,l=-this.height/
2,g=this.width,a=this.height;p.beginPath();p.moveTo(o+f,l);p.lineTo(o+g-f,l);p.bezierCurveTo(o+g,l,o+g,l+h,o+g,l+h);p.lineTo(o+g,l+a-h);p.bezierCurveTo(o+g,l+a,o+g-f,l+a,o+g-f,l+a);p.lineTo(o+f,l+a);p.bezierCurveTo(o,l+a,o,l+a-h,o,l+a-h);p.lineTo(o,l+h);p.bezierCurveTo(o,l,o+f,l,o+f,l);p.closePath();this.fill&&p.fill();this.stroke&&p.stroke()},_normalizeLeftTopProperties:function(p){p.left&&this.set("left",p.left+this.getWidth()/2);p.top&&this.set("top",p.top+this.getHeight()/2);return this},complexity:function(){return 1}});
m.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");m.Rect.fromElement=function(p,f){if(!p)return null;var h=m.parseAttributes(p,m.Rect.ATTRIBUTE_NAMES);h=h;h.left=h.left||0;h.top=h.top||0;h=h;var o=new m.Rect(m.util.object.extend(f||{},h));o._normalizeLeftTopProperties(h);return o};m.Rect.fromObject=function(p){return new m.Rect(p)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Polyline)m.warn("fabric.Polyline is already defined");else{m.Polyline=m.util.createClass(m.Object,{type:"polyline",initialize:function(f,h){h=h||{};this.set("points",f);this.callSuper("initialize",h);this._calcDimensions()},_calcDimensions:function(){return m.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return m.Polygon.prototype.toObject.call(this)},_render:function(f){var h;f.beginPath();for(var o=0,l=this.points.length;o<
l;o++){h=this.points[o];f.lineTo(h.x,h.y)}this.fill&&f.fill();this.stroke&&f.stroke()},complexity:function(){return this.get("points").length}});var p="fill fill-opacity stroke stroke-width transform".split(" ");m.Polyline.fromElement=function(f,h){if(!f)return null;h||(h={});for(var o=m.parsePointsAttribute(f.getAttribute("points")),l=m.parseAttributes(f,p),g=0,a=o.length;g<a;g++){o[g].x-=h.width/2||0;o[g].y-=h.height/2||0}return new m.Polyline(o,m.util.object.extend(l,h))};m.Polyline.fromObject=
function(f){return new m.Polyline(f.points,f)}}})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.array.min,h=m.util.array.max;if(m.Polygon)m.warn("fabric.Polygon is already defined");else{m.Polygon=m.util.createClass(m.Object,{type:"polygon",initialize:function(o,l){l=l||{};this.points=o;this.callSuper("initialize",l);this._calcDimensions()},_calcDimensions:function(){var o=this.points,l=f(o,"x"),g=f(o,"y"),a=h(o,"x");o=h(o,"y");this.width=a-l;this.height=o-g;this.minX=l;this.minY=g},toObject:function(){return p(this.callSuper("toObject"),
{points:this.points.concat()})},_render:function(o){var l;o.beginPath();for(var g=0,a=this.points.length;g<a;g++){l=this.points[g];o.lineTo(l.x,l.y)}this.fill&&o.fill();if(this.stroke){o.closePath();o.stroke()}},complexity:function(){return this.points.length}});m.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");m.Polygon.fromElement=function(o,l){if(!o)return null;l||(l={});for(var g=m.parsePointsAttribute(o.getAttribute("points")),a=m.parseAttributes(o,m.Polygon.ATTRIBUTE_NAMES),
c=0,e=g.length;c<e;c++){g[c].x-=l.width/2||0;g[c].y-=l.height/2||0}return new m.Polygon(g,p(a,l))};m.Polygon.fromObject=function(o){return new m.Polygon(o.points,o)}}})();
(function(){function m(a){if(a[0]==="H")return a[1];return a[a.length-2]}function p(a){if(a[0]==="V")return a[1];return a[a.length-1]}var f=this.fabric||(this.fabric={}),h=f.util.array.min,o=f.util.array.max,l=f.util.object.extend;if(f.Path)f.warn("fabric.Path is already defined");else if(f.Object){f.Path=f.util.createClass(f.Object,{type:"path",initialize:function(a,c){c=c||{};this.setOptions(c);this._importProperties();this.originalState={};if(!a)throw Error("`path` argument is required");var e=
Object.prototype.toString.call(a)==="[object Array]";if(this.path=e?a:a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g)){e||this._initializeFromArray(c);this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)}},_initializeFromArray:function(a){var c="width"in a;a="height"in a;this.path=this._parsePath();if(!c||!a){l(this,this._parseDimensions());if(c)this.width=this.options.width;if(a)this.height=this.options.height}},_render:function(a){for(var c,e=0,n=0,q=0,s=0,x,y,A=-(this.width/2),u=-(this.height/
2),v=0,E=this.path.length;v<E;++v){c=this.path[v];switch(c[0]){case "l":e+=c[1];n+=c[2];a.lineTo(e+A,n+u);break;case "L":e=c[1];n=c[2];a.lineTo(e+A,n+u);break;case "h":e+=c[1];a.lineTo(e+A,n+u);break;case "H":e=c[1];a.lineTo(e+A,n+u);break;case "v":n+=c[1];a.lineTo(e+A,n+u);break;case "V":n=c[1];a.lineTo(e+A,n+u);break;case "m":e+=c[1];n+=c[2];a.moveTo(e+A,n+u);break;case "M":e=c[1];n=c[2];a.moveTo(e+A,n+u);break;case "c":x=e+c[5];y=n+c[6];q=e+c[3];s=n+c[4];a.bezierCurveTo(e+c[1]+A,n+c[2]+u,q+A,s+
u,x+A,y+u);e=x;n=y;break;case "C":e=c[5];n=c[6];q=c[3];s=c[4];a.bezierCurveTo(c[1]+A,c[2]+u,q+A,s+u,e+A,n+u);break;case "s":x=e+c[3];y=n+c[4];q=2*e-q;s=2*n-s;a.bezierCurveTo(q+A,s+u,e+c[1]+A,n+c[2]+u,x+A,y+u);e=x;n=y;break;case "S":x=c[3];y=c[4];q=2*e-q;s=2*n-s;a.bezierCurveTo(q+A,s+u,c[1]+A,c[2]+u,x+A,y+u);e=x;n=y;break;case "q":e+=c[3];n+=c[4];a.quadraticCurveTo(c[1]+A,c[2]+u,e+A,n+u);break;case "Q":e=c[3];n=c[4];q=c[1];s=c[2];a.quadraticCurveTo(q+A,s+u,e+A,n+u);break;case "T":x=e;y=n;e=c[1];n=
c[2];q=-q+2*x;s=-s+2*y;a.quadraticCurveTo(q+A,s+u,e+A,n+u);break;case "a":break;case "A":break;case "z":case "Z":a.closePath();break}}},render:function(a,c){a.save();var e=this.transformMatrix;e&&a.transform(e[0],e[1],e[2],e[3],e[4],e[5]);c||this.transform(a);if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;if(this.stroke)a.strokeStyle=this.stroke;a.beginPath();this._render(a);this.fill&&a.fill();if(this.stroke){a.strokeStyle=this.stroke;a.lineWidth=this.strokeWidth;
a.lineCap=a.lineJoin="round";a.stroke()}if(!c&&this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var a=l(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)a.sourcePath=this.sourcePath;if(this.transformMatrix)a.transformMatrix=this.transformMatrix;return a},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.path=
this.sourcePath;delete a.sourcePath;return a},complexity:function(){return this.path.length},set:function(a,c){return this.callSuper("set",a,c)},_parsePath:function(){for(var a=[],c,e,n=0,q=this.path.length;n<q;n++){c=this.path[n];e=c.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);a.push([c.charAt(0)].concat(e.map(parseFloat)))}return a},_parseDimensions:function(){var a=[],c=[],e,n,q=false,s,x;this.path.forEach(function(v,E){if(v[0]!=="H")e=E===0?m(v):m(this.path[E-1]);if(v[0]!=="V")n=
E===0?p(v):p(this.path[E-1]);if(v[0]===v[0].toLowerCase())q=true;s=q?e+m(v):v[0]==="V"?e:m(v);x=q?n+p(v):v[0]==="H"?n:p(v);var C=parseInt(s,10);isNaN(C)||a.push(C);C=parseInt(x,10);isNaN(C)||c.push(C)},this);var y=h(a),A=h(c),u=deltaY=0;y={top:A-deltaY,left:y-u,bottom:o(c)-deltaY,right:o(a)-u};y.width=y.right-y.left;y.height=y.bottom-y.top;return y}});f.Path.fromObject=function(a){return new f.Path(a.path,a)};var g=f.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");
f.Path.fromElement=function(a,c){var e=f.parseAttributes(a,g),n=e.d;delete e.d;return new f.Path(n,l(e,c))}}else f.warn("fabric.Path requires fabric.Object")})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.array.invoke,h=m.Object.prototype.set,o=m.Object.prototype.toObject,l=m.util.string.camelize,g=m.util.string.capitalize;if(m.PathGroup)m.warn("fabric.PathGroup is already defined");else{m.PathGroup=m.util.createClass(m.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(a,c){c=c||{};this.originalState={};this.paths=a;this.setOptions(c);this.initProperties();this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},
initProperties:function(){this.stateProperties.forEach(function(a){if(a==="fill")this.set(a,this.options[a]);else if(a==="angle")this.setAngle(this.options[a]);else this[a]=this.options[a]},this)},render:function(a){if(this.stub){a.save();this.transform(a);this.stub.render(a,false);if(this.active){this.drawBorders(a);this.drawCorners(a)}}else{a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(a);c=0;for(var e=this.paths.length;c<e;++c)this.paths[c].render(a,
true);if(this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}}a.restore()},set:function(a,c){if((a==="fill"||a==="overlayFill")&&this.isSameColor()){this[a]=c;for(var e=this.paths.length;e--;)this.paths[e].set(a,c)}else h.call(this,a,c);return this},toObject:function(){return p(o.call(this),{paths:f(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.paths=this.sourcePath;return a},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(c){return c.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}});m.PathGroup.fromObject=function(a){for(var c=a.paths,
e=0,n=c.length;e<n;e++)if(!(c[e]instanceof m.Object)){var q=l(g(c[e].type));c[e]=m[q].fromObject(c[e])}return new m.PathGroup(c,a)}}})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.array.min,h=m.util.array.max,o=m.util.array.invoke,l=m.util.removeFromArray;if(!m.Group){m.Group=m.util.createClass(m.Object,{type:"group",initialize:function(g,a){this.objects=g||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&p(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var g=
this.left,a=this.top;this.forEachObject(function(c){var e=c.get("left"),n=c.get("top");c.set("originalLeft",e);c.set("originalTop",n);c.set("left",e-g);c.set("top",n-a);c.setCoords();c.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(g){this._restoreObjectsState();this.objects.push(g);g.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(g){this._restoreObjectsState();
l(this.objects,g);g.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(g,a){if(typeof a=="function")this.set(g,a(this[g]));else if(g==="fill"||g==="opacity"){var c=this.objects.length;for(this[g]=a;c--;)this.objects[c].set(g,a)}else this[g]=a;return this},contains:function(g){return this.objects.indexOf(g)>-1},toObject:function(){return p(this.callSuper("toObject"),{objects:o(this.objects,"clone")})},render:function(g){g.save();
this.transform(g);for(var a=Math.max(this.scaleX,this.scaleY),c=0,e;e=this.objects[c];c++){var n=e.borderScaleFactor;e.borderScaleFactor=a;e.render(g);e.borderScaleFactor=n}this.hideBorders||this.drawBorders(g);this.hideCorners||this.drawCorners(g);g.restore();this.setCoords()},item:function(g){return this.getObjects()[g]},complexity:function(){return this.getObjects().reduce(function(g,a){g+=typeof a.complexity=="function"?a.complexity():0;return g},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(g){var a=this.get("left"),c=this.get("top"),e=this.getAngle()*(Math.PI/180);g.get("originalLeft");g.get("originalTop");var n=Math.cos(e)*g.get("top")+Math.sin(e)*g.get("left");e=-Math.sin(e)*g.get("top")+Math.cos(e)*g.get("left");g.setAngle(g.getAngle()+this.getAngle());g.set("left",a+e*this.get("scaleX"));g.set("top",c+n*this.get("scaleY"));g.set("scaleX",g.get("scaleX")*this.get("scaleX"));g.set("scaleY",g.get("scaleY")*this.get("scaleY"));g.setCoords();
g.hideCorners=false;g.setActive(false);g.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(g){g.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(g){this.forEachObject(function(a){a.setActive(g)});
return this},forEachObject:function(g,a){for(var c=this.getObjects(),e=c.length;e--;)g.call(a,c[e],e,c);return this},_setOpacityIfSame:function(){var g=this.getObjects(),a=g[0]?g[0].get("opacity"):1;if(g.every(function(c){return c.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var g=[],a=[],c,e;e=0;for(var n=this.objects.length;e<n;++e){c=this.objects[e];c.setCoords();for(var q in c.oCoords){g.push(c.oCoords[q].x);a.push(c.oCoords[q].y)}}c=f(g);e=h(g);g=f(a);a=h(a);e=e-c;a=a-g;this.width=
e;this.height=a;this.left=c+e/2;this.top=g+a/2},containsPoint:function(g){var a=this.get("width")/2,c=this.get("height")/2,e=this.get("left"),n=this.get("top");return e-a<g.x&&e+a>g.x&&n-c<g.y&&n+c>g.y},toGrayscale:function(){for(var g=this.objects.length;g--;)this.objects[g].toGrayscale()}});m.Group.fromObject=function(g){return new m.Group(g.objects,g)}}})();
(function(){var m=this.fabric||(this.fabric={}),p=m.util.object.extend,f=m.util.object.clone;if(m.Text)m.warn("fabric.Text is already defined");else if(m.Object){m.Text=m.util.createClass(m.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(h,o){this.originalState={};this.initStateProperties();this.text=h;this.setOptions(o);p(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},
initStateProperties:function(){var h;if((h=this.constructor)&&(h=h.superclass)&&(h=h.prototype)&&(h=h.stateProperties)&&h.clone){this.stateProperties=h.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(h){var o=Cufon.textOptions||(Cufon.textOptions={});o.left=this.left;o.top=this.top;o.context=h;o.color=this.fill;var l=this._initDummyElement();
this.transform(h);Cufon.replaceElement(l,{separate:"none",fontFamily:this.fontfamily});this.width=o.width;this.height=o.height},_initDummyElement:function(){var h=document.createElement("div");h.innerHTML=this.text;h.style.fontSize="40px";h.style.fontWeight="400";h.style.fontStyle="normal";h.style.letterSpacing="normal";h.style.color="#000000";h.style.fontWeight="600";h.style.fontFamily="Verdana";return h},render:function(h){h.save();this._render(h);if(this.active){this.drawBorders(h);this.drawCorners(h)}h.restore()},
toObject:function(){return p(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(h){this.set("fill",h);return this},setFontsize:function(h){this.set("fontsize",h);this.setCoords();return this},getText:function(){return this.text},setText:function(h){this.set("text",h);this.setCoords();return this},set:function(h,o){this[h]=o;if(h==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+o+"$3");return this}});m.Text.fromObject=function(h){return new m.Text(h.text,f(h))};m.Text.fromElement=function(){}}else m.warn("fabric.Text requires fabric.Object")})();
(function(){var m=fabric.util.object.extend;if(!this.fabric)this.fabric={};if(this.fabric.Image)fabric.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(p,f){this.callSuper("initialize",f);this._initElement(p);this._initConfig(f||{})},getElement:function(){return this._element},setElement:function(p){this._element=
p;return this},getNormalizedSize:function(p,f,h){if(h&&f&&p.width>p.height&&p.width/p.height<f/h){normalizedWidth=~~(p.width*h/p.height);normalizedHeight=h}else if(h&&(p.height==p.width||p.height>p.width||p.height>h)){normalizedWidth=~~(p.width*h/p.height);normalizedHeight=h}else if(f&&f<p.width){normalizedHeight=~~(p.height*f/p.width);normalizedWidth=f}else{normalizedWidth=p.width;normalizedHeight=p.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var p=this.getElement();
return{width:p.width,height:p.height}},setBorderVisibility:function(){this._resetWidthHeight();this._adjustWidthHeightToBorders(showBorder);this.setCoords()},setCornersVisibility:function(p){this.cornervisibility=!!p},render:function(p,f){p.save();f||this.transform(p);this._render(p);if(this.active&&!f){this.drawBorders(p);this.hideCorners||this.drawCorners(p)}p.restore()},toObject:function(){return m(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},
toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(p){this.constructor.fromObject(this.toObject(),p)},toGrayscale:function(p){if(!this.__isGrayscaled){var f=this.getElement(),h=document.createElement("canvas"),o=document.createElement("img"),l=this;h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,0,0);fabric.Element.toGrayscale(h);o.onload=function(){l.setElement(o);p&&p();o.onload=h=f=imageData=null};o.width=f.width;o.height=f.height;o.src=h.toDataURL("image/png");
this.__isGrayscaled=true;return this}},_render:function(p){var f=this.getOriginalSize();p.drawImage(this.getElement(),-f.width/2,-f.height/2,f.width,f.height)},_adjustWidthHeightToBorders:function(p){if(p){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var p=this.getElement();this.set("width",p.width);this.set("height",p.height)},_initElement:function(p){this.setElement(fabric.util.getById(p));
fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(p){this.setOptions(p);this._setBorder();this._setWidthHeight(p)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var p=2*this.currentBorder;this.width=(this.getElement().width||0)+p;this.height=(this.getElement().height||0)+p},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(p,f){var h=document.createElement("img"),
o=p.src;if(p.width)h.width=p.width;if(p.height)h.height=p.height;h.onload=function(){f&&f(new fabric.Image(h,p));h=h.onload=null};h.src=o};fabric.Image.fromURL=function(p,f,h){var o=document.createElement("img");o.onload=function(){f&&f(new fabric.Image(o,h));o=o.onload=null};o.src=p}}else fabric.warn("fabric.Object is required for fabric.Image initialization")})();
