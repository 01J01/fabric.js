var fabric=fabric||{version:0.1};fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply)fabric.log=function(){return console.log.apply(console,arguments)};if(typeof console.warn!=="undefined"&&console.warn.apply)fabric.warn=function(){return console.warn.apply(console,arguments)}}if(!this.JSON)this.JSON={};
(function(){function z(b){return b<10?"0"+b:b}function l(b){m.lastIndex=0;return m.test(b)?'"'+b.replace(m,function(g){var o=e[g];return typeof o==="string"?o:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function f(b,g){var o,q,t,A,w=p,B,v=g[b];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(b);if(typeof a==="function")v=a.call(g,b,v);switch(typeof v){case "string":return l(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";p+=h;B=[];if(Object.prototype.toString.apply(v)==="[object Array]"){A=v.length;for(o=0;o<A;o+=1)B[o]=f(o,v)||"null";t=B.length===0?"[]":p?"[\n"+p+B.join(",\n"+p)+"\n"+w+"]":"["+B.join(",")+"]";p=w;return t}if(a&&typeof a==="object"){A=a.length;for(o=0;o<A;o+=1){q=a[o];if(typeof q==="string")if(t=f(q,v))B.push(l(q)+(p?": ":":")+t)}}else for(q in v)if(Object.hasOwnProperty.call(v,q))if(t=f(q,v))B.push(l(q)+(p?": ":":")+t);t=B.length===0?"{}":p?"{\n"+p+B.join(",\n"+p)+
"\n"+w+"}":"{"+B.join(",")+"}";p=w;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+z(this.getUTCMonth()+1)+"-"+z(this.getUTCDate())+"T"+z(this.getUTCHours())+":"+z(this.getUTCMinutes())+":"+z(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var k=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
m=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p,h,e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a;if(typeof JSON.stringify!=="function")JSON.stringify=function(b,g,o){var q;h=p="";if(typeof o==="number")for(q=0;q<o;q+=1)h+=" ";else if(typeof o==="string")h=o;if((a=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return f("",
{"":b})};if(typeof JSON.parse!=="function")JSON.parse=function(b,g){function o(t,A){var w,B,v=t[A];if(v&&typeof v==="object")for(w in v)if(Object.hasOwnProperty.call(v,w)){B=o(v,w);if(B!==undefined)v[w]=B;else delete v[w]}return g.call(t,A,v)}var q;b=String(b);k.lastIndex=0;if(k.test(b))b=b.replace(k,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){q=eval("("+b+")");return typeof g==="function"?o({"":q},""):q}throw new SyntaxError("JSON.parse");}})();(function(){var z=document.defaultView;if(z&&z.getComputedStyle)if(z.getComputedStyle(document.documentElement,"")===null)z.getComputedStyle=function(l){return l.style}})();
var Cufon=function(){function z(r){var s=this.face=r.face;this.glyphs=r.glyphs;this.w=r.w;this.baseSize=parseInt(s["units-per-em"],10);this.family=s["font-family"].toLowerCase();this.weight=s["font-weight"];this.style=s["font-style"]||"normal";this.viewBox=function(){var c=s.bbox.split(/\s+/);c={minX:parseInt(c[0],10),minY:parseInt(c[1],10),maxX:parseInt(c[2],10),maxY:parseInt(c[3],10)};c.width=c.maxX-c.minX;c.height=c.maxY-c.minY;c.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return c}();this.ascent=-parseInt(s.ascent,10);this.descent=-parseInt(s.descent,10);this.height=-this.ascent+this.descent}function l(){var r={},s={oblique:"italic",italic:"oblique"};this.add=function(c){(r[c.style]||(r[c.style]={}))[c.weight]=c};this.get=function(c,d){var n=r[c]||r[s[c]]||r.normal||r.italic||r.oblique;if(!n)return null;d={normal:400,bold:700}[d]||parseInt(d,10);if(n[d])return n[d];var u={1:1,99:0}[d%100],x=[],y,D;if(u===undefined)u=d>400;if(d==500)d=400;for(var E in n){E=parseInt(E,
10);if(!y||E<y)y=E;if(!D||E>D)D=E;x.push(E)}if(d<y)d=y;if(d>D)d=D;x.sort(function(G,H){return(u?G>d&&H>d?G<H:G>H:G<d&&H<d?G>H:G<H)?-1:1});return n[x[0]]}}function f(r){var s={},c={};this.get=function(d){return s[d]!=undefined?s[d]:r[d]};this.getSize=function(d,n){return c[d]||(c[d]=new o.Size(this.get(d),n))};this.extend=function(d){for(var n in d)s[n]=d[n];return this}}function k(r,s,c){if(r.addEventListener)r.addEventListener(s,c,false);else r.attachEvent&&r.attachEvent("on"+s,function(){return c.call(r,
window.event)})}function m(r){var s={};return function(c){s.hasOwnProperty(c)||(s[c]=r.apply(null,arguments));return s[c]}}function p(r){return document.getElementsByTagName(r)}function h(){for(var r={},s,c=0,d=arguments.length;c<d;++c)for(s in arguments[c])r[s]=arguments[c][s];return r}function e(r,s,c,d,n,u){var x=d.separate;if(x=="none")return B[d.engine].apply(null,arguments);var y=document.createDocumentFragment(),D=s.split(F[x]),E=x=="words";if(E&&q){/^\s/.test(s)&&D.unshift("");/\s$/.test(s)&&
D.push("")}for(var G=0,H=D.length;G<H;++G)(x=B[d.engine](r,E?o.textAlign(D[G],c,G,H):D[G],c,d,n,u,G<H-1))&&y.appendChild(x);return y}function a(r,s){var c,d,n,u;n=t.get(r);if(!n.options){s.hover&&s.hoverables[r.nodeName.toLowerCase()]&&A.attach(r);n.options=s}for(var x=r.firstChild;x;x=n){n=x.nextSibling;u=false;if(x.nodeType==1){if(!x.firstChild)continue;if(/cufon/.test(x.className))u=true;else{arguments.callee(x,s);continue}}d||(d=o.getStyle(r).extend(s));if(!c)a:{(c=d)||(c=o.getStyle(r));for(var y=
o.quotedList(c.get("fontFamily").toLowerCase()),D=void 0,E=0,G=y.length;E<G;++E){D=y[E];if(v[D]){c=v[D].get(c.get("fontStyle"),c.get("fontWeight"));break a}}c=null}if(c)if(u)B[s.engine](c,null,d,s,x,r);else{u=x.data;if(u!=="")(u=e(c,u,d,s,x,r))?x.parentNode.replaceChild(u,x):x.parentNode.removeChild(x)}}}var b=function(){return b.replace.apply(null,arguments)},g=b.DOM={ready:function(){var r=false,s={loaded:1,complete:1},c=[],d=function(){if(!r){r=true;for(var n;n=c.shift();n());}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",
d,false);window.addEventListener("pageshow",d,false)}!window.opera&&document.readyState&&function(){s[document.readyState]?d():setTimeout(arguments.callee,10)}();document.readyState&&document.createStyleSheet&&function(){try{document.body.doScroll("left");d()}catch(n){setTimeout(arguments.callee,1)}}();k(window,"load",d);return function(n){if(arguments.length)r?n():c.push(n);else d()}}()},o=b.CSS={Size:function(r,s){this.value=parseFloat(r);this.unit=String(r).match(/[a-z%]*$/)[0]||"px";this.convert=
function(c){return c/s*this.value};this.convertFrom=function(c){return c/this.value*s};this.toString=function(){return this.value+this.unit}},getStyle:function(r){return new f(r.style)},quotedList:m(function(r){for(var s=[],c=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,d;d=c.exec(r);)s.push(d[3]||d[1]);return s}),ready:function(){var r=false,s=[],c=Object.prototype.propertyIsEnumerable?p("style"):{length:0},d=p("link");g.ready(function(){for(var n=0,u,x=0,y=d.length;u=d[x],x<y;++x)!u.disabled&&u.rel.toLowerCase()==
"stylesheet"&&++n;if(document.styleSheets.length>=c.length+n)for(r=true;n=s.shift();n());else setTimeout(arguments.callee,10)});return function(n){r?n():s.push(n)}}(),supports:function(r,s){var c=document.createElement("span").style;if(c[r]===undefined)return false;c[r]=s;return c[r]===s},textAlign:function(r,s,c,d){if(s.get("textAlign")=="right"){if(c>0)r=" "+r}else if(c<d-1)r+=" ";return r},textDecoration:function(r,s){s||(s=this.getStyle(r));for(var c={underline:null,overline:null,"line-through":null},
d=r;d.parentNode&&d.parentNode.nodeType==1;){var n=true;for(var u in c)if(!c[u]){if(s.get("textDecoration").indexOf(u)!=-1)c[u]=s.get("color");n=false}if(n)break;s=this.getStyle(d=d.parentNode)}return c},textShadow:m(function(r){if(r=="none")return null;for(var s=[],c={},d,n=0,u=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;d=u.exec(r);)if(d[0]==","){s.push(c);c={};n=0}else if(d[1])c.color=d[1];else c[["offX","offY","blur"][n++]]=d[2];s.push(c);return s}),color:m(function(r){var s={};
s.color=r.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(c,d,n){s.opacity=parseFloat(n);return"rgb("+d+")"});return s}),textTransform:function(r,s){return r[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[s.get("textTransform")]||"toString"]()}},q=" ".split(/\s+/).length==0,t=new function(){var r={},s=0;this.get=function(c){c=c.cufid||(c.cufid=++s);return r[c]||(r[c]={})}},A=new (function(){function r(d){d=d.relatedTarget;var n;if(!(n=!d))n=this.contains?this.contains(d):this.compareDocumentPosition(d)&
16;n||c(this)}function s(){c(this)}function c(d){setTimeout(function(){b.replace(d,t.get(d).options,true)},10)}this.attach=function(d){if(d.onmouseenter===undefined){k(d,"mouseover",r);k(d,"mouseout",r)}else{k(d,"mouseenter",s);k(d,"mouseleave",s)}}}),w=[],B={},v={},C={enableTextDecoration:false,engine:null,hover:false,hoverables:{a:true},printable:true,selector:window.Sizzle||window.jQuery&&function(r){return jQuery(r)}||window.dojo&&dojo.query||window.$$&&function(r){return $$(r)}||window.$&&function(r){return $(r)}||
document.querySelectorAll&&function(r){return document.querySelectorAll(r)}||p,separate:"words",textShadow:"none"},F={words:/\s+/,characters:""};b.now=function(){g.ready();return b};b.refresh=function(){for(var r=w.splice(0,w.length),s=0,c=r.length;s<c;++s)b.replace.apply(null,r[s]);return b};b.registerEngine=function(r,s){if(!s)return b;B[r]=s;return b.set("engine",r)};b.registerFont=function(r){r=new z(r);var s=r.family;v[s]||(v[s]=new l);v[s].add(r);return b.set("fontFamily",'"'+s+'"')};b.replace=
function(r,s,c){s=h(C,s);if(!s.engine)return b;if(typeof s.textShadow=="string")s.textShadow=o.textShadow(s.textShadow);c||w.push(arguments);if(r.nodeType||typeof r=="string")r=[r];o.ready(function(){for(var d=0,n=r.length;d<n;++d){var u=r[d];typeof u=="string"?b.replace(s.selector(u),s,true):a(u,s)}});return b};b.replaceElement=function(r,s){s=h(C,s);if(typeof s.textShadow=="string")s.textShadow=o.textShadow(s.textShadow);return a(r,s)};b.engines=B;b.fonts=v;b.getOptions=function(){return h(C)};
b.set=function(r,s){C[r]=s;return b};return b}();
Cufon.registerEngine("canvas",function(){var z=document.createElement("canvas");if(!(!z||!z.getContext||!z.getContext.apply)){z=null;var l=Cufon.CSS.supports("display","inline-block");z=!l&&(document.compatMode=="BackCompat"||/frameset|transitional/i.test(document.doctype.publicId));var f=document.createElement("style");f.type="text/css";f.appendChild(document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(z?
"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(l?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}"));document.getElementsByTagName("head")[0].appendChild(f);return function(k,m,p,h,e,a){function b(D,E){y.strokeStyle=E;y.beginPath();y.moveTo(0,
D);y.lineTo(x,D);y.stroke()}function g(){for(var D=0,E=u.length;D<E;++D){var G=k.glyphs[u[D]]||k.missingGlyph;if(G){y.beginPath();if(G.d)if(G.code)for(var H=G.code,J=y,L=0,I=H.length;L<I;++L){var M=H[L];J[M.m].apply(J,M.a)}else{H=G;J="m"+G.d;L=y;M=I=0;var N=[],Q=/([mrvxe])([^a-z]*)/g,P=void 0,O=0;a:for(;P=Q.exec(J);++O){var K=P[2].split(",");switch(P[1]){case "v":N[O]={m:"bezierCurveTo",a:[I+~~K[0],M+~~K[1],I+~~K[2],M+~~K[3],I+=~~K[4],M+=~~K[5]]};break;case "r":N[O]={m:"lineTo",a:[I+=~~K[0],M+=~~K[1]]};
break;case "m":N[O]={m:"moveTo",a:[I=~~K[0],M=~~K[1]]};break;case "x":N[O]={m:"closePath"};break;case "e":break a}L[N[O].m].apply(L,N[O].a)}H.code=N}y.fill();y.translate(Number(G.w||k.w)+A,0)}}}var o=m===null,q=k.viewBox,t=p.getSize("fontSize",k.baseSize),A=p.get("letterSpacing");A=A=="normal"?0:t.convertFrom(parseInt(A,10));var w=0,B=0,v=0,C=0,F=h.textShadow,r=[];if(F)for(var s=0,c=F.length;s<c;++s){var d=F[s],n=t.convertFrom(parseFloat(d.offX));d=t.convertFrom(parseFloat(d.offY));r[s]=[n,d];if(d<
w)w=d;if(n>B)B=n;if(d>v)v=d;if(n<C)C=n}var u=Cufon.CSS.textTransform(o?e.alt:m,p).split(""),x=0;d=null;s=0;for(c=u.length;s<c;++s)if(n=k.glyphs[u[s]]||k.missingGlyph)x+=d=Number(n.w||k.w)+A;if(d===null)return null;B+=q.width-d;C+=q.minX;if(o){o=e;s=e.firstChild}else{o=document.createElement("span");o.className="cufon cufon-canvas";o.alt=m;s=document.createElement("canvas");o.appendChild(s);if(h.printable){c=document.createElement("span");c.className="cufon-alt";c.appendChild(document.createTextNode(m));
o.appendChild(c)}}m=o.style;c=s.style;e=t.convert(q.height-w+v);v=Math.ceil(e);e=v/e;s.width=Math.ceil(t.convert(x+B-C)*e);s.height=v;w+=q.minY;c.top=Math.round(t.convert(w-k.ascent))+"px";c.left=Math.round(t.convert(C))+"px";B=Math.ceil(t.convert(x*e));c=B+"px";t=t.convert(k.height);Cufon.textOptions.width=B;Cufon.textOptions.height=t;if(l){m.width=c;m.height=t+"px"}else{m.paddingLeft=c;m.paddingBottom=t-1+"px"}var y=Cufon.textOptions.context||s.getContext("2d");q=v/q.height;y.save();y.scale(q,q);
y.translate(-C-1/q*s.width/2+(Cufon.fonts[k.family].offsetLeft||0),-w-1/q*s.height/2);y.lineWidth=k.face["underline-thickness"];y.save();h=h.enableTextDecoration?Cufon.CSS.textDecoration(a,p):{};h.underline&&b(-k.face["underline-position"],h.underline);h.overline&&b(k.ascent,h.overline);y.fillStyle=Cufon.textOptions.color||p.get("color");if(F){s=0;for(c=F.length;s<c;++s){d=F[s];y.save();y.fillStyle=d.color;y.translate.apply(y,r[s]);g();y.restore()}}g();y.restore();y.restore();h["line-through"]&&b(-k.descent,
h["line-through"]);return o}}}());
Cufon.registerEngine("vml",function(){function z(f,k){if(/px$/i.test(k))return parseFloat(k);var m=f.style.left,p=f.runtimeStyle.left;f.runtimeStyle.left=f.currentStyle.left;f.style.left=k;var h=f.style.pixelLeft;f.style.left=m;f.runtimeStyle.left=p;return h}if(document.namespaces){document.namespaces.cvml==null&&document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var l=document.createElement("cvml:shape");l.style.behavior="url(#default#VML)";if(l.coordsize){l=null;document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');
return function(f,k,m,p,h,e,a){var b=k===null;if(b)k=h.alt;var g=f.viewBox,o;if(!(o=m.computedFontSize)){o=Cufon.CSS.Size;var q;q=m.get("fontSize");q=z(e,/(?:em|ex|%)$/i.test(q)?"1em":q);o=m.computedFontSize=new o(q+"px",f.baseSize)}o=o;q=m.computedLSpacing;if(q==undefined){q=m.get("letterSpacing");m.computedLSpacing=q=q=="normal"?0:~~o.convertFrom(z(e,q))}var t;if(b){t=h;h=h.firstChild}else{t=document.createElement("span");t.className="cufon cufon-vml";t.alt=k;h=document.createElement("span");h.className=
"cufon-vml-canvas";t.appendChild(h);if(p.printable){var A=document.createElement("span");A.className="cufon-alt";A.appendChild(document.createTextNode(k));t.appendChild(A)}a||t.appendChild(document.createElement("cvml:shape"))}a=t.style;var w=h.style,B=o.convert(g.height);A=Math.ceil(B);B=A/B;var v=g.minX,C=g.minY;w.height=A;w.top=Math.round(o.convert(C-f.ascent));w.left=Math.round(o.convert(v));a.height=o.convert(f.height)+"px";p.enableTextDecoration&&Cufon.CSS.textDecoration(e,m);e=m.get("color");
k=Cufon.CSS.textTransform(k,m).split("");w=m=0;var F=null,r;p=p.textShadow;for(var s=0,c=0,d=k.length;s<d;++s)if(r=f.glyphs[k[s]]||f.missingGlyph)m+=F=~~(r.w||f.w)+q;if(F===null)return null;r=-v+m+(g.width-F);s=o.convert(r*B);F=Math.round(s);var n=r+","+g.height,u,x="r"+n+"nsnf";for(s=0;s<d;++s)if(r=f.glyphs[k[s]]||f.missingGlyph){if(b){g=h.childNodes[c];g.firstChild&&g.removeChild(g.firstChild)}else{g=document.createElement("cvml:shape");h.appendChild(g)}g.stroked="f";g.coordsize=n;g.coordorigin=
u=v-w+","+C;g.path=(r.d?"m"+r.d+"xe":"")+"m"+u+x;g.fillcolor=e;u=g.style;u.width=F;u.height=A;if(p){u=p[0];var y=p[1],D=Cufon.CSS.color(u.color),E,G=document.createElement("cvml:shadow");G.on="t";G.color=D.color;G.offset=u.offX+","+u.offY;if(y){E=Cufon.CSS.color(y.color);G.type="double";G.color2=E.color;G.offset2=y.offX+","+y.offY}G.opacity=D.opacity||E&&E.opacity||1;g.appendChild(G)}w+=~~(r.w||f.w)+q;++c}a.width=Math.max(Math.ceil(o.convert(m*B)),0);return t}}}}());
(function(z){function l(h,e){for(var a in e)h[a]=e[a];return h}function f(h,e){var a=document.createElement(h);for(var b in e)if(b==="class")a.className=e[b];else if(b==="for")a.htmlFor=e[b];else a.setAttribute(b,e[b]);return a}var k=z.fabric||(z.fabric={}),m=Array.prototype.slice,p=Function.prototype.apply;k.util={};(function(){var h=Math.PI/180;k.util.removeFromArray=function(e,a){var b=e.indexOf(a);b!==-1&&e.splice(b,1);return e};k.util.degreesToRadians=function(e){return e*h};k.util.toFixed=function(e,
a){return parseFloat(Number(e).toFixed(a))};k.util.getRandomInt=function(e,a){return Math.floor(Math.random()*(a-e+1))+e};k.util.falseFunction=function(){return false}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(h,e){var a=this.length>>>0;e=Number(e)||0;e=Math[e<0?"ceil":"floor"](e);if(e<0)e+=a;for(;e<a;e++)if(e in this&&this[e]===h)return e;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(h,e){for(var a=0,b=this.length>>>0;a<b;a++)a in this&&h.call(e,this[a],
a,this)};if(!Array.prototype.map)Array.prototype.map=function(h,e){for(var a=[],b=0,g=this.length>>>0;b<g;b++)if(b in this)a[b]=h.call(e,this[b],b,this);return a};if(!Array.prototype.every)Array.prototype.every=function(h,e){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&!h.call(e,this[a],a,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(h,e){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&h.call(e,this[a],a,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=
function(h,e){for(var a=[],b,g=0,o=this.length>>>0;g<o;g++)if(g in this){b=this[g];h.call(e,b,g,this)&&a.push(b)}return a};if(!Array.prototype.reduce)Array.prototype.reduce=function(h){var e=this.length>>>0,a=0,b;if(arguments.length>1)b=arguments[1];else{do{if(a in this){b=this[a++];break}if(++a>=e)throw new TypeError;}while(1)}for(;a<e;a++)if(a in this)b=h.call(null,b,this[a],a,this);return b};k.util.array={invoke:function(h,e){for(var a=m.call(arguments,2),b=[],g=0,o=h.length;g<o;g++)b[g]=a.length?
h[g][e].apply(h[g],a):h[g][e].call(h[g]);return b},min:function(h,e){var a=h.length-1,b=e?h[a][e]:h[a];if(e)for(;a--;){if(h[a][e]<b)b=h[a][e]}else for(;a--;)if(h[a]<b)b=h[a];return b},max:function(h,e){var a=h.length-1,b=e?h[a][e]:h[a];if(e)for(;a--;){if(h[a][e]>=b)b=h[a][e]}else for(;a--;)if(h[a]>=b)b=h[a];return b}};k.util.object={extend:l,clone:function(h){return l({},h)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};
k.util.string={camelize:function(h){return h.replace(/-+(.)?/g,function(e,a){return a?a.toUpperCase():""})},capitalize:function(h){return h.charAt(0).toUpperCase()+h.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(h){var e=this,a=m.call(arguments,1);return a.length?function(){return p.call(e,h,a.concat(m.call(arguments)))}:function(){return p.call(e,h,arguments)}};(function(){function h(){}var e;e=function(){for(var a in{toString:1})if(a==="toString")return false;
return true}()?function(a,b){if(b.toString!==Object.prototype.toString)a.prototype.toString=b.toString;if(b.valueOf!==Object.prototype.valueOf)a.prototype.valueOf=b.valueOf;for(var g in b)a.prototype[g]=b[g]}:function(a,b){for(var g in b)a.prototype[g]=b[g]};k.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var b=null,g=m.call(arguments,0);if(typeof g[0]==="function")b=g.shift();a.superclass=b;a.subclasses=[];if(b){h.prototype=b.prototype;a.prototype=new h;b.subclasses.push(a)}b=
0;for(var o=g.length;b<o;b++)e(a,g[b]);if(!a.prototype.initialize)a.prototype.initialize=emptyFunction;return a.prototype.constructor=a}})();(function(){function h(v){var C=Array.prototype.slice.call(arguments,1),F,r,s=C.length;for(r=0;r<s;r++){F=typeof v[C[r]];if(!/^(?:function|object|unknown)$/.test(F))return false}return true}function e(v,C){return function(F){C.call(g(v),F||window.event)}}function a(v,C){return function(F){if(w[v]&&w[v][C])for(var r=w[v][C],s=0,c=r.length;s<c;s++)r[s].call(this,
F||window.event)}}var b=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(C){return C.uniqueID};var v=0;return function(C){return C.__uniqueID||(C.__uniqueID="uniqueID__"+v++)}}(),g,o;(function(){var v={};g=function(C){return v[C]};o=function(C,F){v[C]=F}})();var q=h(document.documentElement,"addEventListener","removeEventListener")&&h(window,"addEventListener","removeEventListener"),t=h(document.documentElement,"attachEvent","detachEvent")&&h(window,"attachEvent",
"detachEvent"),A={},w={};if(q){q=function(v,C,F){v.addEventListener(C,F,false)};t=function(v,C,F){v.removeEventListener(C,F,false)}}else if(t){q=function(v,C,F){var r=b(v);o(r,v);A[r]||(A[r]={});A[r][C]||(A[r][C]=[]);F={handler:F,wrappedHandler:e(r,F)};A[r][C].push(F);v.attachEvent("on"+C,F.wrappedHandler)};t=function(v,C,F){var r=b(v),s;if(A[r]&&A[r][C])for(var c=0,d=A[r][C].length;c<d;c++)if((s=A[r][C][c])&&s.handler===F){v.detachEvent("on"+C,s.wrappedHandler);A[r][C][c]=null}}}else{q=function(v,
C,F){var r=b(v);w[r]||(w[r]={});if(!w[r][C]){w[r][C]=[];var s=v["on"+C];s&&w[r][C].push(s);v["on"+C]=a(r,C)}w[r][C].push(F)};t=function(v,C,F){v=b(v);if(w[v]&&w[v][C]){C=w[v][C];v=0;for(var r=C.length;v<r;v++)C[v]===F&&C.splice(v,1)}}}k.util.addListener=q;k.util.removeListener=t;var B={};k.util.getPointer=function(v){var C=document.documentElement,F=document.body||{scrollLeft:0},r=document.documentElement,s=document.body||{scrollTop:0};return{x:v.pageX||(typeof v.clientX!="unknown"?v.clientX:0)+(C.scrollLeft||
F.scrollLeft)-(C.clientLeft||0),y:v.pageY||(typeof v.clientY!="unknown"?v.clientY:0)+(r.scrollTop||s.scrollTop)-(r.clientTop||0)}};k.util.observeEvent=function(v,C){B[v]||(B[v]=[]);B[v].push(C)};k.util.fireEvent=function(v,C){var F=B[v];if(F)for(var r=0,s=F.length;r<s;r++)F[r]({memo:C})}})(this);(function(){var h=document.createElement("div"),e=typeof h.style.filter==="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(typeof h.style.opacity==="string")b=function(g,o){g.style.opacity=
o;return g};else if(e)b=function(g,o){var q=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout)q.zoom=1;if(a.test(q.filter)){o=o>=0.9999?"":"alpha(opacity="+o*100+")";q.filter=q.filter.replace(a,o)}else q.filter+=" alpha(opacity="+o*100+")";return g};k.util.setStyle=function(g,o){var q=g.style;if(typeof o==="string"){g.style.cssText+=";"+o;return o.indexOf("opacity")>-1?b(g,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var t in o)if(t==="opacity")b(g,o[t]);else q[t==="float"||t==="cssFloat"?typeof q.styleFloat===
"undefined"?"cssFloat":"styleFloat":t]=o[t];return g}})();(function(){var h=document.documentElement.style,e="userSelect"in h?"userSelect":"MozUserSelect"in h?"MozUserSelect":"WebkitUserSelect"in h?"WebkitUserSelect":"KhtmlUserSelect"in h?"KhtmlUserSelect":"";k.util.makeElementUnselectable=function(a){if(typeof a.onselectstart!=="undefined")a.onselectstart=k.util.falseFunction;if(e)a.style[e]="none";else if(typeof a.unselectable=="string")a.unselectable="on";return a}})();(function(){function h(a,
b){e.load(a);b()}k.util.getScript=function(a,b){var g=document.getElementsByTagName("head")[0],o=document.createElement("script"),q=true;o.type="text/javascript";o.setAttribute("runat","server");o.onload=o.onreadystatechange=function(t){if(q)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){q=false;b(t||window.event);o=o.onload=o.onreadystatechange=null}};o.src=a;g.appendChild(o)};var e=z.Jaxer;if(e&&e.load)k.util.getScript=h})();k.util.getById=function(h){return typeof h===
"string"?document.getElementById(h):h};k.util.toArray=function(h){for(var e=[],a=h.length;a--;)e[a]=h[a];return e};k.util.makeElement=f;k.util.addClass=function(h,e){if((" "+h.className+" ").indexOf(" "+e+" ")===-1)h.className+=(h.className?" ":"")+e};k.util.wrapElement=function(h,e,a){if(typeof e==="string")e=f(e,a);h.parentNode&&h.parentNode.replaceChild(e,h);e.appendChild(h);return e};k.util.getElementOffset=function(h){var e=0,a=0;do{e+=h.offsetTop||0;a+=h.offsetLeft||0;h=h.offsetParent}while(h);
return{left:a,top:e}};k.util.animate=function(h){h||(h={});var e=+new Date,a=h.duration||500,b=e+a,g,o,q=h.onChange||function(){},t=h.easing||function(C){return-Math.cos(C*Math.PI)/2+0.5},A="startValue"in h?h.startValue:0,w="endValue"in h?h.endValue:100,B=A>w;h.onStart&&h.onStart();var v=setInterval(function(){g=+new Date;o=g>b?1:(g-e)/a;q(B?A-(A-w)*t(o):A+(w-A)*t(o));if(g>b){clearInterval(v);h.onComplete&&h.onComplete()}},10)};(function(){function h(){}var e=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(g){}}();k.util.request=function(a,b){b||(b={});var g=b.method?b.method.toUpperCase():"GET",o=b.onComplete||function(){},q=e(),t;q.onreadystatechange=function(){if(q.readyState===4){o(q);q.onreadystatechange=h}};if(g==="GET"){t=null;if(typeof b.parameters=="string")a=a+(/\?/.test(a)?"&":"?")+b.parameters}q.open(g,
a,true);if(g==="POST"||g==="PUT")q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(t);return q}})()})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.string.capitalize,m=l.util.object.clone,p={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};l.parseTransformAttribute=function(){function h(q,t){var A=t[0];q[0]=Math.cos(A);q[1]=Math.sin(A);q[2]=-Math.sin(A);q[3]=Math.cos(A)}function e(q,t){var A=t.length===2?t[1]:t[0];q[0]=t[0];q[3]=A}function a(q,t){q[4]=t[0];if(t.length===
2)q[5]=t[1]}var b=[1,0,0,1,0,0],g=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
o=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(q){var t=b.concat();if(!q||q&&!g.test(q))return t;q.replace(o,function(A){var w=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(A).filter(function(B){return B!==
""&&B!=null});A=w[1];w=w.slice(2).map(parseFloat);switch(A){case "translate":a(t,w);break;case "rotate":h(t,w);break;case "scale":e(t,w);break;case "skewX":t[2]=w[0];break;case "skewY":t[1]=w[0];break;case "matrix":t=w;break}});return t}}();l.parseSVGDocument=function(){var h=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,e=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(a,b){if(a){var g=l.util.toArray(a.getElementsByTagName("*")).filter(function(B){var v;if(v=h.test(B.tagName)){a:{for(B=B;B&&(B=B.parentNode);)if(B.nodeName==="pattern"){B=true;break a}B=false}v=!B}return v});if(!(!g||g&&!g.length)){var o=a.getAttribute("viewBox"),q=a.getAttribute("width"),t=a.getAttribute("height"),A=null,w=null;if(o&&(o=o.match(e))){parseInt(o[1],10);parseInt(o[2],10);A=parseInt(o[3],10);w=parseInt(o[4],10)}A=q?parseFloat(q):A;w=t?parseFloat(t):w;o={width:A,height:w};
g=l.parseElements(g,m(o));!g||g&&!g.length||b&&b(g,o)}}}}();f(l,{parseAttributes:function(h,e){if(h){var a,b,g={};if(h.parentNode&&/^g$/i.test(h.parentNode.nodeName))g=l.parseAttributes(h.parentNode,e);var o=e.reduce(function(q,t){a=h.getAttribute(t);b=parseFloat(a);if(a){if((t==="fill"||t==="stroke")&&a==="none")a="";if(t==="fill-rule")a=a==="evenodd"?"destination-over":a;if(t==="transform")a=l.parseTransformAttribute(a);if(t in p)t=p[t];q[t]=isNaN(b)?a:b}return q},{});o=f(l.parseStyleAttribute(h),
o);return f(g,o)}},parseElements:function(h,e){var a=h.map(function(b){var g=l[k(b.tagName)];if(g&&g.fromElement)try{return g.fromElement(b,e)}catch(o){l.log(o.message||o)}});return a=a.filter(function(b){return b!=null})},parseStyleAttribute:function(h){var e={};if(h=h.getAttribute("style"))if(typeof h=="string"){h=h.split(";");h.pop();e=h.reduce(function(b,g){var o=g.split(":"),q=o[0].trim();o=o[1].trim();b[q]=o;return b},{})}else for(var a in h)if(typeof h[a]!=="undefined")e[a]=h[a];return e},
parsePointsAttribute:function(h){if(!h)return null;h=h.trim();var e=h.indexOf(",")>-1;h=h.split(/\s+/);var a=[];if(e){e=0;for(var b=h.length;e<b;e++){var g=h[e].split(",");a.push({x:parseFloat(g[0]),y:parseFloat(g[1])})}}else{e=0;for(b=h.length;e<b;e+=2)a.push({x:parseFloat(h[e]),y:parseFloat(h[e+1])})}return a}})})(this);
(function(z){function l(f,k){arguments.length>0&&this.init(f,k)}z=z.fabric||(z.fabric={});if(z.Point)z.warn("fabric.Point is already defined");else{z.Point=l;l.prototype={constructor:l,init:function(f,k){this.x=f;this.y=k},add:function(f){return new l(this.x+f.x,this.y+f.y)},addEquals:function(f){this.x+=f.x;this.y+=f.y;return this},scalarAdd:function(f){return new l(this.x+f,this.y+f)},scalarAddEquals:function(f){this.x+=f;this.y+=f;return this},subtract:function(f){return new l(this.x-f.x,this.y-
f.y)},subtractEquals:function(f){this.x-=f.x;this.y-=f.y;return this},scalarSubtract:function(f){return new l(this.x-f,this.y-f)},scalarSubtractEquals:function(f){this.x-=f;this.y-=f;return this},multiply:function(f){return new l(this.x*f,this.y*f)},multiplyEquals:function(f){this.x*=f;this.y*=f;return this},divide:function(f){return new l(this.x/f,this.y/f)},divideEquals:function(f){this.x/=f;this.y/=f;return this},eq:function(f){return this.x==f.x&&this.y==f.y},lt:function(f){return this.x<f.x&&
this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,k){return new l(this.x+(f.x-this.x)*k,this.y+(f.y-this.y)*k)},distanceFrom:function(f){var k=this.x-f.x;f=this.y-f.y;return Math.sqrt(k*k+f*f)},min:function(f){return new l(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new l(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},
setXY:function(f,k){this.x=f;this.y=k},setFromPoint:function(f){this.x=f.x;this.y=f.y},swap:function(f){var k=this.x,m=this.y;this.x=f.x;this.y=f.y;f.x=k;f.y=m}}}})(this);
(function(z){function l(k){arguments.length>0&&this.init(k)}var f=z.fabric||(z.fabric={});if(f.Intersection)f.warn("fabric.Intersection is already defined");else{f.Intersection=l;f.Intersection.prototype={init:function(k){this.status=k;this.points=[]},appendPoint:function(k){this.points.push(k)},appendPoints:function(k){this.points=this.points.concat(k)}};f.Intersection.intersectLineLine=function(k,m,p,h){var e,a=(h.x-p.x)*(k.y-p.y)-(h.y-p.y)*(k.x-p.x);e=(m.x-k.x)*(k.y-p.y)-(m.y-k.y)*(k.x-p.x);p=
(h.y-p.y)*(m.x-k.x)-(h.x-p.x)*(m.y-k.y);if(p!=0){a=a/p;e=e/p;if(0<=a&&a<=1&&0<=e&&e<=1){e=new l("Intersection");e.points.push(new f.Point(k.x+a*(m.x-k.x),k.y+a*(m.y-k.y)))}else e=new l("No Intersection")}else e=a==0||e==0?new l("Coincident"):new l("Parallel");return e};f.Intersection.intersectLinePolygon=function(k,m,p){for(var h=new l("No Intersection"),e=p.length,a=0;a<e;a++){var b=l.intersectLineLine(k,m,p[a],p[(a+1)%e]);h.appendPoints(b.points)}if(h.points.length>0)h.status="Intersection";return h};
f.Intersection.intersectPolygonPolygon=function(k,m){for(var p=new l("No Intersection"),h=k.length,e=0;e<h;e++){var a=l.intersectLinePolygon(k[e],k[(e+1)%h],m);p.appendPoints(a.points)}if(p.points.length>0)p.status="Intersection";return p};f.Intersection.intersectPolygonRectangle=function(k,m,p){var h=m.min(p),e=m.max(p);p=new f.Point(e.x,h.y);var a=new f.Point(h.x,e.y);m=l.intersectLinePolygon(h,p,k);p=l.intersectLinePolygon(p,e,k);e=l.intersectLinePolygon(e,a,k);k=l.intersectLinePolygon(a,h,k);
h=new l("No Intersection");h.appendPoints(m.points);h.appendPoints(p.points);h.appendPoints(e.points);h.appendPoints(k.points);if(h.points.length>0)h.status="Intersection";return h}}})(this);
(function(z){function l(f){f?this._tryParsingColor(f):this.setSource([0,0,0,1])}z=z.fabric||(z.fabric={});if(z.Color)z.warn("fabric.Color is already defined.");else{z.Color=l;z.Color.prototype={_tryParsingColor:function(f){var k=l.sourceFromHex(f);k||(k=l.sourceFromRgb(f));k&&this.setSource(k)},getSource:function(){return this._source},setSource:function(f){this._source=f},toRgb:function(){var f=this.getSource();return"rgb("+f[0]+","+f[1]+","+f[2]+")"},toRgba:function(){var f=this.getSource();return"rgba("+
f[0]+","+f[1]+","+f[2]+","+f[3]+")"},toHex:function(){var f=this.getSource(),k=f[0].toString(16);k=k.length==1?"0"+k:k;var m=f[1].toString(16);m=m.length==1?"0"+m:m;f=f[2].toString(16);f=f.length==1?"0"+f:f;return k.toUpperCase()+m.toUpperCase()+f.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var k=this.getSource();k[3]=f;this.setSource(k);return this},toGrayscale:function(){var f=this.getSource(),k=parseInt((f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),10);this.setSource([k,
k,k,f[3]]);return this},toBlackWhite:function(f){var k=this.getSource(),m=(k[0]*0.3+k[1]*0.59+k[2]*0.11).toFixed(0);k=k[3];f=f||127;m=Number(m)<Number(f)?0:255;this.setSource([m,m,m,k]);return this},overlayWith:function(f){f instanceof l||(f=new l(f));var k=[],m=this.getAlpha(),p=this.getSource();f=f.getSource();for(var h=0;h<3;h++)k.push(Math.round(p[h]*0.5+f[h]*0.5));k[4]=m;this.setSource(k);return this}};z.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;
z.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;z.Color.fromRgb=function(f){return l.fromSource(l.sourceFromRgb(f))};z.Color.sourceFromRgb=function(f){if(f=f.match(l.reRGBa))return[parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10),f[4]?parseFloat(f[4]):1]};z.Color.fromRgba=l.fromRgb;z.Color.fromHex=function(f){return l.fromSource(l.sourceFromHex(f))};z.Color.sourceFromHex=function(f){if(f.match(l.reHex)){var k=f.slice(f.indexOf("#")+1),m=k.length===3;f=m?k.charAt(0)+k.charAt(0):k.substring(0,2);
var p=m?k.charAt(1)+k.charAt(1):k.substring(2,4);k=m?k.charAt(2)+k.charAt(2):k.substring(4,6);return[parseInt(f,16),parseInt(p,16),parseInt(k,16),1]}};z.Color.fromSource=function(f){var k=new l;k.setSource(f);return k}}})(this);
(function(z){if(fabric.Element)fabric.warn("fabric.Element is already defined.");else{var l=z.window,f=l.document,k=fabric.util.object.extend,m=fabric.util.string.capitalize,p=fabric.util.string.camelize,h=fabric.util.fireEvent,e=fabric.util.getPointer,a=fabric.util.getElementOffset,b=fabric.util.removeFromArray,g=fabric.util.addListener,o=fabric.util.removeListener,q=fabric.util.array.min,t=fabric.util.array.max,A=Math.sqrt,w=Math.pow,B=Math.atan2,v=Math.abs,C=Math.min,F=Math.max,r=Error("Could not initialize `canvas` element"),
s={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(c,d){this._groupSelector=null;this._objects=[];this._activeGroup=this._currentTransform=this._element=this._context=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._config={width:300,height:150};d=d||{};this._initElement(c);this._initConfig(d);d.overlayImage&&this.setOverlayImage(d.overlayImage);if(d.afterRender)this.afterRender=d.afterRender;
this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};k(fabric.Element.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},onObjectMove:null,onMouseUp:null,
calcOffset:function(){this._offset=a(this.getElement());return this},setOverlayImage:function(c,d){if(c){var n=this,u=new Image;u.onload=function(){n.overlayImage=u;d&&d();u=u.onload=null};u.src=c}return this},_initElement:function(c){this._element=fabric.util.getById(c)||f.createElement("canvas");typeof this._element.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(this._element);if(typeof this._element.getContext==="undefined")throw r;if(!(this.contextTop=
this._element.getContext("2d")))throw r;c=this._element.width||0;var d=this._element.height||0;this._initWrapperElement(c,d);this._setElementStyle(c,d)},_initWrapperElement:function(c,d){var n=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(n,{width:c+"px",height:d+"px"});fabric.util.makeElementUnselectable(n);this.wrapper=n},_setElementStyle:function(c,d){fabric.util.setStyle(this.getElement(),{position:"absolute",width:c+"px",height:d+"px",left:0,
top:0})},_initConfig:function(c){k(this._config,c||{});this._config.width=parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var c=this;this._onMouseDown=function(d){c.__onMouseDown(d)};this._onMouseUp=function(d){c.__onMouseUp(d)};this._onMouseMove=function(d){c.__onMouseMove(d)};this._onResize=function(){c.calcOffset()};g(this._element,
"mousedown",this._onMouseDown);g(f,"mousemove",this._onMouseMove);g(f,"mouseup",this._onMouseUp);g(l,"resize",this._onResize)},_createCanvasElement:function(c){var d=f.createElement("canvas");if(d){d.className=c;c=this._element.parentNode.insertBefore(d,this._element);c.width=this.getWidth();c.height=this.getHeight();c.style.width=this.getWidth()+"px";c.style.height=this.getHeight()+"px";c.style.position="absolute";c.style.left=0;c.style.top=0;typeof d.getContext==="undefined"&&typeof G_vmlCanvasManager!==
"undefined"&&G_vmlCanvasManager.initElement(d);if(typeof d.getContext==="undefined")throw r;fabric.util.makeElementUnselectable(c);return c}},_createCanvasContainer:function(){var c=this._createCanvasElement("canvas-container");this.contextContainerEl=c;this.contextContainer=c.getContext("2d")},_createCanvasBackground:function(){var c=this._createCanvasElement("canvas-container");this._contextBackgroundEl=c;this._contextBackground=c.getContext("2d")},getWidth:function(){return this._config.width},
getHeight:function(){return this._config.height},setWidth:function(c){return this._setDimension("width",c)},setHeight:function(c){return this._setDimension("height",c)},setDimensions:function(c){for(var d in c)this._setDimension(d,c[d]);return this},_setDimension:function(c,d){this.contextContainerEl[c]=d;this.contextContainerEl.style[c]=d+"px";this._contextBackgroundEl[c]=d;this._contextBackgroundEl.style[c]=d+"px";this._element[c]=d;this._element.style[c]=d+"px";this._element.parentNode.style[c]=
d+"px";this._config[c]=d;this.calcOffset();this.renderAll();return this},__onMouseUp:function(c){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._finalizeDrawingPath();else{if(this._currentTransform){var d=this._currentTransform.target;if(d._scaling){h("object:scaled",{target:d});d._scaling=false}for(var n=this._objects.length;n--;)this._objects[n].setCoords();if(d.hasStateChanged()){d.isMoving=false;h("object:modified",{target:d})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(c);
if(n=this.getActiveGroup()){n.hasStateChanged()&&n.containsPoint(this.getPointer(c))&&h("group:modified",{target:n});n.setObjectsCoords();n.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(c,d);this._setCursor("");var u=this;setTimeout(function(){u._setCursorFromEvent(c,d)},50);this.onMouseUp&&this.onMouseUp()}},_shouldClearSelection:function(c){var d=this.findTarget(c),n=this.getActiveGroup();return!d||d&&n&&!n.contains(d)&&n!==d&&
!c.shiftKey},__onMouseDown:function(c){if(this.isDrawingMode){this._prepareForDrawing(c);this._captureDrawingPath(c)}else if(!this._currentTransform){var d=this.findTarget(c),n=this.getPointer(c),u=this.getActiveGroup();if(this._shouldClearSelection(c)){this._groupSelector={ex:n.x,ey:n.y,top:0,left:0};this.deactivateAllWithDispatch()}else{d.saveState();d._findTargetCorner(c,this._offset)&&this.onBeforeScaleRotate(d);this._setupCurrentTransform(c,d);if(c.shiftKey&&(u||this.getActiveObject()))this._handleGroupLogic(c,
d);else{d!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(d)}}this.renderAll()}},getElement:function(){return this._element},deactivateAllWithDispatch:function(){var c=this.getActiveGroup();c&&h("before:group:destroyed",{target:c});this.deactivateAll();c&&h("after:group:destroyed");h("selection:cleared");return this},_setupCurrentTransform:function(c,d){var n="drag",u,x=e(c);if(u=d._findTargetCorner(c,this._offset))n=u==="ml"||u==="mr"?"scaleX":u==="mt"||u==="mb"?"scaleY":"rotate";
this._currentTransform={target:d,action:n,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:x.x-d.left,offsetY:x.y-d.top,ex:x.x,ey:x.y,left:d.left,top:d.top,theta:d.theta,width:d.width*d.scaleX};this._currentTransform.original={left:d.left,top:d.top}},_handleGroupLogic:function(c,d){if(d.isType("group")){d=this.findTarget(c,true);if(!d||d.isType("group"))return}var n=this.getActiveGroup();if(n){if(n.contains(d)){n.remove(d);d.setActive(false);n.size()===1&&this.removeActiveGroup()}else n.add(d);h("group:selected",
{target:n});n.setActive(true)}else{if(this._activeObject)if(d!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,d]));n=this.getActiveGroup()}d.setActive(true)}n&&n.saveCoords()},_prepareForDrawing:function(c){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();c=this.getPointer(c);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(c.x);this._freeDrawingYPoints.push(c.y);this.contextTop.beginPath();this.contextTop.moveTo(c.x,
c.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(c){c=this.getPointer(c);this._freeDrawingXPoints.push(c.x);this._freeDrawingYPoints.push(c.y);this.contextTop.lineTo(c.x,c.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var c=q(this._freeDrawingXPoints),d=q(this._freeDrawingYPoints),
n=t(this._freeDrawingXPoints),u=t(this._freeDrawingYPoints),x=[],y,D,E=this._freeDrawingXPoints,G=this._freeDrawingYPoints;x.push("M ",E[0]-c," ",G[0]-d," ");for(var H=1;y=E[H],D=G[H];H++)x.push("L ",y-c," ",D-d," ");x=new fabric.Path(x.join(""));x.fill=null;x.stroke=this.freeDrawingColor;x.strokeWidth=this.freeDrawingLineWidth;this.add(x);x.set("left",c+(n-c)/2).set("top",d+(u-d)/2).setCoords();this.renderAll();h("path:created",{path:x})},__onMouseMove:function(c){if(this.isDrawingMode)this._isCurrentlyDrawing&&
this._captureDrawingPath(c);else{var d=this._groupSelector;if(d!==null){var n=e(c);d.left=n.x-this._offset.left-d.ex;d.top=n.y-this._offset.top-d.ey;this.renderTop()}else if(this._currentTransform){n=e(c);d=n.x;n=n.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){c.shiftKey||this._rotateObject(d,n);this._scaleObject(d,n)}else if(this._currentTransform.action==="scaleX")this._scaleObject(d,n,"x");else if(this._currentTransform.action==="scaleY")this._scaleObject(d,
n,"y");else{this._translateObject(d,n);this.onObjectMove&&this.onObjectMove(this._currentTransform.target)}this.renderAll()}else{n=this._element.style;if(d=this.findTarget(c)){this._setCursorFromEvent(c,d);d.isActive()&&d.setCornersVisibility&&d.setCornersVisibility(true)}else{for(c=this._objects.length;c--;)this._objects[c].active||this._objects[c].setActive(false);n.cursor="default"}}}},_translateObject:function(c,d){var n=this._currentTransform.target;n.lockHorizontally||n.set("left",c-this._currentTransform.offsetX);
n.lockVertically||n.set("top",d-this._currentTransform.offsetY)},_scaleObject:function(c,d,n){var u=this._currentTransform,x=this._offset,y=u.target;if(!y.lockScaling){var D=A(w(u.ey-u.top-x.top,2)+w(u.ex-u.left-x.left,2));c=A(w(d-u.top-x.top,2)+w(c-u.left-x.left,2));y._scaling=true;if(n)if(n==="x")y.set("scaleX",u.scaleX*c/D);else n==="y"&&y.set("scaleY",u.scaleY*c/D);else{y.set("scaleX",u.scaleX*c/D);y.set("scaleY",u.scaleY*c/D)}}},_rotateObject:function(c,d){var n=this._currentTransform,u=this._offset;
if(!n.target.lockRotation){var x=B(n.ey-n.top-u.top,n.ex-n.left-u.left);u=B(d-n.top-u.top,c-n.left-u.left);n.target.set("theta",u-x+n.theta)}},_setCursor:function(c){this._element.style.cursor=c},_setCursorFromEvent:function(c,d){var n=this._element.style;if(d){var u=this.getActiveGroup();if(u=!!d._findTargetCorner&&(!u||!u.contains(d))&&d._findTargetCorner(c,this._offset))if(u in s)n.cursor=s[u];else{n.cursor="default";return false}else n.cursor="move"}else{n.cursor="default";return false}return true},
_draw:function(c,d){d&&d.render(c)},_drawSelection:function(){var c=this._groupSelector,d=c.left,n=c.top,u=v(d),x=v(n);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(c.ex-(d>0?0:-d),c.ey-(n>0?0:-n),u,x);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(c.ex+0.5-(d>0?0:u),c.ey+0.5-(n>0?0:x),u,x)},_findSelectedObjects:function(){var c=[],d=this._groupSelector.ex,n=this._groupSelector.ey,u=d+this._groupSelector.left,
x=n+this._groupSelector.top,y=new fabric.Point(C(d,u),C(n,x));n=new fabric.Point(F(d,u),F(n,x));u=0;for(x=this._objects.length;u<x;++u){d=this._objects[u];if(d.intersectsWithRect(y,n)||d.isContainedWithinRect(y,n)){d.setActive(true);c.push(d)}}if(c.length===1){this.setActiveObject(c[0]);h("object:selected",{target:c[0]})}else if(c.length>1){c=new fabric.Group(c);this.setActiveGroup(c);c.saveCoords();h("group:selected",{target:c})}this.renderAll()},add:function(){this._objects.push.apply(this._objects,
arguments);this.renderAll();return this},insertAt:function(c,d){this._objects.splice(d,0,c);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},clearContext:function(c){c.clearRect(0,0,this._config.width,this._config.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(c){var d=this._config.width,n=
this._config.height,u=c?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);c||this.clearContext(u);u.fillStyle=this.backgroundColor;u.fillRect(0,0,d,n);c=this._objects.length;d=this.getActiveGroup();n=new Date;if(c)for(var x=0;x<c;++x)if(!d||d&&!d.contains(this._objects[x]))this._draw(u,this._objects[x]);d&&this._draw(this.contextTop,d);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this.onFpsUpdate(~~(1E3/(new Date-n)));this.afterRender&&this.afterRender();
return this},renderTop:function(){this.clearContext(this.contextTop);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&this._drawSelection();var c=this.getActiveGroup();c&&c.render(this.contextTop);this.afterRender&&this.afterRender();return this},containsPoint:function(c,d){var n=this.getPointer(c),u=this._normalizePointer(d,n);n=u.x;u=u.y;var x=d._getImageLines(d.oCoords);if((n=d._findCrossPoints(n,u,x))&&n%2===1||d._findTargetCorner(c,this._offset))return true;
return false},_normalizePointer:function(c,d){var n=this.getActiveGroup(),u=d.x,x=d.y;if(n&&c.type!=="group"&&n.contains(c)){u-=n.left;x-=n.top}return{x:u,y:x}},findTarget:function(c,d){var n;this.getPointer(c);var u=this.getActiveGroup();if(u&&!d&&this.containsPoint(c,u))return n=u;for(u=this._objects.length;u--;)if(this.containsPoint(c,this._objects[u])){this.relatedTarget=n=this._objects[u];break}return n},toDataURL:function(c){var d;c||(c="png");if(c==="jpeg"||c==="png"){this.renderAll(true);
d=this.getElement().toDataURL("image/"+c);this.renderAll()}return d},toDataURLWithMultiplier:function(c,d){var n=this.getWidth(),u=this.getHeight(),x=n*d,y=u*d,D=this.getActiveObject();this.setWidth(x).setHeight(y);this.contextTop.scale(d,d);D&&this.deactivateAll().renderAll();x=this.toDataURL(c);this.contextTop.scale(1/d,1/d);this.setWidth(n).setHeight(u);D&&this.setActiveObject(D);this.renderAll();return x},getPointer:function(c){c=e(c);return{x:c.x-this._offset.left,y:c.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(c){c.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(c,d){d=d||{};var n=function(){},u=d.onComplete||n,x=d.onChange||n,y=this;fabric.util.animate({startValue:c.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(D){c.set("left",D);y.renderAll();x()},onComplete:function(){c.setCoords();u()}});return this},centerObjectV:function(c){c.set("top",this.getCenter().top);this.renderAll();
return this},fxCenterObjectV:function(c,d){d=d||{};var n=function(){},u=d.onComplete||n,x=d.onChange||n,y=this;fabric.util.animate({startValue:c.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(D){c.set("top",D);y.renderAll();x()},onComplete:function(){c.setCoords();u()}});return this},straightenObject:function(c){c.straighten();this.renderAll();return this},fxStraightenObject:function(c){c.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},
toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(c){return{objects:this._objects.map(function(d){if(!this.includeDefaultValues){var n=d.includeDefaultValues;d.includeDefaultValues=false}var u=d[c]();if(!this.includeDefaultValues)d.includeDefaultValues=n;return u},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(c,d){if(c){var n=
JSON.parse(c);if(!(!n||n&&!n.objects)){this.clear();var u=this;this._enlivenObjects(n.objects,function(){u.backgroundColor=n.background;d&&d()});return this}}},_enlivenObjects:function(c,d){var n=0,u=c.filter(function(y){return y.type==="image"}).length,x=this;c.forEach(function(y,D){if(y.type)switch(y.type){case "image":case "font":fabric[m(y.type)].fromObject(y,function(G){x.insertAt(G,D);++n===u&&d&&d()});break;default:var E=fabric[p(m(y.type))];E&&E.fromObject&&x.insertAt(E.fromObject(y),D);break}});
u===0&&d&&d()},loadFromDatalessJSON:function(c,d){if(c){var n=typeof c==="string"?JSON.parse(c):c;if(!(!n||n&&!n.objects)){this.clear();this.backgroundColor=n.background;this._enlivenDatalessObjects(n.objects,d)}}},_enlivenDatalessObjects:function(c,d){function n(E,G){u.insertAt(E,G);E.setCoords();++x===y&&d&&d()}var u=this,x=0,y=c.length;y===0&&d&&d();try{c.forEach(function(E,G){var H=E.paths?"paths":"path",J=E[H];delete E[H];if(typeof J!=="string")switch(E.type){case "image":case "text":fabric[m(E.type)].fromObject(E,
function(I){n(I,G)});break;default:(H=fabric[p(m(E.type))])&&H.fromObject&&n(H.fromObject(E),G);break}else if(E.type==="image")u.loadImageFromURL(J,function(I){I.setSourcePath(J);k(I,E);I.setAngle(E.angle);n(I,G)});else if(E.type==="text"){E.path=J;var L=fabric.Text.fromObject(E);fabric.util.getScript(J,function(){Object.prototype.toString.call(l.opera)==="[object Opera]"?setTimeout(function(){n(L,G)},500):n(L,G)})}else u.loadSVGFromURL(J,function(I){I=I.length>1?new fabric.PathGroup(I,E):I[0];I.setSourcePath(J);
if(!(I instanceof fabric.PathGroup)){k(I,E);typeof E.angle!=="undefined"&&I.setAngle(E.angle)}n(I,G)})},this)}catch(D){fabric.log(D.message)}},loadImageFromURL:function(){var c={};return function(d,n){function u(){var D=f.getElementById(c[d]);D.width&&D.height?n(new fabric.Image(D)):setTimeout(u,50)}var x=this;if(c[d])u();else{var y=new Image;y.onload=function(){y.onload=null;x._resizeImageToFit(y);var D=new fabric.Image(y);n(D)};y.className="canvas-img-clone";y.src=d;if(this.shouldCacheImages)c[d]=
Element.identify(y);f.body.appendChild(y)}}}(),loadSVGFromURL:function(c,d){function n(y){if(y=y.responseXML)(y=y.documentElement)&&fabric.parseSVGDocument(y,function(D,E){x.cache.set(c,{objects:D.invoke("toObject"),options:E});d(D,E)})}function u(){fabric.log("ERROR!")}var x=this;c=c.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(c,function(y){if(y)x.cache.get(c,function(D){D=x._enlivenCachedObject(D);d(D.objects,D.options)});else new Ajax.Request(c,{method:"get",onComplete:n,onFailure:u})})},
_enlivenCachedObject:function(c){var d=c.objects;c=c.options;d=d.map(function(n){return fabric[m(n.type)].fromObject(n)});return{objects:d,options:c}},remove:function(c){b(this._objects,c);this.renderAll();return c},fxRemove:function(c,d){var n=this;c.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){n.remove(c);typeof d==="function"&&d()}});return this},sendToBack:function(c){b(this._objects,c);this._objects.unshift(c);return this.renderAll()},bringToFront:function(c){b(this._objects,
c);this._objects.push(c);return this.renderAll()},sendBackwards:function(c){var d=this._objects.indexOf(c),n=d;if(d!==0){for(d=d-1;d>=0;--d)if(c.intersectsWithObject(this._objects[d])){n=d;break}b(this._objects,c);this._objects.splice(n,0,c)}return this.renderAll()},bringForward:function(c){var d=this.getObjects(),n=d.indexOf(c),u=n;if(n!==d.length-1){n=n+1;for(var x=this._objects.length;n<x;++n)if(c.intersectsWithObject(d[n])){u=n;break}b(d,c);d.splice(u,0,c)}this.renderAll()},setActiveObject:function(c){this._activeObject&&
this._activeObject.setActive(false);this._activeObject=c;c.setActive(true);this.renderAll();h("object:selected",{target:c});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;return this},setActiveGroup:function(c){this._activeGroup=c;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var c=this.getActiveGroup();c&&c.destroy();return this.setActiveGroup(null)},
item:function(c){return this.getObjects()[c]},deactivateAll:function(){for(var c=this.getObjects(),d=0,n=c.length;d<n;d++)c[d].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(c,d){c+=d.complexity?d.complexity():0;return c},0)},dispose:function(){this.clear();o(this.getElement(),"mousedown",this._onMouseDown);o(f,"mouseup",this._onMouseUp);o(f,"mousemove",this._onMouseMove);o(l,"resize",this._onResize);
return this},clone:function(c){var d=f.createElement("canvas");d.width=this.getWidth();d.height=this.getHeight();var n=this.__clone||(this.__clone=new fabric.Element(d));return n.loadFromJSON(JSON.stringify(this.toJSON()),function(){c&&c(n)})},_toDataURL:function(c,d){this.clone(function(n){d(n.toDataURL(c))})},_toDataURLWithMultiplier:function(c,d,n){this.clone(function(u){n(u.toDataURLWithMultiplier(c,d))})},_resizeImageToFit:function(c){var d=c.width||c.offsetWidth,n=this.getWidth()/d;if(d)c.width=
d*n},cache:{has:function(c,d){d(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};k(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(c){var d=c.getContext("2d");c=d.getImageData(0,0,c.width,c.height);var n=c.data,u=c.width,x=c.height,y,D;for(i=0;i<u;i++)for(j=0;j<x;j++){y=i*4*x+j*4;D=(n[y]+n[y+1]+n[y+2])/3;n[y]=D;n[y+1]=D;n[y+
2]=D}d.putImageData(c,0,0)},supports:function(c){var d=f.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(d);if(!d||!d.getContext)return null;var n=d.getContext("2d");if(!n)return null;switch(c){case "getImageData":return typeof n.getImageData!=="undefined";case "toDataURL":return typeof d.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.object.clone,m=l.util.toFixed,p=l.util.string.capitalize,h=l.util.getPointer,e=Array.prototype.slice;if(!l.Object){l.Object=l.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),
options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,e.call(arguments,1)):b.call(this)},
initialize:function(a){this.setOptions(a);this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(a){this.options=f(this._getOptions(),a)},_getOptions:function(){return f(k(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?
this.setAngle(this.options[a]):this[a]=this.options[a]},this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var a={type:this.type,left:m(this.left,this.NUM_FRACTION_DIGITS),top:m(this.top,this.NUM_FRACTION_DIGITS),width:m(this.width,this.NUM_FRACTION_DIGITS),height:m(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,
strokeWidth:this.strokeWidth,scaleX:m(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:m(this.scaleY,this.NUM_FRACTION_DIGITS),angle:m(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:m(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var b=l.Object.prototype.options;this.stateProperties.forEach(function(g){a[g]===b[g]&&delete a[g]});
return a},isActive:function(){return!!this.active},setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+p(this.type)+">"},set:function(a,b){if((a==="scaleX"||a==="scaleY")&&b<this.MIN_SCALE_LIMIT)b=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(b);else this[a]=b;return this},toggle:function(a){var b=this.get(a);typeof b==="boolean"&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},get:function(a){return a==="angle"?this.getAngle():
this[a]},render:function(a,b){if(!(this.width===0||this.height===0)){a.save();var g=this.transformMatrix;g&&a.setTransform(g[0],g[1],g[2],g[3],g[4],g[5]);b||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a,b);if(this.active&&!b){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*
this.scaleY},scale:function(a){this.scaleY=this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/
2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,b=Math.sin(this._angle+this.theta)*this._hypotenuse,g=this.theta,o=Math.sin(g);g=Math.cos(g);a={x:this.left-a,y:this.top-b};b={x:a.x+this.currentWidth*g,y:a.y+this.currentWidth*o};var q={x:a.x-this.currentHeight*o,y:a.y+this.currentHeight*g};this.oCoords={tl:a,tr:b,br:{x:b.x-this.currentHeight*o,y:b.y+this.currentHeight*g},bl:q,ml:{x:a.x-this.currentHeight/
2*o,y:a.y+this.currentHeight/2*g},mt:{x:a.x+this.currentWidth/2*g,y:a.y+this.currentWidth/2*o},mr:{x:b.x-this.currentHeight/2*o,y:b.y+this.currentHeight/2*g},mb:{x:q.x+this.currentWidth/2*g,y:q.y+this.currentWidth/2*o}};this._setCornerCoords();return this},drawBorders:function(a){var b=this.options,g=b.padding,o=g*2;a.save();a.globalAlpha=this.isMoving?b.borderOpacityWhenMoving:1;a.strokeStyle=b.borderColor;b=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var q=1/(this.scaleY<
this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(b,q);b=this.getWidth();q=this.getHeight();a.strokeRect(~~(-(b/2)-g)+0.5,~~(-(q/2)-g)+0.5,~~(b+o),~~(q+o));a.restore();return this},drawCorners:function(a){var b=this.options.cornersize,g=b/2,o=this.options.padding,q=-(this.width/2),t=-(this.height/2),A=b/this.scaleX,w=b/this.scaleY,B=(o+g)/this.scaleY,v=(o+g)/this.scaleX,C=(o+g-b)/this.scaleX;o=(o+g-b)/this.scaleY;a.save();a.globalAlpha=this.isMoving?
this.options.borderOpacityWhenMoving:1;a.fillStyle=this.options.cornerColor;b=q-v;g=t-B;a.fillRect(b,g,A,w);b=q+this.width-v;g=t-B;a.fillRect(b,g,A,w);b=q-v;g=t+this.height+o;a.fillRect(b,g,A,w);b=q+this.width+C;g=t+this.height+o;a.fillRect(b,g,A,w);b=q+this.width/2-v;g=t-B;a.fillRect(b,g,A,w);b=q+this.width/2-v;g=t+this.height+o;a.fillRect(b,g,A,w);b=q+this.width+C;g=t+this.height/2-B;a.fillRect(b,g,A,w);b=q-v;g=t+this.height/2-B;a.fillRect(b,g,A,w);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),
a);return new l.Object(this.toObject())},cloneAsImage:function(a){if(l.Image){var b=new Image;b.onload=function(){a&&a(new l.Image(b),g);b=b.onload=null};var g={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);b.src=this.toDataURL()}return this},toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();l.util.wrapElement(a,"div");var b=new l.Element(a);b.backgroundColor=
"transparent";b.renderAll();var g=this.clone();g.left=a.width/2;g.top=a.height/2;g.setActive(false);b.add(g);a=b.toDataURL("png");b.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},intersectsWithRect:function(a,b){var g=this.oCoords,o=new l.Point(g.tl.x,g.tl.y),q=new l.Point(g.tr.x,g.tr.y),t=new l.Point(g.bl.x,
g.bl.y);g=new l.Point(g.br.x,g.br.y);return l.Intersection.intersectPolygonRectangle([o,q,g,t],a,b).status==="Intersection"},intersectsWithObject:function(a){function b(o){return{tl:new l.Point(o.tl.x,o.tl.y),tr:new l.Point(o.tr.x,o.tr.y),bl:new l.Point(o.bl.x,o.bl.y),br:new l.Point(o.br.x,o.br.y)}}var g=b(this.oCoords);a=b(a.oCoords);return l.Intersection.intersectPolygonPolygon([g.tl,g.tr,g.br,g.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,b){var g=this.oCoords,
o=new l.Point(g.tl.x,g.tl.y),q=new l.Point(g.tr.x,g.tr.y),t=new l.Point(g.bl.x,g.bl.y);new l.Point(g.br.x,g.br.y);return o.x>a.x&&q.x<b.x&&o.y>a.y&&t.y<b.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,b){var g=h(a),o=g.x-b.left;g=g.y-b.top;var q;for(var t in this.oCoords){q=this._getImageLines(this.oCoords[t].corner,t);q=this._findCrossPoints(o,g,q);if(q%2==1&&q!=0)return this.__corner=t}return false},_findCrossPoints:function(a,b,g){var o,q,t,A=0;for(var w in g){t=g[w];
if(!(t.o.y<b&&t.d.y<b))if(!(t.o.y>=b&&t.d.y>=b)){if(t.o.x==t.d.x&&t.o.x>=a)o=t.o.x;else{o=(t.d.y-t.o.y)/(t.d.x-t.o.x);q=b-0*a;t=t.o.y-o*t.o.x;o=-(q-t)/(0-o)}if(o>=a)A+=1;if(A==2)break}}return A},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,b=this.theta,g=this.cornersize*Math.cos(b),o=this.cornersize*Math.sin(b);b=this.cornersize/2;var q=b-o;a.tl.x-=q;a.tl.y-=
b;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+g,y:a.tl.y+o},bl:{x:a.tl.x-o,y:a.tl.y+g}};a.tl.corner.br={x:a.tl.corner.tr.x-o,y:a.tl.corner.tr.y+g};a.tl.x+=q;a.tl.y+=b;a.tr.x+=b;a.tr.y-=b;a.tr.corner={tl:{x:a.tr.x-g,y:a.tr.y-o},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-o,y:a.tr.y+g}};a.tr.corner.bl={x:a.tr.corner.tl.x-o,y:a.tr.corner.tl.y+g};a.tr.x-=b;a.tr.y+=b;a.bl.x-=b;a.bl.y+=b;a.bl.corner={tl:{x:a.bl.x+o,y:a.bl.y-g},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+g,y:a.bl.y+o}};a.bl.corner.tr={x:a.bl.corner.br.x+
o,y:a.bl.corner.br.y-g};a.bl.x+=b;a.bl.y-=b;a.br.x+=b;a.br.y+=b;a.br.corner={tr:{x:a.br.x+o,y:a.br.y-g},bl:{x:a.br.x-g,y:a.br.y-o},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+o,y:a.br.corner.bl.y-g};a.br.x-=b;a.br.y-=b;a.ml.x-=b;a.ml.y-=b;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+g,y:a.ml.y+o},bl:{x:a.ml.x-o,y:a.ml.y+g}};a.ml.corner.br={x:a.ml.corner.tr.x-o,y:a.ml.corner.tr.y+g};a.ml.x+=b;a.ml.y+=b;a.mt.x-=b;a.mt.y-=b;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+g,y:a.mt.y+
o},bl:{x:a.mt.x-o,y:a.mt.y+g}};a.mt.corner.br={x:a.mt.corner.tr.x-o,y:a.mt.corner.tr.y+g};a.mt.x+=b;a.mt.y+=b;a.mr.x-=b;a.mr.y-=b;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+g,y:a.mr.y+o},bl:{x:a.mr.x-o,y:a.mr.y+g}};a.mr.corner.br={x:a.mr.corner.tr.x-o,y:a.mr.corner.tr.y+g};a.mr.x+=b;a.mr.y+=b;a.mb.x-=b;a.mb.y-=b;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+g,y:a.mb.y+o},bl:{x:a.mb.x-o,y:a.mb.y+g}};a.mb.corner.br={x:a.mb.corner.tr.x-o,y:a.mb.corner.tr.y+g};a.mb.x+=b;a.mb.y+=b;a=a.mb.corner;
a.tl.x-=b;a.tl.y-=b;a.tr.x-=b;a.tr.y-=b;a.br.x-=b;a.br.y-=b;a.bl.x-=b;a.bl.y-=b},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new l.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var b=function(){},g=a.onComplete||b,o=a.onChange||
b,q=this;l.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){q.setAngle(t);o()},onComplete:function(){q.setCoords();g()},onStart:function(){q.setActive(false)}});return this},fxRemove:function(a){a||(a={});var b=function(){},g=a.onComplete||b,o=a.onChange||b,q=this;l.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(t){q.set("opacity",t);o()},onComplete:g,onStart:function(){q.setActive(false)}});
return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0},toJSON:function(){return this.toObject()}});l.Object.prototype.rotate=l.Object.prototype.setAngle}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend;if(l.Line)l.warn("fabric.Line is already defined");else{l.Line=l.util.createClass(l.Object,{type:"line",initialize:function(k,m){k||(k=[0,0,0,0]);this.callSuper("initialize",m);this.set("x1",k[0]);this.set("y1",k[1]);this.set("x2",k[2]);this.set("y2",k[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(k){k.beginPath();
k.moveTo(-this.width/2,-this.height/2);k.lineTo(this.width/2,this.height/2);var m=k.strokeStyle;k.strokeStyle=k.fillStyle;k.stroke();k.strokeStyle=m},complexity:function(){return 1},toObject:function(){return f(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});l.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");l.Line.fromElement=function(k,m){var p=l.parseAttributes(k,l.Line.ATTRIBUTE_NAMES);return new l.Line([p.x1||
0,p.y1||0,p.x2||0,p.y2||0],f(p,m))};l.Line.fromObject=function(k){return new l.Line([k.x1,k.y1,k.x2,k.y2],k)}}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=Math.PI*2,k=l.util.object.extend;if(l.Circle)l.warn("fabric.Circle is already defined.");else{l.Circle=l.util.createClass(l.Object,{type:"circle",initialize:function(m){m=m||{};this.set("radius",m.radius||0);this.callSuper("initialize",m);m=this.get("radius")*2*this.get("scaleX");this.set("width",m).set("height",m)},toObject:function(){return k(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(m,p){m.beginPath();m.arc(p?this.left:
0,p?this.top:0,this.radius,0,f,false);m.closePath();this.fill&&m.fill();this.stroke&&m.stroke()},complexity:function(){return 1}});l.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");l.Circle.fromElement=function(m,p){p||(p={});var h=l.parseAttributes(m,l.Circle.ATTRIBUTE_NAMES);if(!("radius"in h&&h.radius>0))throw Error("value of `r` attribute is required and can not be negative");if("left"in h)h.left-=p.width/2||0;if("top"in h)h.top-=p.height/2||0;return new l.Circle(k(h,
p))};l.Circle.fromObject=function(m){return new l.Circle(m)}}})(this);
(function(z){var l=z.fabric||(z.fabric={});if(l.Triangle)l.warn("fabric.Triangle is already defined");else{l.Triangle=l.util.createClass(l.Object,{type:"triangle",initialize:function(f){f=f||{};this.callSuper("initialize",f);this.set("width",f.width||100).set("height",f.height||100)},_render:function(f){var k=this.width/2,m=this.height/2;f.beginPath();f.moveTo(-k,m);f.lineTo(0,-m);f.lineTo(k,m);f.closePath();this.fill&&f.fill();this.stroke&&f.stroke()},complexity:function(){return 1}});l.Triangle.fromObject=
function(f){return new l.Triangle(f)}}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=Math.PI*2,k=l.util.object.extend;if(l.Ellipse)l.warn("fabric.Ellipse is already defined.");else{l.Ellipse=l.util.createClass(l.Object,{type:"ellipse",initialize:function(m){m=m||{};this.callSuper("initialize",m);this.set("rx",m.rx||0);this.set("ry",m.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return k(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(m,p){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",m,p)},_render:function(m,p){m.beginPath();m.save();m.transform(1,0,0,this.ry/this.rx,0,0);m.arc(p?this.left:0,p?this.top:0,this.rx,0,f,false);m.restore();this.stroke&&m.stroke();this.fill&&m.fill()},complexity:function(){return 1}});l.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");l.Ellipse.fromElement=function(m,p){p||(p={});var h=l.parseAttributes(m,l.Ellipse.ATTRIBUTE_NAMES);if("left"in h)h.left-=p.width/
2||0;if("top"in h)h.top-=p.height/2||0;return new l.Ellipse(k(h,p))};l.Ellipse.fromObject=function(m){return new l.Ellipse(m)}}})(this);
(function(z){var l=z.fabric||(z.fabric={});if(l.Rect)console.warn("fabric.Rect is already defined");else{l.Rect=l.util.createClass(l.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(f){this.callSuper("initialize",f);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(f){var k=this.options.rx||0,m=this.options.ry||0,p=-this.width/2,h=-this.height/
2,e=this.width,a=this.height;f.beginPath();f.moveTo(p+k,h);f.lineTo(p+e-k,h);f.bezierCurveTo(p+e,h,p+e,h+m,p+e,h+m);f.lineTo(p+e,h+a-m);f.bezierCurveTo(p+e,h+a,p+e-k,h+a,p+e-k,h+a);f.lineTo(p+k,h+a);f.bezierCurveTo(p,h+a,p,h+a-m,p,h+a-m);f.lineTo(p,h+m);f.bezierCurveTo(p,h,p+k,h,p+k,h);f.closePath();this.fill&&f.fill();this.stroke&&f.stroke()},_normalizeLeftTopProperties:function(f){f.left&&this.set("left",f.left+this.getWidth()/2);f.top&&this.set("top",f.top+this.getHeight()/2);return this},complexity:function(){return 1}});
l.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");l.Rect.fromElement=function(f,k){if(!f)return null;var m=l.parseAttributes(f,l.Rect.ATTRIBUTE_NAMES);m=m;m.left=m.left||0;m.top=m.top||0;m=m;var p=new l.Rect(l.util.object.extend(k||{},m));p._normalizeLeftTopProperties(m);return p};l.Rect.fromObject=function(f){return new l.Rect(f)}}})(this);
(function(z){var l=z.fabric||(z.fabric={});if(l.Polyline)l.warn("fabric.Polyline is already defined");else{l.Polyline=l.util.createClass(l.Object,{type:"polyline",initialize:function(f,k){k=k||{};this.set("points",f);this.callSuper("initialize",k);this._calcDimensions()},_calcDimensions:function(){return l.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return l.Polygon.prototype.toObject.call(this)},_render:function(f){var k;f.beginPath();for(var m=0,p=this.points.length;m<p;m++){k=
this.points[m];f.lineTo(k.x,k.y)}this.fill&&f.fill();this.stroke&&f.stroke()},complexity:function(){return this.get("points").length}});l.Polyline.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");l.Polyline.fromElement=function(f,k){if(!f)return null;k||(k={});for(var m=l.parsePointsAttribute(f.getAttribute("points")),p=l.parseAttributes(f,l.Polyline.ATTRIBUTE_NAMES),h=0,e=m.length;h<e;h++){m[h].x-=k.width/2||0;m[h].y-=k.height/2||0}return new l.Polyline(m,l.util.object.extend(p,
k))};l.Polyline.fromObject=function(f){return new l.Polyline(f.points,f)}}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.array.min,m=l.util.array.max;if(l.Polygon)l.warn("fabric.Polygon is already defined");else{l.Polygon=l.util.createClass(l.Object,{type:"polygon",initialize:function(p,h){h=h||{};this.points=p;this.callSuper("initialize",h);this._calcDimensions()},_calcDimensions:function(){var p=this.points,h=k(p,"x"),e=k(p,"y"),a=m(p,"x");p=m(p,"y");this.width=a-h;this.height=p-e;this.minX=h;this.minY=e},toObject:function(){return f(this.callSuper("toObject"),
{points:this.points.concat()})},_render:function(p){var h;p.beginPath();for(var e=0,a=this.points.length;e<a;e++){h=this.points[e];p.lineTo(h.x,h.y)}this.fill&&p.fill();if(this.stroke){p.closePath();p.stroke()}},complexity:function(){return this.points.length}});l.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");l.Polygon.fromElement=function(p,h){if(!p)return null;h||(h={});for(var e=l.parsePointsAttribute(p.getAttribute("points")),a=l.parseAttributes(p,l.Polygon.ATTRIBUTE_NAMES),
b=0,g=e.length;b<g;b++){e[b].x-=h.width/2||0;e[b].y-=h.height/2||0}return new l.Polygon(e,f(a,h))};l.Polygon.fromObject=function(p){return new l.Polygon(p.points,p)}}})(this);
(function(z){function l(e){if(e[0]==="H")return e[1];return e[e.length-2]}function f(e){if(e[0]==="V")return e[1];return e[e.length-1]}var k=z.fabric||(z.fabric={}),m=k.util.array.min,p=k.util.array.max,h=k.util.object.extend;if(k.Path)k.warn("fabric.Path is already defined");else if(k.Object){k.Path=k.util.createClass(k.Object,{type:"path",initialize:function(e,a){a=a||{};this.setOptions(a);this._importProperties();this.originalState={};if(!e)throw Error("`path` argument is required");var b=Object.prototype.toString.call(e)===
"[object Array]";if(this.path=b?e:e.match&&e.match(/[a-zA-Z][^a-zA-Z]*/g)){b||this._initializeFromArray(a);this.setCoords();a.sourcePath&&this.setSourcePath(a.sourcePath)}},_initializeFromArray:function(e){var a="width"in e;e="height"in e;this.path=this._parsePath();if(!a||!e){h(this,this._parseDimensions());if(a)this.width=this.options.width;if(e)this.height=this.options.height}},_render:function(e){for(var a,b=0,g=0,o=0,q=0,t,A,w=-(this.width/2),B=-(this.height/2),v=0,C=this.path.length;v<C;++v){a=
this.path[v];switch(a[0]){case "l":b+=a[1];g+=a[2];e.lineTo(b+w,g+B);break;case "L":b=a[1];g=a[2];e.lineTo(b+w,g+B);break;case "h":b+=a[1];e.lineTo(b+w,g+B);break;case "H":b=a[1];e.lineTo(b+w,g+B);break;case "v":g+=a[1];e.lineTo(b+w,g+B);break;case "V":g=a[1];e.lineTo(b+w,g+B);break;case "m":b+=a[1];g+=a[2];e.moveTo(b+w,g+B);break;case "M":b=a[1];g=a[2];e.moveTo(b+w,g+B);break;case "c":t=b+a[5];A=g+a[6];o=b+a[3];q=g+a[4];e.bezierCurveTo(b+a[1]+w,g+a[2]+B,o+w,q+B,t+w,A+B);b=t;g=A;break;case "C":b=
a[5];g=a[6];o=a[3];q=a[4];e.bezierCurveTo(a[1]+w,a[2]+B,o+w,q+B,b+w,g+B);break;case "s":t=b+a[3];A=g+a[4];o=2*b-o;q=2*g-q;e.bezierCurveTo(o+w,q+B,b+a[1]+w,g+a[2]+B,t+w,A+B);b=t;g=A;break;case "S":t=a[3];A=a[4];o=2*b-o;q=2*g-q;e.bezierCurveTo(o+w,q+B,a[1]+w,a[2]+B,t+w,A+B);b=t;g=A;break;case "q":b+=a[3];g+=a[4];e.quadraticCurveTo(a[1]+w,a[2]+B,b+w,g+B);break;case "Q":b=a[3];g=a[4];o=a[1];q=a[2];e.quadraticCurveTo(o+w,q+B,b+w,g+B);break;case "T":t=b;A=g;b=a[1];g=a[2];o=-o+2*t;q=-q+2*A;e.quadraticCurveTo(o+
w,q+B,b+w,g+B);break;case "a":break;case "A":break;case "z":case "Z":e.closePath();break}}},render:function(e,a){e.save();var b=this.transformMatrix;b&&e.transform(b[0],b[1],b[2],b[3],b[4],b[5]);a||this.transform(e);if(this.overlayFill)e.fillStyle=this.overlayFill;else if(this.fill)e.fillStyle=this.fill;if(this.stroke)e.strokeStyle=this.stroke;e.beginPath();this._render(e);this.fill&&e.fill();if(this.stroke){e.strokeStyle=this.stroke;e.lineWidth=this.strokeWidth;e.lineCap=e.lineJoin="round";e.stroke()}if(!a&&
this.active){this.drawBorders(e);this.hideCorners||this.drawCorners(e)}e.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var e=h(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)e.sourcePath=this.sourcePath;if(this.transformMatrix)e.transformMatrix=this.transformMatrix;return e},toDatalessObject:function(){var e=this.toObject();if(this.sourcePath)e.path=this.sourcePath;delete e.sourcePath;
return e},complexity:function(){return this.path.length},_parsePath:function(){for(var e=[],a,b,g=0,o=this.path.length;g<o;g++){a=this.path[g];b=a.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);e.push([a.charAt(0)].concat(b.map(parseFloat)))}return e},_parseDimensions:function(){var e=[],a=[],b,g,o=false,q,t;this.path.forEach(function(v,C){if(v[0]!=="H")b=C===0?l(v):l(this.path[C-1]);if(v[0]!=="V")g=C===0?f(v):f(this.path[C-1]);if(v[0]===v[0].toLowerCase())o=true;q=o?b+l(v):v[0]==="V"?
b:l(v);t=o?g+f(v):v[0]==="H"?g:f(v);var F=parseInt(q,10);isNaN(F)||e.push(F);F=parseInt(t,10);isNaN(F)||a.push(F)},this);var A=m(e),w=m(a),B=deltaY=0;A={top:w-deltaY,left:A-B,bottom:p(a)-deltaY,right:p(e)-B};A.width=A.right-A.left;A.height=A.bottom-A.top;return A}});k.Path.fromObject=function(e){return new k.Path(e.path,e)};k.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");k.Path.fromElement=function(e,a){var b=k.parseAttributes(e,k.Path.ATTRIBUTE_NAMES),
g=b.d;delete b.d;return new k.Path(g,h(b,a))}}else k.warn("fabric.Path requires fabric.Object")})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.array.invoke,m=l.Object.prototype.set,p=l.Object.prototype.toObject,h=l.util.string.camelize,e=l.util.string.capitalize;if(l.PathGroup)l.warn("fabric.PathGroup is already defined");else{l.PathGroup=l.util.createClass(l.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(a,b){b=b||{};this.originalState={};this.paths=a;this.setOptions(b);this._initProperties();this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},
_initProperties:function(){this.stateProperties.forEach(function(a){if(a==="fill")this.set(a,this.options[a]);else if(a==="angle")this.setAngle(this.options[a]);else this[a]=this.options[a]},this)},render:function(a){if(this.stub){a.save();this.transform(a);this.stub.render(a,false);if(this.active){this.drawBorders(a);this.drawCorners(a)}}else{a.save();var b=this.transformMatrix;b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);this.transform(a);b=0;for(var g=this.paths.length;b<g;++b)this.paths[b].render(a,
true);if(this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}}a.restore()},set:function(a,b){if((a==="fill"||a==="overlayFill")&&this.isSameColor()){this[a]=b;for(var g=this.paths.length;g--;)this.paths[g].set(a,b)}else m.call(this,a,b);return this},toObject:function(){return f(p.call(this),{paths:k(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.paths=this.sourcePath;return a},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}});l.PathGroup.fromObject=function(a){for(var b=a.paths,
g=0,o=b.length;g<o;g++)if(!(b[g]instanceof l.Object)){var q=h(e(b[g].type));b[g]=l[q].fromObject(b[g])}return new l.PathGroup(b,a)}}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.array.min,m=l.util.array.max,p=l.util.array.invoke,h=l.util.removeFromArray;if(!l.Group){l.Group=l.util.createClass(l.Object,{type:"group",initialize:function(e,a){this.objects=e||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&f(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var e=this.left,
a=this.top;this.forEachObject(function(b){var g=b.get("left"),o=b.get("top");b.set("originalLeft",g);b.set("originalTop",o);b.set("left",g-e);b.set("top",o-a);b.setCoords();b.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(e){this._restoreObjectsState();this.objects.push(e);e.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(e){this._restoreObjectsState();
h(this.objects,e);e.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(e,a){if(typeof a=="function")this.set(e,a(this[e]));else if(e==="fill"||e==="opacity"){var b=this.objects.length;for(this[e]=a;b--;)this.objects[b].set(e,a)}else this[e]=a;return this},contains:function(e){return this.objects.indexOf(e)>-1},toObject:function(){return f(this.callSuper("toObject"),{objects:p(this.objects,"clone")})},render:function(e){e.save();
this.transform(e);for(var a=Math.max(this.scaleX,this.scaleY),b=0,g;g=this.objects[b];b++){var o=g.borderScaleFactor;g.borderScaleFactor=a;g.render(e);g.borderScaleFactor=o}this.hideBorders||this.drawBorders(e);this.hideCorners||this.drawCorners(e);e.restore();this.setCoords()},item:function(e){return this.getObjects()[e]},complexity:function(){return this.getObjects().reduce(function(e,a){e+=typeof a.complexity=="function"?a.complexity():0;return e},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(e){var a=this.get("left"),b=this.get("top"),g=this.getAngle()*(Math.PI/180);e.get("originalLeft");e.get("originalTop");var o=Math.cos(g)*e.get("top")+Math.sin(g)*e.get("left");g=-Math.sin(g)*e.get("top")+Math.cos(g)*e.get("left");e.setAngle(e.getAngle()+this.getAngle());e.set("left",a+g*this.get("scaleX"));e.set("top",b+o*this.get("scaleY"));e.set("scaleX",e.get("scaleX")*this.get("scaleX"));e.set("scaleY",e.get("scaleY")*this.get("scaleY"));e.setCoords();
e.hideCorners=false;e.setActive(false);e.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(e){e.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(e){this.forEachObject(function(a){a.setActive(e)});
return this},forEachObject:function(e,a){for(var b=this.getObjects(),g=b.length;g--;)e.call(a,b[g],g,b);return this},_setOpacityIfSame:function(){var e=this.getObjects(),a=e[0]?e[0].get("opacity"):1;if(e.every(function(b){return b.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var e=[],a=[],b,g;g=0;for(var o=this.objects.length;g<o;++g){b=this.objects[g];b.setCoords();for(var q in b.oCoords){e.push(b.oCoords[q].x);a.push(b.oCoords[q].y)}}b=k(e);g=m(e);e=k(a);a=m(a);g=g-b;a=a-e;this.width=
g;this.height=a;this.left=b+g/2;this.top=e+a/2},containsPoint:function(e){var a=this.get("width")/2,b=this.get("height")/2,g=this.get("left"),o=this.get("top");return g-a<e.x&&g+a>e.x&&o-b<e.y&&o+b>e.y},toGrayscale:function(){for(var e=this.objects.length;e--;)this.objects[e].toGrayscale()}});l.Group.fromObject=function(e){return new l.Group(e.objects,e)}}})(this);
(function(z){var l=z.fabric||(z.fabric={}),f=l.util.object.extend,k=l.util.object.clone;if(l.Text)l.warn("fabric.Text is already defined");else if(l.Object){l.Text=l.util.createClass(l.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(m,p){this.originalState={};this._initStateProperties();this.text=m;this.setOptions(p);f(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},
_initStateProperties:function(){var m;if((m=this.constructor)&&(m=m.superclass)&&(m=m.prototype)&&(m=m.stateProperties)&&m.clone){this.stateProperties=m.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(m){var p=Cufon.textOptions||(Cufon.textOptions={});p.left=this.left;p.top=this.top;p.context=m;p.color=this.fill;var h=this._initDummyElement();
this.transform(m);Cufon.replaceElement(h,{separate:"none",fontFamily:this.fontfamily});this.width=p.width;this.height=p.height},_initDummyElement:function(){var m=document.createElement("div");m.innerHTML=this.text;m.style.fontSize="40px";m.style.fontWeight="400";m.style.fontStyle="normal";m.style.letterSpacing="normal";m.style.color="#000000";m.style.fontWeight="600";m.style.fontFamily="Verdana";return m},render:function(m){m.save();this._render(m);if(this.active){this.drawBorders(m);this.drawCorners(m)}m.restore()},
toObject:function(){return f(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(m){this.set("fill",m);return this},setFontsize:function(m){this.set("fontsize",m);this.setCoords();return this},getText:function(){return this.text},setText:function(m){this.set("text",m);this.setCoords();return this},set:function(m,p){this[m]=p;if(m==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+p+"$3");return this}});l.Text.fromObject=function(m){return new l.Text(m.text,k(m))};l.Text.fromElement=function(){}}else l.warn("fabric.Text requires fabric.Object")})(this);
(function(z){var l=fabric.util.object.extend;if(!z.fabric)z.fabric={};if(z.fabric.Image)fabric.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(f,k){this.callSuper("initialize",k);this._initElement(f);this._initConfig(k||{})},getElement:function(){return this._element},setElement:function(f){this._element=
f;return this},getNormalizedSize:function(f,k,m){if(m&&k&&f.width>f.height&&f.width/f.height<k/m){normalizedWidth=~~(f.width*m/f.height);normalizedHeight=m}else if(m&&(f.height==f.width||f.height>f.width||f.height>m)){normalizedWidth=~~(f.width*m/f.height);normalizedHeight=m}else if(k&&k<f.width){normalizedHeight=~~(f.height*k/f.width);normalizedWidth=k}else{normalizedWidth=f.width;normalizedHeight=f.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var f=this.getElement();
return{width:f.width,height:f.height}},setBorderVisibility:function(){this._resetWidthHeight();this._adjustWidthHeightToBorders(showBorder);this.setCoords()},setCornersVisibility:function(f){this.cornervisibility=!!f},render:function(f,k){f.save();k||this.transform(f);this._render(f);if(this.active&&!k){this.drawBorders(f);this.hideCorners||this.drawCorners(f)}f.restore()},toObject:function(){return l(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},
toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(f){this.constructor.fromObject(this.toObject(),f)},toGrayscale:function(f){if(!this.__isGrayscaled){var k=this.getElement(),m=document.createElement("canvas"),p=document.createElement("img"),h=this;m.width=k.width;m.height=k.height;m.getContext("2d").drawImage(k,0,0);fabric.Element.toGrayscale(m);p.onload=function(){h.setElement(p);f&&f();p.onload=m=k=imageData=null};p.width=k.width;p.height=k.height;p.src=m.toDataURL("image/png");
this.__isGrayscaled=true;return this}},_render:function(f){var k=this.getOriginalSize();f.drawImage(this.getElement(),-k.width/2,-k.height/2,k.width,k.height)},_adjustWidthHeightToBorders:function(f){if(f){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var f=this.getElement();this.set("width",f.width);this.set("height",f.height)},_initElement:function(f){this.setElement(fabric.util.getById(f));
fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(f){this.setOptions(f);this._setBorder();this._setWidthHeight(f)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var f=2*this.currentBorder;this.width=(this.getElement().width||0)+f;this.height=(this.getElement().height||0)+f},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(f,k){var m=document.createElement("img"),
p=f.src;if(f.width)m.width=f.width;if(f.height)m.height=f.height;m.onload=function(){k&&k(new fabric.Image(m,f));m=m.onload=null};m.src=p};fabric.Image.fromURL=function(f,k,m){var p=document.createElement("img");p.onload=function(){k&&k(new fabric.Image(p,m));p=p.onload=null};p.src=f}}else fabric.warn("fabric.Object is required for fabric.Image initialization")})(this);
