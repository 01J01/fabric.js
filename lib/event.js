if(typeof Event==="undefined")var Event={};if(typeof eventjs==="undefined")var eventjs=Event;(function(root){"use strict";root.modifyEventListener=true;root.modifySelectors=true;root.add=function(target,type,listener,configure){return eventManager(target,type,listener,configure,"add")};root.remove=function(target,type,listener,configure){return eventManager(target,type,listener,configure,"remove")};root.stop=function(event){if(!event)return;if(event.stopPropagation)event.stopPropagation();event.cancelBubble=true;event.bubble=0};root.prevent=function(event){if(!event)return;if(event.preventDefault)event.preventDefault();if(event.preventManipulation)event.preventManipulation();event.returnValue=false};root.cancel=function(event){root.stop(event);root.prevent(event)};root.getEventSupport=function(target,type){if(typeof target==="string"){type=target;target=window}type="on"+type;if(type in target)return true;if(!target.setAttribute)target=document.createElement("div");if(target.setAttribute&&target.removeAttribute){target.setAttribute(type,"");var isSupported=typeof target[type]==="function";if(typeof target[type]!=="undefined")target[type]=null;target.removeAttribute(type);return isSupported}};var clone=function(obj){if(!obj||typeof obj!=="object")return obj;var temp=new obj.constructor;for(var key in obj){if(!obj[key]||typeof obj[key]!=="object"){temp[key]=obj[key]}else{temp[key]=clone(obj[key])}}return temp};var eventManager=function(target,type,listener,configure,trigger,fromOverwrite){configure=configure||{};if(String(target)==="[object Object]"){var data=target;target=data.target;type=data.type;listener=data.listener;delete data.target;delete data.type;delete data.listener;for(var key in data){configure[key]=data[key]}}if(!target||!type||!listener)return;if(typeof target==="string"&&type==="ready"){var time=(new Date).getTime();var timeout=configure.timeout;var ms=configure.interval||1e3/60;var interval=window.setInterval(function(){if((new Date).getTime()-time>timeout){window.clearInterval(interval)}if(document.querySelector(target)){window.clearInterval(interval);setTimeout(listener,1)}},ms);return}if(typeof target==="string"){target=document.querySelectorAll(target);if(target.length===0)return createError("Missing target on listener!",arguments);if(target.length===1){target=target[0]}}var event;var events={};if(target.length>0&&target!==window){for(var n0=0,length0=target.length;n0<length0;n0++){event=eventManager(target[n0],type,listener,clone(configure),trigger);if(event)events[n0]=event}return createBatchCommands(events)}if(type.indexOf&&type.indexOf(" ")!==-1)type=type.split(" ");if(type.indexOf&&type.indexOf(",")!==-1)type=type.split(",");if(typeof type!=="string"){if(typeof type.length==="number"){for(var n1=0,length1=type.length;n1<length1;n1++){event=eventManager(target,type[n1],listener,clone(configure),trigger);if(event)events[type[n1]]=event}}else{for(var key in type){if(typeof type[key]==="function"){event=eventManager(target,key,type[key],clone(configure),trigger)}else{event=eventManager(target,key,type[key].listener,clone(type[key]),trigger)}if(event)events[key]=event}}return createBatchCommands(events)}if(typeof target!=="object")return createError("Target is not defined!",arguments);if(typeof listener!=="function")return createError("Listener is not a function!",arguments);var useCapture=configure.useCapture||false;var id=getID(target)+"."+getID(listener)+"."+(useCapture?1:0);if(root.Gesture&&root.Gesture._gestureHandlers[type]){id=type+id;if(trigger==="remove"){if(!wrappers[id])return;wrappers[id].remove();delete wrappers[id]}else if(trigger==="add"){if(wrappers[id]){wrappers[id].add();return wrappers[id]}if(configure.useCall&&!root.modifyEventListener){var tmp=listener;listener=function(event,self){for(var key in self)event[key]=self[key];return tmp.call(target,event)}}configure.gesture=type;configure.target=target;configure.listener=listener;configure.fromOverwrite=fromOverwrite;wrappers[id]=root.proxy[type](configure)}return wrappers[id]}else{var eventList=getEventList(type);for(var n=0,eventId;n<eventList.length;n++){type=eventList[n];eventId=type+"."+id;if(trigger==="remove"){if(!wrappers[eventId])continue;target[remove](type,listener,useCapture);delete wrappers[eventId]}else if(trigger==="add"){if(wrappers[eventId])return wrappers[eventId];target[add](type,listener,useCapture);wrappers[eventId]={id:eventId,type:type,target:target,listener:listener,remove:function(){for(var n=0;n<eventList.length;n++){root.remove(target,eventList[n],listener,configure)}}}}}return wrappers[eventId]}};var createBatchCommands=function(events){return{remove:function(){for(var key in events){events[key].remove()}},add:function(){for(var key in events){events[key].add()}}}};var createError=function(message,data){if(typeof console==="undefined")return;if(typeof console.error==="undefined")return;console.error(message,data)};var pointerDefs={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]};var pointerDetect={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};var getEventSupport=function(){root.supports={};if(window.navigator.msPointerEnabled){root.supports.msPointer=true}if(root.getEventSupport("touchstart")){root.supports.touch=true}if(root.getEventSupport("mousedown")){root.supports.mouse=true}}();var getEventList=function(){return function(type){var prefix=document.addEventListener?"":"on";var idx=pointerDetect[type];if(isFinite(idx)){var types=[];for(var key in root.supports){types.push(prefix+pointerDefs[key][idx])}return types}else{return[prefix+type]}}}();var wrappers={};var counter=0;var getID=function(object){if(object===window)return"#window";if(object===document)return"#document";if(!object.uniqueID)object.uniqueID="e"+counter++;return object.uniqueID};var add=document.addEventListener?"addEventListener":"attachEvent";var remove=document.removeEventListener?"removeEventListener":"detachEvent";root.createPointerEvent=function(event,self,preventRecord){var eventName=self.gesture;var target=self.target;var pts=event.changedTouches||root.proxy.getCoords(event);if(pts.length){var pt=pts[0];self.pointers=preventRecord?[]:pts;self.pageX=pt.pageX;self.pageY=pt.pageY;self.x=self.pageX;self.y=self.pageY}var newEvent=document.createEvent("Event");newEvent.initEvent(eventName,true,true);newEvent.originalEvent=event;for(var k in self){if(k==="target")continue;newEvent[k]=self[k]}var type=newEvent.type;if(root.Gesture&&root.Gesture._gestureHandlers[type]){self.oldListener.call(target,newEvent,self,false)}};if(root.modifyEventListener&&window.HTMLElement)(function(){var augmentEventListener=function(proto){var recall=function(trigger){var handle=trigger+"EventListener";var handler=proto[handle];proto[handle]=function(type,listener,useCapture){if(root.Gesture&&root.Gesture._gestureHandlers[type]){var configure=useCapture;if(typeof useCapture==="object"){configure.useCall=true}else{configure={useCall:true,useCapture:useCapture}}eventManager(this,type,listener,configure,trigger,true)}else{var types=getEventList(type);for(var n=0;n<types.length;n++){handler.call(this,types[n],listener,useCapture)}}}};recall("add");recall("remove")};if(navigator.userAgent.match(/Firefox/)){augmentEventListener(HTMLDivElement.prototype);augmentEventListener(HTMLCanvasElement.prototype)}else{augmentEventListener(HTMLElement.prototype)}augmentEventListener(document);augmentEventListener(window)})();if(root.modifySelectors)(function(){var proto=NodeList.prototype;proto.removeEventListener=function(type,listener,useCapture){for(var n=0,length=this.length;n<length;n++){this[n].removeEventListener(type,listener,useCapture)}};proto.addEventListener=function(type,listener,useCapture){for(var n=0,length=this.length;n<length;n++){this[n].addEventListener(type,listener,useCapture)}}})();return root})(Event);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.pointerSetup=function(conf,self){conf.doc=conf.target.ownerDocument||conf.target;conf.minFingers=conf.minFingers||conf.fingers||1;conf.maxFingers=conf.maxFingers||conf.fingers||Infinity;conf.position=conf.position||"relative";delete conf.fingers;self=self||{};self.enabled=true;self.gesture=conf.gesture;self.target=conf.target;self.env=conf.env;if(Event.modifyEventListener&&conf.fromOverwrite){conf.oldListener=conf.listener;conf.listener=Event.createPointerEvent}var fingers=0;var type=self.gesture.indexOf("pointer")===0&&Event.modifyEventListener?"pointer":"mouse";if(conf.oldListener)self.oldListener=conf.oldListener;self.listener=conf.listener;self.proxy=function(listener){self.defaultListener=conf.listener;conf.listener=listener;listener(conf.event,self)};self.add=function(){if(self.enabled===true)return;if(conf.onPointerDown)Event.add(conf.target,type+"down",conf.onPointerDown);if(conf.onPointerMove)Event.add(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp)Event.add(conf.doc,type+"up",conf.onPointerUp);self.enabled=true};self.remove=function(){if(self.enabled===false)return;if(conf.onPointerDown)Event.remove(conf.target,type+"down",conf.onPointerDown);if(conf.onPointerMove)Event.remove(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp)Event.remove(conf.doc,type+"up",conf.onPointerUp);self.reset();self.enabled=false};self.pause=function(opt){if(conf.onPointerMove&&(!opt||opt.move))Event.remove(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp&&(!opt||opt.up))Event.remove(conf.doc,type+"up",conf.onPointerUp);fingers=conf.fingers;conf.fingers=0};self.resume=function(opt){if(conf.onPointerMove&&(!opt||opt.move))Event.add(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp&&(!opt||opt.up))Event.add(conf.doc,type+"up",conf.onPointerUp);conf.fingers=fingers};self.reset=function(){conf.tracker={};conf.fingers=0};return self};var sp=Event.supports;Event.pointerType=sp.mouse?"mouse":sp.touch?"touch":"mspointer";root.pointerStart=function(event,self,conf){var type=(event.type||"mousedown").toUpperCase();if(type.indexOf("MOUSE")===0)Event.pointerType="mouse";else if(type.indexOf("TOUCH")===0)Event.pointerType="touch";else if(type.indexOf("MSPOINTER")===0)Event.pointerType="mspointer";var addTouchStart=function(touch,sid){var bbox=conf.bbox;var pt=track[sid]={};switch(conf.position){case"absolute":pt.offsetX=0;pt.offsetY=0;break;case"differenceFromLast":pt.offsetX=touch.pageX;pt.offsetY=touch.pageY;break;case"difference":pt.offsetX=touch.pageX;pt.offsetY=touch.pageY;break;case"move":pt.offsetX=touch.pageX-bbox.x1;pt.offsetY=touch.pageY-bbox.y1;break;default:pt.offsetX=bbox.x1;pt.offsetY=bbox.y1;break}if(conf.position==="relative"){var x=touch.pageX+bbox.scrollLeft-pt.offsetX;var y=touch.pageY+bbox.scrollTop-pt.offsetY}else{var x=touch.pageX-pt.offsetX;var y=touch.pageY-pt.offsetY}pt.rotation=0;pt.scale=1;pt.startTime=pt.moveTime=(new Date).getTime();pt.move={x:x,y:y};pt.start={x:x,y:y};conf.fingers++};conf.event=event;if(self.defaultListener){conf.listener=self.defaultListener;delete self.defaultListener}var isTouchStart=!conf.fingers;var track=conf.tracker;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;if(conf.fingers){if(conf.fingers>=conf.maxFingers){var ids=[];for(var sid in conf.tracker)ids.push(sid);self.identifier=ids.join(",");return isTouchStart}var fingers=0;for(var rid in track){if(track[rid].up){delete track[rid];addTouchStart(touch,sid);conf.cancel=true;break}fingers++}if(track[sid])continue;addTouchStart(touch,sid)}else{track=conf.tracker={};self.bbox=conf.bbox=root.getBoundingBox(conf.target);conf.fingers=0;conf.cancel=false;addTouchStart(touch,sid)}}var ids=[];for(var sid in conf.tracker)ids.push(sid);self.identifier=ids.join(",");return isTouchStart};root.pointerEnd=function(event,self,conf,onPointerUp){var touches=event.touches||[];var length=touches.length;var exists={};for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier;exists[sid||Infinity]=true}for(var sid in conf.tracker){var track=conf.tracker[sid];if(exists[sid]||track.up)continue;if(onPointerUp){onPointerUp({pageX:track.pageX,pageY:track.pageY,changedTouches:[{pageX:track.pageX,pageY:track.pageY,identifier:sid==="Infinity"?Infinity:sid}]},"up")}track.up=true;conf.fingers--}if(conf.fingers!==0)return false;var ids=[];conf.gestureFingers=0;for(var sid in conf.tracker){conf.gestureFingers++;ids.push(sid)}self.identifier=ids.join(",");return true};root.getCoords=function(event){if(typeof event.pageX!=="undefined"){root.getCoords=function(event){return Array({type:"mouse",x:event.pageX,y:event.pageY,pageX:event.pageX,pageY:event.pageY,identifier:event.pointerId||Infinity})}}else{root.getCoords=function(event){event=event||window.event;return Array({type:"mouse",x:event.clientX+document.documentElement.scrollLeft,y:event.clientY+document.documentElement.scrollTop,pageX:event.clientX+document.documentElement.scrollLeft,pageY:event.clientY+document.documentElement.scrollTop,identifier:Infinity})}}return root.getCoords(event)};root.getCoord=function(event){if("ontouchstart"in window){var pX=0;var pY=0;root.getCoord=function(event){var touches=event.changedTouches;if(touches&&touches.length){return{x:pX=touches[0].pageX,y:pY=touches[0].pageY}}else{return{x:pX,y:pY}}}}else if(typeof event.pageX!=="undefined"&&typeof event.pageY!=="undefined"){root.getCoord=function(event){return{x:event.pageX,y:event.pageY}}}else{root.getCoord=function(event){event=event||window.event;return{x:event.clientX+document.documentElement.scrollLeft,y:event.clientY+document.documentElement.scrollTop}}}return root.getCoord(event)};root.getBoundingBox=function(o){if(o===window||o===document)o=document.body;var bbox={};var bcr=o.getBoundingClientRect();bbox.width=bcr.width;bbox.height=bcr.height;bbox.x1=bcr.left;bbox.y1=bcr.top;bbox.x2=bbox.x1+bbox.width;bbox.y2=bbox.y1+bbox.height;bbox.scaleX=bcr.width/o.offsetWidth||1;bbox.scaleY=bcr.height/o.offsetHeight||1;bbox.scrollLeft=0;bbox.scrollTop=0;var tmp=o.parentNode;while(tmp!==null){if(tmp===document.body)break;if(tmp.scrollTop===undefined)break;var style=window.getComputedStyle(tmp);var position=style.getPropertyValue("position");if(position==="absolute"){break}else if(position==="fixed"){bbox.scrollTop-=tmp.parentNode.scrollTop;break}else{bbox.scrollLeft+=tmp.scrollLeft;bbox.scrollTop+=tmp.scrollTop}tmp=tmp.parentNode}return bbox};(function(){var agent=navigator.userAgent.toLowerCase();var mac=agent.indexOf("macintosh")!==-1;if(mac&&agent.indexOf("khtml")!==-1){var watch={91:true,93:true}}else if(mac&&agent.indexOf("firefox")!==-1){var watch={224:true}}else{var watch={17:true}}root.metaTrackerReset=function(){root.metaKey=false;root.ctrlKey=false;root.shiftKey=false;root.altKey=false};root.metaTracker=function(event){var check=!!watch[event.keyCode];if(check)root.metaKey=event.type==="keydown";root.ctrlKey=event.ctrlKey;root.shiftKey=event.shiftKey;root.altKey=event.altKey;return check}})();return root}(Event.proxy);if(typeof Event==="undefined")var Event={};Event.MutationObserver=function(){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var DOMAttrModifiedSupported=function(){var p=document.createElement("p");var flag=false;var fn=function(){flag=true};if(p.addEventListener){p.addEventListener("DOMAttrModified",fn,false)}else if(p.attachEvent){p.attachEvent("onDOMAttrModified",fn)}else{return false}p.setAttribute("id","target");return flag}();return function(container,callback){if(MutationObserver){var options={subtree:false,attributes:true};var observer=new MutationObserver(function(mutations){mutations.forEach(function(e){callback.call(e.target,e.attributeName)})});observer.observe(container,options)}else if(DOMAttrModifiedSupported){Event.add(container,"DOMAttrModified",function(e){callback.call(container,e.attrName)})}else if("onpropertychange"in document.body){Event.add(container,"propertychange",function(e){callback.call(container,window.event.propertyName)})}}}();if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.click=function(conf){conf.gesture=conf.gesture||"click";conf.maxFingers=conf.maxFingers||conf.fingers||1;var EVENT;conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){Event.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);Event.add(conf.doc,"mouseup",conf.onPointerUp)}};conf.onPointerMove=function(event){EVENT=event};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp);if(EVENT.cancelBubble&&++EVENT.bubble>1)return;var pointers=EVENT.changedTouches||root.getCoords(EVENT);var pointer=pointers[0];var bbox=conf.bbox;var newbbox=root.getBoundingBox(conf.target);if(conf.position==="relative"){var ax=pointer.pageX+bbox.scrollLeft-bbox.x1;var ay=pointer.pageY+bbox.scrollTop-bbox.y1}else{var ax=pointer.pageX-bbox.x1;var ay=pointer.pageY-bbox.y1}if(ax>0&&ax<bbox.width&&ay>0&&ay<bbox.height&&bbox.scrollTop===newbbox.scrollTop){for(var key in conf.tracker)break;var point=conf.tracker[key];self.x=point.start.x;self.y=point.start.y;conf.listener(EVENT,self)}}};var self=root.pointerSetup(conf);self.state="click";Event.add(conf.target,"mousedown",conf.onPointerDown);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.click=root.click;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.dbltap=root.dblclick=function(conf){conf.gesture=conf.gesture||"dbltap";conf.maxFingers=conf.maxFingers||conf.fingers||1;var delay=700;var time0,time1,timeout;var pointer0,pointer1;conf.onPointerDown=function(event){var pointers=event.changedTouches||root.getCoords(event);if(time0&&!time1){pointer1=pointers[0];time1=(new Date).getTime()-time0}else{pointer0=pointers[0];time0=(new Date).getTime();time1=0;clearTimeout(timeout);timeout=setTimeout(function(){time0=0},delay)}if(root.pointerStart(event,self,conf)){Event.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);Event.add(conf.doc,"mouseup",conf.onPointerUp)}};conf.onPointerMove=function(event){if(time0&&!time1){var pointers=event.changedTouches||root.getCoords(event);pointer1=pointers[0]}var bbox=conf.bbox;if(conf.position==="relative"){var ax=pointer1.pageX+bbox.scrollLeft-bbox.x1;var ay=pointer1.pageY+bbox.scrollTop-bbox.y1}else{var ax=pointer1.pageX-bbox.x1;var ay=pointer1.pageY-bbox.y1}if(!(ax>0&&ax<bbox.width&&ay>0&&ay<bbox.height&&Math.abs(pointer1.pageX-pointer0.pageX)<=25&&Math.abs(pointer1.pageY-pointer0.pageY)<=25)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);clearTimeout(timeout);time0=time1=0}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp)}if(time0&&time1){if(time1<=delay&&!(event.cancelBubble&&++event.bubble>1)){self.state=conf.gesture;for(var key in conf.tracker)break;var point=conf.tracker[key];self.x=point.start.x;self.y=point.start.y;conf.listener(event,self)}clearTimeout(timeout);time0=time1=0}};var self=root.pointerSetup(conf);self.state="dblclick";Event.add(conf.target,"mousedown",conf.onPointerDown);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=root.dbltap;Event.Gesture._gestureHandlers.dblclick=root.dblclick;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.dragElement=function(that,event){root.drag({event:event,target:that,position:"move",listener:function(event,self){that.style.left=self.x+"px";that.style.top=self.y+"px";Event.prevent(event)}})};root.drag=function(conf){conf.gesture="drag";conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){if(!conf.monitor){Event.add(conf.doc,"mousemove",conf.onPointerMove);Event.add(conf.doc,"mouseup",conf.onPointerUp)}}conf.onPointerMove(event,"down")};conf.onPointerMove=function(event,state){if(!conf.tracker)return conf.onPointerDown(event);var bbox=conf.bbox;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var identifier=touch.identifier||Infinity;var pt=conf.tracker[identifier];if(!pt)continue;pt.pageX=touch.pageX;pt.pageY=touch.pageY;self.state=state||"move";self.identifier=identifier;self.start=pt.start;self.fingers=conf.fingers;if(conf.position==="differenceFromLast"){self.x=pt.pageX-pt.offsetX;self.y=pt.pageY-pt.offsetY;pt.offsetX=pt.pageX;pt.offsetY=pt.pageY}else if(conf.position==="relative"){self.x=pt.pageX+bbox.scrollLeft-pt.offsetX;self.y=pt.pageY+bbox.scrollTop-pt.offsetY}else{self.x=pt.pageX-pt.offsetX;self.y=pt.pageY-pt.offsetY}conf.listener(event,self)}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf,conf.onPointerMove)){if(!conf.monitor){Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp)}}};var self=root.pointerSetup(conf);if(conf.event){conf.onPointerDown(conf.event)}else{Event.add(conf.target,"mousedown",conf.onPointerDown);if(conf.monitor){Event.add(conf.doc,"mousemove",conf.onPointerMove);Event.add(conf.doc,"mouseup",conf.onPointerUp)}}return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=root.drag;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";var RAD_DEG=Math.PI/180;root.gesture=function(conf){conf.gesture=conf.gesture||"gesture";conf.minFingers=conf.minFingers||conf.fingers||2;conf.onPointerDown=function(event){var fingers=conf.fingers;if(root.pointerStart(event,self,conf)){Event.add(conf.doc,"mousemove",conf.onPointerMove);Event.add(conf.doc,"mouseup",conf.onPointerUp)}if(conf.fingers===conf.minFingers&&fingers!==conf.fingers){self.fingers=conf.minFingers;self.scale=1;self.rotation=0;self.state="start";var sids="";for(var key in conf.tracker)sids+=key;self.identifier=parseInt(sids);conf.listener(event,self)}};conf.onPointerMove=function(event,state){var bbox=conf.bbox;var points=conf.tracker;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;var pt=points[sid];if(!pt)continue;if(conf.position==="relative"){pt.move.x=touch.pageX+bbox.scrollLeft-bbox.x1;pt.move.y=touch.pageY+bbox.scrollTop-bbox.y1}else{pt.move.x=touch.pageX-bbox.x1;pt.move.y=touch.pageY-bbox.y1}}if(conf.fingers<conf.minFingers)return;var touches=[];var scale=0;var rotation=0;var centroidx=0;var centroidy=0;var length=0;for(var sid in points){var touch=points[sid];if(touch.up)continue;centroidx+=touch.move.x;centroidy+=touch.move.y;length++}centroidx/=length;centroidy/=length;for(var sid in points){var touch=points[sid];if(touch.up)continue;var start=touch.start;if(!start.distance){var dx=start.x-centroidx;var dy=start.y-centroidy;start.distance=Math.sqrt(dx*dx+dy*dy);start.angle=Math.atan2(dx,dy)/RAD_DEG}var dx=touch.move.x-centroidx;var dy=touch.move.y-centroidy;var distance=Math.sqrt(dx*dx+dy*dy);scale+=distance/start.distance;var angle=Math.atan2(dx,dy)/RAD_DEG;var rotate=(start.angle-angle+360)%360-180;touch.DEG2=touch.DEG1;touch.DEG1=rotate>0?rotate:-rotate;if(typeof touch.DEG2!=="undefined"){if(rotate>0){touch.rotation+=touch.DEG1-touch.DEG2}else{touch.rotation-=touch.DEG1-touch.DEG2}rotation+=touch.rotation}touches.push(touch.move)}self.touches=touches;self.fingers=conf.fingers;self.scale=scale/conf.fingers;self.rotation=rotation/conf.fingers;self.state="change";conf.listener(event,self)};conf.onPointerUp=function(event){var fingers=conf.fingers;if(root.pointerEnd(event,self,conf)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp)}if(fingers===conf.minFingers&&conf.fingers<conf.minFingers){self.fingers=conf.fingers;self.state="end";conf.listener(event,self)}};var self=root.pointerSetup(conf);Event.add(conf.target,"mousedown",conf.onPointerDown);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=root.gesture;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.pointerdown=root.pointermove=root.pointerup=function(conf){conf.gesture=conf.gesture||"pointer";if(conf.target.isPointerEmitter)return;var isDown=true;conf.onPointerDown=function(event){isDown=false;self.gesture="pointerdown";conf.listener(event,self)};conf.onPointerMove=function(event){self.gesture="pointermove";conf.listener(event,self,isDown)};conf.onPointerUp=function(event){isDown=true;self.gesture="pointerup";conf.listener(event,self,true)};var self=root.pointerSetup(conf);Event.add(conf.target,"mousedown",conf.onPointerDown);Event.add(conf.target,"mousemove",conf.onPointerMove);Event.add(conf.doc,"mouseup",conf.onPointerUp);conf.target.isPointerEmitter=true;return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=root.pointerdown;Event.Gesture._gestureHandlers.pointermove=root.pointermove;Event.Gesture._gestureHandlers.pointerup=root.pointerup;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.shake=function(conf){var self={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:conf.target,listener:conf.listener,remove:function(){window.removeEventListener("devicemotion",onDeviceMotion,false)}};var threshold=4;var timeout=1e3;var timeframe=200;var shakes=3;var lastShake=(new Date).getTime();var gravity={x:0,y:0,z:0};var delta={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var onDeviceMotion=function(e){if(e.rotationRate){self.accelerationIncludingGravity=e.accelerationIncludingGravity;self.acceleration=e.acceleration}else{var alpha=.8;var o=e.accelerationIncludingGravity;gravity.x=alpha*gravity.x+(1-alpha)*o.x;gravity.y=alpha*gravity.y+(1-alpha)*o.y;gravity.z=alpha*gravity.z+(1-alpha)*o.z;self.accelerationIncludingGravity=gravity;self.acceleration.x=o.x-gravity.x;self.acceleration.y=o.y-gravity.y;self.acceleration.z=o.z-gravity.z}if(conf.gesture==="devicemotion"){conf.listener(e,self);return}var data="xyz";var now=(new Date).getTime();for(var n=0,length=data.length;n<length;n++){var letter=data[n];var ACCELERATION=self.acceleration[letter];var DELTA=delta[letter];var abs=Math.abs(ACCELERATION);if(now-lastShake<timeout)continue;if(abs>threshold){var idx=now*ACCELERATION/abs;var span=Math.abs(idx+DELTA.value);if(DELTA.value&&span<timeframe){DELTA.value=idx;DELTA.count++;if(DELTA.count===shakes){conf.listener(e,self);lastShake=now;DELTA.value=0;DELTA.count=0}}else{DELTA.value=idx;DELTA.count=1}}}};if(!window.addEventListener)return;if(window.DeviceMotionEvent){window.addEventListener("devicemotion",onDeviceMotion,false)}return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=root.shake;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";var RAD_DEG=Math.PI/180;root.swipe=function(conf){conf.snap=conf.snap||90;conf.threshold=conf.threshold||1;conf.gesture=conf.gesture||"swipe";conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){Event.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);Event.add(conf.doc,"mouseup",conf.onPointerUp)}};conf.onPointerMove=function(event){var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;var o=conf.tracker[sid];if(!o)continue;o.move.x=touch.pageX;o.move.y=touch.pageY;o.moveTime=(new Date).getTime()}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp);var velocity1;var velocity2;var degree1;var degree2;var start={x:0,y:0};var endx=0;var endy=0;var length=0;for(var sid in conf.tracker){var touch=conf.tracker[sid];var xdist=touch.move.x-touch.start.x;var ydist=touch.move.y-touch.start.y;endx+=touch.move.x;endy+=touch.move.y;start.x+=touch.start.x;start.y+=touch.start.y;length++;var distance=Math.sqrt(xdist*xdist+ydist*ydist);var ms=touch.moveTime-touch.startTime;var degree2=Math.atan2(xdist,ydist)/RAD_DEG+180;var velocity2=ms?distance/ms:0;if(typeof degree1==="undefined"){degree1=degree2;velocity1=velocity2}else if(Math.abs(degree2-degree1)<=20){degree1=(degree1+degree2)/2;velocity1=(velocity1+velocity2)/2}else{return}}var fingers=conf.gestureFingers;if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){if(velocity1>conf.threshold){start.x/=length;start.y/=length;self.start=start;self.x=endx/length;self.y=endy/length;self.angle=-(((degree1/conf.snap+.5>>0)*conf.snap||360)-360);self.velocity=velocity1;self.fingers=fingers;self.state="swipe";conf.listener(event,self)}}}};var self=root.pointerSetup(conf);Event.add(conf.target,"mousedown",conf.onPointerDown);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=root.swipe;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.longpress=function(conf){conf.gesture="longpress";return root.tap(conf)};root.tap=function(conf){conf.delay=conf.delay||500;conf.timeout=conf.timeout||250;conf.driftDeviance=conf.driftDeviance||10;conf.gesture=conf.gesture||"tap";var timestamp,timeout;conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){timestamp=(new Date).getTime();Event.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);Event.add(conf.doc,"mouseup",conf.onPointerUp);if(conf.gesture!=="longpress")return;timeout=setTimeout(function(){if(event.cancelBubble&&++event.bubble>1)return;var fingers=0;for(var key in conf.tracker){var point=conf.tracker[key];if(point.end===true)return;if(conf.cancel)return;fingers++}if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){self.state="start";self.fingers=fingers;self.x=point.start.x;self.y=point.start.y;conf.listener(event,self)}},conf.delay)}};conf.onPointerMove=function(event){var bbox=conf.bbox;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var identifier=touch.identifier||Infinity;var pt=conf.tracker[identifier];if(!pt)continue;if(conf.position==="relative"){var x=touch.pageX+bbox.scrollLeft-bbox.x1;var y=touch.pageY+bbox.scrollTop-bbox.y1}else{var x=touch.pageX-bbox.x1;var y=touch.pageY-bbox.y1}var dx=x-pt.start.x;var dy=y-pt.start.y;var distance=Math.sqrt(dx*dx+dy*dy);if(!(x>0&&x<bbox.width&&y>0&&y<bbox.height&&distance<=conf.driftDeviance)){Event.remove(conf.doc,"mousemove",conf.onPointerMove);conf.cancel=true;return}}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){clearTimeout(timeout);
Event.remove(conf.doc,"mousemove",conf.onPointerMove);Event.remove(conf.doc,"mouseup",conf.onPointerUp);if(event.cancelBubble&&++event.bubble>1)return;if(conf.gesture==="longpress"){if(self.state==="start"){self.state="end";conf.listener(event,self)}return}if(conf.cancel)return;if((new Date).getTime()-timestamp>conf.timeout)return;var fingers=conf.gestureFingers;if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){self.state="tap";self.fingers=conf.gestureFingers;conf.listener(event,self)}}};var self=root.pointerSetup(conf);Event.add(conf.target,"mousedown",conf.onPointerDown);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.tap=root.tap;Event.Gesture._gestureHandlers.longpress=root.longpress;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.wheel=function(conf){var interval;var timeout=conf.timeout||150;var count=0;var self={gesture:"wheel",state:"start",wheelDelta:0,target:conf.target,listener:conf.listener,preventElasticBounce:function(){var target=this.target;var scrollTop=target.scrollTop;var top=scrollTop+target.offsetHeight;var height=target.scrollHeight;if(top===height&&this.wheelDelta<=0)Event.cancel(event);else if(scrollTop===0&&this.wheelDelta>=0)Event.cancel(event);Event.stop(event)},add:function(){conf.target[add](type,onMouseWheel,false)},remove:function(){conf.target[remove](type,onMouseWheel,false)}};var onMouseWheel=function(event){event=event||window.event;self.state=count++?"change":"start";self.wheelDelta=event.detail?event.detail*-20:event.wheelDelta;conf.listener(event,self);clearTimeout(interval);interval=setTimeout(function(){count=0;self.state="end";self.wheelDelta=0;conf.listener(event,self)},timeout)};var add=document.addEventListener?"addEventListener":"attachEvent";var remove=document.removeEventListener?"removeEventListener":"detachEvent";var type=Event.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";conf.target[add](type,onMouseWheel,false);return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=root.wheel;return root}(Event.proxy);if(typeof Event==="undefined")var Event={};if(typeof Event.proxy==="undefined")Event.proxy={};Event.proxy=function(root){"use strict";root.orientation=function(conf){var self={gesture:"orientationchange",previous:null,current:window.orientation,target:conf.target,listener:conf.listener,remove:function(){window.removeEventListener("orientationchange",onOrientationChange,false)}};var onOrientationChange=function(e){self.previous=self.current;self.current=window.orientation;if(self.previous!==null&&self.previous!=self.current){conf.listener(e,self);return}};if(window.DeviceOrientationEvent){window.addEventListener("orientationchange",onOrientationChange,false)}return self};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=root.orientation;return root}(Event.proxy);